!function(){"use strict";var e={5614:function(e,n,t){var r,s,a=t(3324),o=t(5861),c=t(7757),i=t.n(c),u=t(395),l=t(7762),f=null;function p(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===n&&(n=r.result.transaction(["analysis_meta"],"readonly").objectStore("analysis_meta"));var t=n.getAll();t.onsuccess=function(){var n=t.result;n.forEach((function(e){delete e.files})),e(n)},t.onerror=function(){e(null)}}function m(e,n){return d.apply(this,arguments)}function d(){return(d=(0,o.Z)(i().mark((function e(n,t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=t.get(n);r.onsuccess=function(){void 0!==r.result?e(r.result):e(null)},r.onerror=function(){e(null)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return Promise.allSettled(e).then((function(e){var n,t=(0,l.Z)(e);try{for(t.s();!(n=t.n()).done;){if(!n.value)return!1}}catch(r){t.e(r)}finally{t.f()}return!0}))}function y(){return v.apply(this,arguments)}function v(){return(v=(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return e.abrupt("return",new Promise((function(e){p(e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,n){return g.apply(this,arguments)}function g(){return(g=(0,o.Z)(i().mark((function e(n,t){var s,a,o,c,u,l,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return s=r.result.transaction(["file","file_meta"],"readwrite"),a=s.objectStore("file"),o=s.objectStore("file_meta"),e.next=7,m(n,o);case 7:return c=e.sent,u=null===c?0:c.count,u++,l=new Promise((function(e){var r=a.put({id:n,payload:t.buffer});r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}})),p=new Promise((function(e){c.count=u;var n=o.put(c);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}})),e.abrupt("return",h([l,p]));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,n,t,r){return _.apply(this,arguments)}function _(){return(_=(0,o.Z)(i().mark((function e(n,t,s,a){var o,c,u,l,m,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:if(o=r.result.transaction(["analysis","analysis_meta"],"readwrite"),c=o.objectStore("analysis"),u=o.objectStore("analysis_meta"),null!=n){e.next=10;break}return e.next=8,new Promise((function(e){return p(e,u)}));case 8:l=e.sent,n=String(l.length);case 10:return m=new Promise((function(e){var r=c.put({id:n,payload:t.buffer});r.onsuccess=function(n){e(!0)},r.onerror=function(n){e(!1)}})),d=new Promise((function(e){var t=u.put({id:n,files:s,time:Number(new Date),title:a});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),e.next=14,h([m,d]);case 14:if(!e.sent){e.next=18;break}return e.abrupt("return",n);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=(0,o.Z)(i().mark((function e(n){var t,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return t=r.result.transaction(["file"],"readonly").objectStore("file"),e.next=5,m(n,t);case 5:return s=e.sent,e.abrupt("return",new Uint8Array(s.payload));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=(0,o.Z)(i().mark((function e(n){var t,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return t=r.result.transaction(["analysis"],"readonly").objectStore("analysis"),e.next=5,m(n,t);case 5:return s=e.sent,e.abrupt("return",new Uint8Array(s.payload));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return E.apply(this,arguments)}function E(){return(E=(0,o.Z)(i().mark((function e(n){var t,s,a,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return t=r.result.transaction(["file","file_meta"],"readwrite"),s=t.objectStore("file"),a=t.objectStore("file_meta"),e.next=7,m(n,a);case 7:return o=e.sent,c=o.count,c--,u=[],0==c?(u.push(new Promise((function(e){var t=s.remove(n);t.onerror=function(n){e(!1)},t.onsuccess=function(n){e(!0)}}))),u.push(new Promise((function(e){var t=a.delete(n);t.onerror=function(n){e(!1)},t.onsuccess=function(n){e(!0)}})))):u.push(new Promise((function(e){o.count=c;var n=a.put(o);n.onsuccess=function(n){e(!0)},n.onerror=function(n){e(!1)}}))),e.abrupt("return",h(u));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=(0,o.Z)(i().mark((function e(n){var t,s,a,o,c,u,p,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f;case 2:return t=r.result.transaction(["analysis","analysis_meta"],"readwrite"),s=t.objectStore("analysis"),a=t.objectStore("analysis_meta"),(o=[]).push(new Promise((function(e){var t=s.delete(n);t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}}))),e.next=9,m(n,a);case 9:c=e.sent,u=(0,l.Z)(c.files);try{for(u.s();!(p=u.n()).done;)d=p.value,o.push(S(d))}catch(i){u.e(i)}finally{u.f()}return o.push(new Promise((function(e){var t=a.delete(n);t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}}))),e.abrupt("return",h(o));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=null;function j(e){return R.apply(this,arguments)}function R(){return R=(0,o.Z)(i().mark((function e(n){var t,r,a,o,c,u,l,f,p,m,d,h,y=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.length>1&&void 0!==y[1]?y[1]:null,r=y.length>2&&void 0!==y[2]&&y[2],e.next=4,O;case 4:if(r){e.next=13;break}return a=s.result.transaction(["downloads"],"readonly"),o=a.objectStore("downloads"),c=new Promise((function(e){var t=o.get(n);t.onsuccess=function(n){void 0!==t.result?e(t.result.payload):e(null)},t.onerror=function(n){e(null)}})),e.next=10,c;case 10:if(null===(u=e.sent)){e.next=13;break}return e.abrupt("return",u);case 13:return l=null==t?fetch(n):fetch(n,t),e.next=16,l;case 16:if((f=e.sent).ok){e.next=19;break}throw"failed to download '"+n+"' ("+f.status+")";case 19:return e.next=21,f.arrayBuffer();case 21:return p=e.sent,m=s.result.transaction(["downloads"],"readwrite"),d=m.objectStore("downloads"),h=new Promise((function(e){var t=d.put({url:n,payload:p});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),e.next=27,h;case 27:if(e.sent){e.next=30;break}throw"failed to download resources for '"+n+"'";case 30:return e.abrupt("return",p);case 31:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}var P=t(8109),D={quality_control:{use_mito_default:["qc","qc-usemitodefault"],mito_prefix:["qc","qc-mito"],nmads:["qc","qc-nmads"],skip:["qc","skip"]},adt_quality_control:{nmads:["adt_qualitycontrol","nmads"],min_detected_drop:["adt_qualitycontrol","min_detected_drop"],igg_prefix:["adt_qualitycontrol","igg_prefix"],skip:["adt_qualitycontrol","skip"]},adt_normalization:{num_pcs:["adt_normalization","num_pcs"],num_clusters:["adt_normalization","num_clusters"]},feature_selection:{span:["fSelection","fsel-span"]},pca:{num_hvgs:["pca","pca-hvg"],num_pcs:["pca","pca-npc"]},adt_pca:{num_pcs:["adt_pca","num_pcs"]},combine_embeddings:{weights:["combine_embeddings","weights"]},batch_correction:{num_neighbors:["batch_correction","num_neighbors"]},choose_clustering:{method:["cluster","clus-method"]},tsne:{perplexity:["tsne","tsne-perp"],iterations:["tsne","tsne-iter"],animate:["tsne","animate"]},umap:{num_neighbors:["umap","umap-nn"],num_epochs:["umap","umap-epochs"],min_dist:["umap","umap-min_dist"],animate:["umap","animate"]},kmeans_cluster:{k:["cluster","kmeans-k"]},snn_graph_cluster:{k:["cluster","clus-k"],scheme:["cluster","clus-scheme"],resolution:["cluster","clus-res"]},cell_labelling:{human_references:["annotateCells","annotateCells-human_references"],mouse_references:["annotateCells","annotateCells-mouse_references"]}};function Z(e){for(var n=function(n,t){if(!(n in e))throw new Error("no available step '"+n+"' in the supplied parameters");var r=e[n];if(!(t in r))throw new Error("no available parameter '"+t+"' in step '"+n+"'");return r[t]},t={inputs:{batch:n("inputs","sample_factor"),subset:n("inputs","subset")}},r=0,s=Object.entries(D);r<s.length;r++)for(var o=(0,a.Z)(s[r],2),c=o[0],i=o[1],l=0,f=Object.entries(i);l<f.length;l++){var p=(0,a.Z)(f[l],2),m=p[0],d=p[1];d[0]in t||(t[d[0]]={});var h=t[d[0]];if(d[1]in h)throw new Error("duplicate entry for parameter '"+d[0]+"."+d[1]+"'");h[d[1]]=n(c,m)}return t.batch_correction.method=u.us(e),t.ann={approximate:u.Ol(e)},null===t.combine_embeddings.weights&&(t.combine_embeddings.weights={}),t}function T(e,n){if(e)if(Array.isArray(e)){var t,r=(0,l.Z)(e);try{for(r.s();!(t=r.n()).done;){T(t.value,n)}}catch(i){r.e(i)}finally{r.f()}}else if(e.constructor==Object)for(var s=0,o=Object.entries(e);s<o.length;s++){var c=(0,a.Z)(o[s],2);c[0];T(c[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}function A(e){postMessage({type:"".concat(e,"_START")})}function C(e,n){if("undefined"==typeof n)postMessage({type:"".concat(e,"_CACHE")});else{var t=[];T(n,t),postMessage({type:"".concat(e,"_DATA"),resp:n},t)}}function B(e,n,t){postMessage({type:"".concat(e,"_ERROR"),resp:{reason:n.toString(),fatal:t}})}var F,N=t(4214),z=null,U={},K="https://cors-proxy.aaron-lun.workers.dev";function I(e){return G.apply(this,arguments)}function G(){return(G=(0,o.Z)(i().mark((function e(n){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(K+"/"+encodeURIComponent(n));case 2:return t=e.sent,e.abrupt("return",new Uint8Array(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){if("10X"==e.format)return new u.By(e.h5);if("MatrixMarket"==e.format)return new u.en(e.mtx,e.genes||null,e.annotations||null);if("H5AD"==e.format)return new u.Fl(e.h5);if("SummarizedExperiment"==e.format)return new u.H$(e.rds);if("ExperimentHub"==e.format)return new N.M(e.id);throw new Error("unknown format '"+e.format+"'")}function H(e){return function(){var n=(0,o.Z)(i().mark((function n(t,r){var s,a,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=r.buffer(),n.next=3,P.FB(s);case 3:return a=n.sent,o=t+"_"+r.name()+"_"+s.length+"_"+a,n.next=7,b(o,s);case 7:if(n.sent){n.next=10;break}throw"failed to save file '"+o+"' to KanaDB";case 10:return e.push(o),n.abrupt("return",o);case 12:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}function V(e){return L.apply(this,arguments)}function L(){return(L=(0,o.Z)(i().mark((function e(n){var t,r,s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="serialized_out.h5",e.prev=1,e.next=4,u.ve(n,t);case 4:return s=e.sent,e.next=7,u.MM(t,s,{finishFun:C});case 7:if(a=e.sent,null===z){e.next=11;break}return e.next=11,u.Sl(z);case 11:z=a,r={parameters:Z(u.G8(z)),other:{custom_selections:z.custom_selections.fetchSelections()}},console.log(r.other.custom_selections);case 14:return e.prev=14,u.ZD((function(e){return e.removeFile(t)})),e.finish(14);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,null,[[1,,14,17]])})))).apply(this,arguments)}u.v9(I),N.n(I),u.cO.ExperimentHub=N.M,u.$p((function(e,n,t,r){postMessage({type:e+"_iter",x:n,y:t,iteration:r},[n.buffer,t.buffer])})),u.ED((function(e){return x.apply(this,arguments)})),onmessage=function(e){var n=e.data,t=n.type,c=n.payload,l=!1;if("INIT"==t){l=!0;var m=Math.round(2*navigator.hardwareConcurrency/3),d=u.j2({numberOfThreads:m}),h=d.then((function(){return u.TN()}));h.then((function(e){z=e,postMessage({type:t,msg:"Success: analysis state created"})}));var v=f=new Promise((function(e){(r=indexedDB.open("KanaDB",2)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("analysis")}catch(e){}try{n.deleteObjectStore("analysis_meta")}catch(e){}try{n.deleteObjectStore("file")}catch(e){}try{n.deleteObjectStore("file_meta")}catch(e){}n.createObjectStore("analysis",{keyPath:"id"}),n.createObjectStore("analysis_meta",{keyPath:"id"}),n.createObjectStore("file",{keyPath:"id"}),n.createObjectStore("file_meta",{keyPath:"id"})},r.onsuccess=function(){p(e)},r.onerror=function(){e(null)}}));v.then((function(e){null!==e?postMessage({type:"KanaDB_store",resp:e,msg:"Success: KanaDB initialized"}):(console.error(error),postMessage({type:"KanaDB_ERROR",msg:"Error: Cannot initialize KanaDB"}))}));var b=(null===O&&(O=new Promise((function(e,n){(s=indexedDB.open("DownloadsDB",3)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("downloads")}catch(e){}n.createObjectStore("downloads",{keyPath:"url"})},s.onsuccess=function(){e(null)},s.onerror=function(){n("failed to initialize DownloadsDB")}}))),O);b.then((function(e){postMessage({type:"DownloadsDB_store",resp:e,msg:"Success: DownloadsDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"DownloadsDB_ERROR",msg:"Error: Cannot initialize DownloadsDB"})}));try{var g=N.M.availableDatasets();postMessage({type:"ExperimentHub_store",resp:g,msg:"Success: ExperimentHub initialized"})}catch(j){postMessage({type:"ExperimentHub_ERROR",msg:"Error: Cannot access datasets in ExperimentHub"})}(F=Promise.all([d,v,b,h])).then((function(){postMessage({type:t,msg:"Success: bakana initialized"})})).catch((function(e){console.error(e),B(t,e,l)}))}else if("RUN"==t)l=!0,F.then((function(e){var n=c.inputs,r=n.files;if(null!==r){for(var s={},o=0,i=Object.entries(r);o<i.length;o++){var f=(0,a.Z)(i[o],2),p=f[0],m=f[1];"uid"in m&&m.uid in U?s[p]=U[m.uid]:s[p]=q(m)}for(var d=0,h=Object.entries(U);d<h.length;d++){var y=(0,a.Z)(h[d],2),v=y[0];y[1].clear(),delete U[v]}r=s}var b=function(e,n){var t=u.Q7(),r=function(e,n,r){if("undefined"==typeof r)throw new Error("cannot assign undefined parameter to '"+e+"."+n+"'");if(!(e in t))throw new Error("unknown analysis step '"+e+"'");var s=t[e];if(!(n in s))throw new Error("unknown analysis parameter '"+n+"' for step '"+e+"'");s[n]=r};r("inputs","sample_factor",e.batch),r("inputs","subset",e.subset);for(var s=0,o=Object.entries(D);s<o.length;s++)for(var c=(0,a.Z)(o[s],2),i=c[0],l=c[1],f=0,p=Object.entries(l);f<p.length;f++){var m=(0,a.Z)(p[f],2),d=m[0],h=m[1];r(i,d,n[h[0]][h[1]])}return u.TD(t,n.batch_correction.method),u.bN(t,n.ann.approximate),null!==t.combine_embeddings.weights&&new Set(Object.values(t.combine_embeddings.weights)).size<=1&&(t.combine_embeddings.weights=null),t}(n,c.params);u.x6(z,r,b,{startFun:A,finishFun:C}).catch((function(e){console.error(e),B(t,e,l)}))})).catch((function(e){console.error(e),B(t,e,l)}));else if("LOAD"==t){l=!0;var _=c.inputs.files;if("kana"==_[Object.keys(_)[0]].format){var x=_[Object.keys(_)[0]].file;F.then(function(){var e=(0,o.Z)(i().mark((function e(n){var t,r,s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new FileReaderSync,r=t.readAsArrayBuffer(x),e.next=4,V(r);case 4:s=e.sent,a=[],T(s.other,a),postMessage({type:"loadedParameters",resp:s},a);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)}))}else if("kanadb"==_[Object.keys(_)[0]].format){(function(e){return k.apply(this,arguments)})(E=_[Object.keys(_)[0]].file).then(function(){var e=(0,o.Z)(i().mark((function e(n){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){e.next=4;break}postMessage({type:"KanaDB_ERROR",msg:"Fail: cannot load analysis ID '".concat(E,"'")}),e.next=10;break;case 4:return e.next=6,V(n);case 6:t=e.sent,r=[],T(t.other,r),postMessage({type:"loadedParameters",resp:t},r);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)}))}}else if("EXPORT"==t)F.then(function(){var e=(0,o.Z)(i().mark((function e(n){var t,r,s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="serialized_in.h5",e.prev=1,e.next=4,u.cN(z,t,{embedded:!0});case 4:r=e.sent,s=u.pY(t,r.collected),a=s.buffer,postMessage({type:"exportState",resp:a,msg:"Success: application state exported"},[a]);case 8:return e.prev=8,u.ZD((function(e){return e.removeFile(t)})),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[1,,8,11]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)}));else if("SAVEKDB"==t){var S=c.title;F.then(function(){var e=(0,o.Z)(i().mark((function e(n){var t,r,s,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],r=u.rF(H(t)),s="serialized_in.h5",a=null,e.prev=4,e.next=7,u.cN(z,s,{embedded:!1});case 7:return o=u.pY(s,null),e.next=10,w(null,o,t,S);case 10:a=e.sent;case 11:return e.prev=11,u.ZD((function(e){return e.removeFile(s)})),u.rF(r),e.finish(11);case 15:if(null===a){e.next=22;break}return e.next=18,y();case 18:c=e.sent,postMessage({type:"KanaDB_store",resp:c,msg:"Success: Saved analysis to cache (".concat(a,")")}),e.next=24;break;case 22:console.error(error),postMessage({type:"KanaDB_ERROR",msg:"Fail: Cannot save analysis to cache"});case 24:case"end":return e.stop()}}),e,null,[[4,,11,15]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)}))}else if("REMOVEKDB"==t){var E;(function(e){return M.apply(this,arguments)})(E=c.id).then(function(){var e=(0,o.Z)(i().mark((function e(n){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=7;break}return e.next=3,y();case 3:t=e.sent,postMessage({type:"KanaDB_store",resp:t,msg:"Success: Removed file from cache (".concat(E,")")}),e.next=9;break;case 7:console.error(error),postMessage({type:"KanaDB_ERROR",msg:"fail: cannot remove file from cache (".concat(E,")")});case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)}))}else"PREFLIGHT_INPUT"==t?F.then(function(){var e=(0,o.Z)(i().mark((function e(n){var t,r,s,o,l,f,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},e.prev=1,r={},s=0,o=Object.entries(c.inputs.files);s<o.length;s++)l=(0,a.Z)(o[s],2),f=l[0],"uid"in(p=l[1])?(p.uid in U||(U[p.uid]=q(p)),r[f]=U[p.uid]):r[f]=q(p);return t.status="SUCCESS",e.next=7,u.gj(r,{cache:!0});case 7:t.details=e.sent,e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),console.error(e.t0),t.status="ERROR",t.reason=e.t0.toString();case 15:postMessage({type:"PREFLIGHT_INPUT_DATA",resp:t,msg:"Success: PREFLIGHT_INPUT done"});case 16:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)})):"computeVersusClusters"==t?F.then((function(e){var n=c.rank_type.replace(/-.*/,""),t=z.marker_detection.computeVersus(c.left,c.right,n,c.modality);postMessage({type:"computeVersusClusters",resp:t,msg:"Success: COMPUTE_VERSUS_CLUSTERS done"})})).catch((function(e){console.error(e),B(t,e,l)})):"computeVersusSelections"==t?F.then((function(e){var n=c.rank_type.replace(/-.*/,""),t=z.custom_selections.computeVersus(c.left,c.right,n,c.modality);postMessage({type:"computeVersusSelections",resp:t,msg:"Success: COMPUTE_VERSUS_SELECTIONS done"})})).catch((function(e){console.error(e),B(t,e,l)})):"getMarkersForCluster"==t?F.then((function(e){var n=c.cluster,t=c.rank_type,r=c.modality,s=z.marker_detection.fetchGroupResults(n,t,r),a=[];T(s,a),postMessage({type:"setMarkersForCluster",resp:s,msg:"Success: GET_MARKER_GENE done"},a)})).catch((function(e){console.error(e),B(t,e,l)})):"getGeneExpression"==t?F.then((function(e){var n,t=c.gene,r=c.modality.toLowerCase();if("rna"===r)n=z.normalization.fetchExpression(t);else{if("adt"!==r)throw new Error("unknown feature type '"+r+"'");n=z.adt_normalization.fetchExpression(t)}postMessage({type:"setGeneExpression",resp:{gene:t,expr:n},msg:"Success: GET_GENE_EXPRESSION done"},[n.buffer])})).catch((function(e){console.error(e),B(t,e,l)})):"computeCustomMarkers"==t?F.then((function(e){z.custom_selections.addSelection(c.id,c.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})).catch((function(e){console.error(e),B(t,e,l)})):"getMarkersForSelection"==t?F.then((function(e){var n=c.rank_type.replace(/-.*/,""),t=z.custom_selections.fetchResults(c.cluster,n,c.modality),r=[];T(t,r),postMessage({type:"setMarkersForCustomSelection",resp:t,msg:"Success: GET_MARKER_GENE done"},r)})).catch((function(e){console.error(e),B(t,e,l)})):"removeCustomMarkers"==t?F.then((function(e){z.custom_selections.removeSelection(c.id)})).catch((function(e){console.error(e),B(t,e,l)})):"animateTSNE"==t?F.then(function(){var e=(0,o.Z)(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.tsne.animate();case 2:return e.t0=C,e.next=5,z.tsne.summary();case 5:e.t1=e.sent,(0,e.t0)("tsne",e.t1);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)})):"animateUMAP"==t?F.then(function(){var e=(0,o.Z)(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.umap.animate();case 2:return e.t0=C,e.next=5,z.umap.summary();case 5:e.t1=e.sent,(0,e.t0)("umap",e.t1);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),B(t,e,l)})):"getAnnotation"==t?F.then((function(e){var n,t,r=c.annotation;if(n=!1!==c.unfiltered?z.cell_filtering.fetchFilteredAnnotations(r):z.inputs.fetchAnnotations(r),ArrayBuffer.isView(n))t={type:"array",values:n.slice()};else{var s=[],a={},o=new Int32Array(n.length);n.map((function(e,n){e in a||(a[e]=s.length,s.push(e)),o[n]=a[e]})),t={type:"factor",index:o,levels:s}}var i=[];T(t,i),postMessage({type:"setAnnotation",resp:{annotation:r,values:t},msg:"Success: GET_ANNOTATION done"},i)})).catch((function(e){console.error(e),B(t,e,l)})):(console.error("MIM:::msg type incorrect"),B(t,"Type not defined",l))}}},n={};function t(r){var s=n[r];if(void 0!==s)return s.exports;var a=n[r]={exports:{}};return e[r].call(a.exports,a,a.exports,t),a.exports}t.m=e,t.x=function(){var e=t.O(void 0,[386,164],(function(){return t(5614)}));return e=t.O(e)},function(){var e=[];t.O=function(n,r,s,a){if(!r){var o=1/0;for(l=0;l<e.length;l++){r=e[l][0],s=e[l][1],a=e[l][2];for(var c=!0,i=0;i<r.length;i++)(!1&a||o>=a)&&Object.keys(t.O).every((function(e){return t.O[e](r[i])}))?r.splice(i--,1):(c=!1,a<o&&(o=a));if(c){e.splice(l--,1);var u=s();void 0!==u&&(n=u)}}return n}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,s,a]}}(),t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,{a:n}),n},t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))},t.u=function(e){return"static/js/"+e+"."+{164:"7ded7c7e",386:"b4f0aef8",484:"08b29855",909:"7270cade",933:"634c97c2"}[e]+".chunk.js"},t.miniCssF=function(e){},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.p="/kana/",function(){t.b=self.location+"/../../../";var e={614:1};t.f.i=function(n,r){e[n]||importScripts(t.p+t.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],r=n.push.bind(n);n.push=function(n){var s=n[0],a=n[1],o=n[2];for(var c in a)t.o(a,c)&&(t.m[c]=a[c]);for(o&&o(t);s.length;)e[s.pop()]=1;r(n)}}(),function(){var e=t.x;t.x=function(){return Promise.all([t.e(386),t.e(164)]).then(e)}}();t.x()}();
//# sourceMappingURL=614.e8070b18.chunk.js.map
!function(){"use strict";var e={9747:function(e,n,t){var r,o=t(4165),s=t(5861),a=t(3324),c=t(7762),u=t(2754),i=t(5831),l=null;function f(e){return p.apply(this,arguments)}function p(){return p=(0,s.Z)((0,o.Z)().mark((function e(n){var t,s,a,c,u,i,f,p,d,m,y,h,v=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>1&&void 0!==v[1]?v[1]:null,s=v.length>2&&void 0!==v[2]&&v[2],e.next=4,l;case 4:if(s){e.next=13;break}return a=r.result.transaction(["downloads"],"readonly"),c=a.objectStore("downloads"),u=new Promise((function(e){var t=c.get(n);t.onsuccess=function(n){void 0!==t.result?e(t.result.payload):e(null)},t.onerror=function(n){e(null)}})),e.next=10,u;case 10:if(null===(i=e.sent)){e.next=13;break}return e.abrupt("return",i);case 13:return f=null==t?fetch(n):fetch(n,t),e.next=16,f;case 16:if((p=e.sent).ok){e.next=19;break}throw"failed to download '"+n+"' ("+p.status+")";case 19:return e.next=21,p.arrayBuffer();case 21:return d=e.sent,m=r.result.transaction(["downloads"],"readwrite"),y=m.objectStore("downloads"),h=new Promise((function(e){var t=y.put({url:n,payload:d});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),e.next=27,h;case 27:if(e.sent){e.next=30;break}throw"failed to download resources for '"+n+"'";case 30:return e.abrupt("return",d);case 31:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}var d=t(5061),m=t(9807),y="https://cors-proxy.aaron-lun.workers.dev";function h(e){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(y+"/"+encodeURIComponent(n));case 2:return t=e.sent,e.abrupt("return",new Uint8Array(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,n){if(e)if(Array.isArray(e)){var t,r=(0,c.Z)(e);try{for(r.s();!(t=r.n()).done;){g(t.value,n)}}catch(i){r.e(i)}finally{r.f()}}else if(e.constructor==Object)for(var o=0,s=Object.entries(e);o<s.length;o++){var u=(0,a.Z)(s[o],2);u[0];g(u[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}function w(e){postMessage({type:"".concat(e,"_START")})}function b(e,n){if("undefined"==typeof n)postMessage({type:"".concat(e,"_CACHE")});else{var t=[];g(n,t),postMessage({type:"".concat(e,"_DATA"),resp:n},t)}}function x(e,n,t){postMessage({type:"".concat(e,"_ERROR"),resp:{reason:n.toString(),fatal:t}})}u.ES.setDownload(h),d.b5(h),u.E4.setDownload(h),d.ao(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n,t,r){var s,a,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=d.XZ()+"/"+n,a=y+"/"+encodeURIComponent(s),null!=t||null!=r){e.next=9;break}return e.next=5,f(a);case 5:return c=e.sent,e.abrupt("return",new Response(c));case 9:return e.abrupt("return",fetch(a+"?start="+String(t)+"&end="+String(r)));case 10:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}()),d.d9(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.Kk()+"/"+n,e.next=3,f(y+"/"+encodeURIComponent(t));case 3:return r=e.sent,e.abrupt("return",new Response(r));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),m.M.setDownloadFun(h),u.cO.ExperimentHub=m.M;t(3841);var S="K@\ud835\udf02a#$c3ll";"".concat(S,"::CLUSTERS");var _="".concat(S,"::SELECTION"),O={},k={},E=null,Z={},A=null,R=null;function M(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("H5AD"===e.format)return new u.nN(e.h5,n?e.options:{});if("SummarizedExperiment"===e.format)return new u.CM(e.rds,n?e.options:{});if("ZippedArtifactdb"===e.format)return new u.EQ(e.zipname,new u.zD(e.zipfile),n?e.options:{});throw new Error("unknown format '"+e.format+"'")}function C(e,n){var t,r={},o=(0,c.Z)(e.cells.columnNames());try{for(o.s();!(t=o.n()).done;){var s=t.value,i=e.cells.column(s);(Array.isArray(i)||ArrayBuffer.isView(i))&&(r[s]=u.Qr(i))}}catch(O){o.e(O)}finally{o.f()}var l={cells:{columns:r,numberOfCells:e.cells.numberOfRows()}};if("SummarizedExperiment"===n.format||"ZippedArtifactdb"===n.format){if(l.modality_features={},"modality_features"in e)for(var f=0,p=Object.entries(e.modality_features);f<p.length;f++){var d,m=(0,a.Z)(p[f],2),y=m[0],h=m[1],v={},g=(0,c.Z)(h.columnNames());try{for(g.s();!(d=g.n()).done;){var w=d.value;Array.isArray(h.column(w))&&(v[w]=u.Qr(h.column(w)),v[w]._all_=h.column(w))}}catch(O){g.e(O)}finally{g.f()}l.modality_features[y]={columns:v,numberOfFeatures:h.numberOfRows(),rownames:Array.isArray(h.rowNames())}}}else{l.all_features={};var b,x={},S=(0,c.Z)(e.all_features.columnNames());try{for(S.s();!(b=S.n()).done;){var _=b.value;x[_]=u.Qr(e.all_features.column(_)),x[_]._all_=e.all_features.column(_)}}catch(O){S.e(O)}finally{S.f()}l.all_features={columns:x,numberOfFeatures:e.all_features.numberOfRows(),rownames:Array.isArray(e.all_features.rowNames())}}return"H5AD"===n.format?l.all_assay_names=e.all_assay_names:"SummarizedExperiment"!==n.format&&"ZippedArtifactdb"!==n.format||(l.modality_assay_names=e.modality_assay_names),l.reduced_dimension_names=e.reduced_dimension_names,l}function T(e,n){var t;return e in Z||((t=new u.J6(N(),n.ids.slice())).computeAll(),Z[e]=t),Z[e]}var j,F=function(e){if(-1!==e.indexOf(":::")){var n=e.split(":::");return E.cells.column(n[0]).column(n[1])}return E.cells.column(e)},N=function(){return E.matrix};onmessage=function(e){var n=e.data,t=n.type,f=n.payload,p=!1;if("INIT"===t){p=!0;var d=Math.round(2*navigator.hardwareConcurrency/3),m=u.j2({numberOfThreads:d}),y=m.then((function(){return u.TN()}));y.then((function(e){e,postMessage({type:t,msg:"Success: analysis state created"})}));var h=(null===l&&(l=new Promise((function(e,n){(r=indexedDB.open("DownloadsDB",3)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("downloads")}catch(e){}n.createObjectStore("downloads",{keyPath:"url"})},r.onsuccess=function(){e(null)},r.onerror=function(){n("failed to initialize DownloadsDB")}}))),l);h.then((function(e){postMessage({type:"DownloadsDB_store",resp:e,msg:"Success: DownloadsDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"DownloadsDB_ERROR",msg:"Error: Cannot initialize DownloadsDB"})})),(j=Promise.all([m,y,h])).then((function(){postMessage({type:t,msg:"Success: bakana initialized"})})).catch((function(e){console.error(e),x(t,e,p)}))}else"EXPLORE"===t?(p=!0,j.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,l,p,d,m,y,h,v,g,x,S,_,k,Z,R,C,T,j,F,N,D,P,I,V,U,z,B,G,L,H,J,Y,K,Q,X,$,q,W,ee,ne;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.inputs,null===(r=t.files)){e.next=31;break}for(s={},l=0,p=Object.entries(r);l<p.length;l++)d=(0,a.Z)(p[l],2),m=d[0],"uid"in(y=d[1])&&y.uid in O&&(O[y.uid].clear(),delete O[m]),s[m]=M(y,!0),s[m].setOptions(y.options);h=0,v=Object.entries(s);case 6:if(!(h<v.length)){e.next=31;break}return g=(0,a.Z)(v[h],2),x=g[0],S=g[1],e.next=10,S.load();case 10:if(E=e.sent,!r[x].options.normalized){_=(0,c.Z)(E.matrix.available());try{for(_.s();!(k=_.n()).done;)Z=k.value,R=E.matrix.get(Z),C=i.gk(R,{allowZeros:!0}),E.matrix.add(Z,C)}catch(n){_.e(n)}finally{_.f()}}w(T="inputs"),j={},F=(0,c.Z)(E.cells.columnNames());try{for(F.s();!(N=F.n()).done;)D=N.value,P=E.cells.column(D),(Array.isArray(P)||ArrayBuffer.isView(P))&&("continuous"===(I=u.Qr(P)).type?j[D]={name:D,truncated:new Set(P).size>=50,type:I.type}:"categorical"===I.type&&(j[D]={name:D,truncated:!0===I.truncated,type:I.type}))}catch(n){F.e(n)}finally{F.f()}for(V={annotations:j,genes:{},num_cells:E.cells.numberOfRows(),num_genes:{}},U=0,z=Object.entries(E.features);U<z.length;U++){B=(0,a.Z)(z[U],2),G=B[0],L=B[1],V.genes[G]={},V.num_genes[G]=L.numberOfRows(),H=(0,c.Z)(L.columnNames());try{for(H.s();!(J=H.n()).done;)Y=J.value,K=L.column(Y),(Array.isArray(K)||ArrayBuffer.isView(K))&&(V.genes[G][Y]=K)}catch(n){H.e(n)}finally{H.f()}L.rowNames()&&(V.genes[G].rowNames=L.rowNames())}for(b(T,V),w(Q="embedding"),X={},$=0,q=Object.entries(E.reduced_dimensions);$<q.length;$++)W=(0,a.Z)(q[$],2),ee=W[0],ne=W[1],"pca"!==ee.toLowerCase()&&(X[ee]={x:ne[0].slice(),y:ne[1].slice()});b(Q,X),A&&A.free(),A=new u.sF(E.matrix);case 28:h++,e.next=6;break;case 31:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)}))):"PREFLIGHT_INPUT"===t?j.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,c,u,i,l,p,d;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},e.prev=1,r={},s={},c=0,u=Object.entries(f.inputs.files);case 5:if(!(c<u.length)){e.next=23;break}if(i=(0,a.Z)(u[c],2),l=i[0],!("uid"in(p=i[1]))){e.next=17;break}if(p.uid in O){e.next=13;break}return O[p.uid]=M(p),e.next=12,O[p.uid].summary();case 12:k[p.uid]=e.sent;case 13:r[l]=O[p.uid],s[l]=C(k[p.uid],p),e.next=20;break;case 17:d=M(p),r[l]=d,s[l]=C(r[l],p);case 20:c++,e.next=5;break;case 23:t.status="SUCCESS",t.details=s,e.next=32;break;case 27:e.prev=27,e.t0=e.catch(1),console.error(e.t0),t.status="ERROR",t.reason=e.t0.toString();case 32:postMessage({type:"PREFLIGHT_INPUT_DATA",resp:t,msg:"Success: PREFLIGHT_INPUT done"});case 33:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"computeVersusClusters"===t?j.then((function(e){var n=f.rank_type,t=f.modality,r=f.annotation,o=i.Yh(F(r)),s=T(r,o).computeVersus(o.levels.indexOf(f.left),o.levels.indexOf(f.right)),a=u.jJ(s.results[t],s.left,n),c=[];g(a,c),postMessage({type:"computeVersusClusters",resp:a,msg:"Success: COMPUTE_VERSUS_CLUSTERS done"},c)})).catch((function(e){console.error(e),x(t,e,p)})):"computeVersusSelections"===t?j.then((function(e){var n=f.rank_type,t=A.computeVersus(f.left,f.right),r=u.jJ(t.results[f.modality],f.left,n),o=[];g(r,o),postMessage({type:"computeVersusSelections",resp:r,msg:"Success: COMPUTE_VERSUS_SELECTIONS done"},o)})).catch((function(e){console.error(e),x(t,e,p)})):"getMarkersForCluster"===t?j.then((function(e){var n=f.cluster,t=f.rank_type,r=f.modality,o=f.annotation,s=i.Yh(F(o)),a=T(o,s).fetchResults()[r],c=u.jJ(a,s.levels.indexOf(n),t),l=[];g(c,l),postMessage({type:"setMarkersForCluster",resp:c,msg:"Success: GET_MARKER_GENE done"},l)})).catch((function(e){console.error(e),x(t,e,p)})):"getGeneExpression"===t?j.then((function(e){var n=f.gene,t=f.modality,r=E.matrix.get(t).row(n);postMessage({type:"setGeneExpression",resp:{gene:n,expr:r},msg:"Success: GET_GENE_EXPRESSION done"},[r.buffer])})).catch((function(e){console.error(e),x(t,e,p)})):"computeCustomMarkers"===t?j.then((function(e){A.addSelection(f.id,f.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})).catch((function(e){console.error(e),x(t,e,p)})):"getMarkersForSelection"===t?j.then((function(e){var n=f.rank_type.replace(/-.*/,""),t=A.fetchResults(f.cluster)[f.modality],r=u.jJ(t,1,n),o=[];g(r,o),postMessage({type:"setMarkersForCustomSelection",resp:r,msg:"Success: GET_MARKER_GENE done"},o)})).catch((function(e){console.error(e),x(t,e,p)})):"removeCustomMarkers"===t?j.then((function(e){A.removeSelection(f.id)})).catch((function(e){console.error(e),x(t,e,p)})):"getAnnotation"===t?j.then((function(e){var n,t,r=f.annotation;if(n=F(r),ArrayBuffer.isView(n))t={type:"array",values:n.slice()};else{var o=[],s={},a=new Int32Array(n.length);n.map((function(e,n){e in s||(s[e]=o.length,o.push(e)),a[n]=s[e]})),t={type:"factor",index:a,levels:o}}var c=[];g(t,c),postMessage({type:"setAnnotation",resp:{annotation:r,values:t},msg:"Success: GET_ANNOTATION done"},c)})).catch((function(e){console.error(e),x(t,e,p)})):"computeFeaturesetSummary"===t?j.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,a,c,u,l,p,d,m,y,h,v,g;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.annotation,r=f.rank_type,s=f.cluster,a=f.modality,c=r.indexOf("-"),_===t?(u=A.fetchSelectionIndices(s),l=E.cells.numberOfRows(),p=new Uint8Array(l),u.map((function(e){return p.set([1],e)})),d=i.Yh(p),m=T(t,d),y=m.fetchResults()[a],R.ready().then((function(e){b("computeFeaturesetSummary",R.computeEnrichment(y,d.levels.indexOf(1),r.slice(0,c),r.slice(c+1)))}))):(h=i.Yh(F(t)),v=T(t,h),g=v.fetchResults()[a],R.ready().then((function(e){b("computeFeaturesetSummary",R.computeEnrichment(g,h.levels.indexOf(s),r.slice(0,c),r.slice(c+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"computeFeaturesetVSSummary"===t?j.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,a,c,u,l,p,d,m;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.annotation,r=f.rank_type,s=f.left,a=f.right,c=f.modality,u=r.indexOf("-"),_===t?(l=A.computeVersus(s,a),R.ready().then((function(e){b("computeFeaturesetVSSummary",R.computeEnrichment(l.results[c],0,r.slice(0,u),r.slice(u+1)))}))):(p=i.Yh(F(t)),d=T(t,p),m=d.computeVersus(p.levels.indexOf(f.left),p.levels.indexOf(f.right)),R.ready().then((function(e){b("computeFeaturesetVSSummary",R.computeEnrichment(m.results[c],m.left,r.slice(0,u),r.slice(u+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"getFeatureScores"===t?j.then((function(e){var n=f.index;b("setFeatureScores",R.computePerCellScores(n))})).catch((function(e){console.error(e),x(t,e,p)})):"getFeatureGeneIndices"===t?j.then((function(e){var n,t,r=f.index,o=f.cluster,s=f.annotation,c=f.modality,l=f.rank_type,p=R.fetchFeatureSetIndices(r);if(_===s)n=A.fetchResults(f.cluster)[f.modality],t=u.jJ(n,1,f.rank_type);else{var d=i.Yh(F(s));n=T(s,d).fetchResults()[c],t=u.jJ(n,d.levels.indexOf(o),l)}for(var m=t.ordering.map((function(e,n){return p.includes(e)?n:-100})).filter((function(e){return-100!==e})),y={},h=0,v=Object.entries(t);h<v.length;h++){var g=(0,a.Z)(v[h],2),w=g[0],x=g[1];y[w]=x.map((function(e,n){return m.includes(n)?e:-100})).filter((function(e){return-100!==e}))}b("setFeatureGeneIndices",y)})).catch((function(e){console.error(e),x(t,e,p)})):"initFeaturesetEnrich"===t?j.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.modality,R&&R.free(),(R=new u.Y(E.features[t],{normalized:E.matrix.get(t)})).ready().then((function(e){var n=R.fetchCollectionDetails(),t=R.fetchSetDetails();b("feature_set_enrichment",{collections:n,sets:{names:t.names,descriptions:t.descriptions,sizes:t.sizes.slice(),collections:t.collections.slice()}})}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):(console.error("MIM:::msg type incorrect"),x(t,"Type not defined",p))}}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var s=n[r]={id:r,loaded:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}t.m=e,t.x=function(){var e=t.O(void 0,[841,534,377],(function(){return t(9747)}));return e=t.O(e)},function(){var e=[];t.O=function(n,r,o,s){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],s=e[l][2];for(var c=!0,u=0;u<r.length;u++)(!1&s||a>=s)&&Object.keys(t.O).every((function(e){return t.O[e](r[u])}))?r.splice(u--,1):(c=!1,s<a&&(a=s));if(c){e.splice(l--,1);var i=o();void 0!==i&&(n=i)}}return n}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,o,s]}}(),t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))},t.u=function(e){return"static/js/"+e+"."+{377:"676821c7",484:"7594d5c1",534:"0569fe6b",841:"3bb3130c",909:"5f72aea9",933:"2b53d6a2"}[e]+".chunk.js"},t.miniCssF=function(e){},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},t.p="/kana/",function(){t.b=self.location+"/../../../";var e={747:1};t.f.i=function(n,r){e[n]||importScripts(t.p+t.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],r=n.push.bind(n);n.push=function(n){var o=n[0],s=n[1],a=n[2];for(var c in s)t.o(s,c)&&(t.m[c]=s[c]);for(a&&a(t);o.length;)e[o.pop()]=1;r(n)}}(),function(){var e=t.x;t.x=function(){return Promise.all([841,534,377].map(t.e,t)).then(e)}}();t.x()}();
//# sourceMappingURL=747.c23c0029.chunk.js.map
/*! For license information please see 639.e77e16ec.chunk.js.LICENSE.txt */
(self.webpackChunkkana=self.webpackChunkkana||[]).push([[639],{7757:function(e,t,r){e.exports=r(9727)},8109:function(e,t,r){"use strict";r.d(t,{FB:function(){return B}});var n=r(5671),i=r(3144),a=r(7757),s=r.n(a);function o(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function o(e){try{u(n.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))}var u,l=function(){function e(){(0,n.Z)(this,e),this.mutex=Promise.resolve()}return(0,i.Z)(e,[{key:"lock",value:function(){var e=function(){};return this.mutex=this.mutex.then((function(){return new Promise(e)})),new Promise((function(t){e=t}))}},{key:"dispatch",value:function(e){return o(this,void 0,void 0,s().mark((function t(){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lock();case 2:return r=t.sent,t.prev=3,t.next=6,Promise.resolve(e());case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,r(),t.finish(7);case 10:case"end":return t.stop()}}),t,this,[[3,,7,10]])})))}}]),e}();var c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:r.g,h=null!==(u=c.Buffer)&&void 0!==u?u:null,f=c.TextEncoder?new c.TextEncoder:null;function d(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}function v(e,t){for(var r=t.length>>1,n=0;n<r;n++){var i=n<<1;e[n]=d(t.charCodeAt(i),t.charCodeAt(i+1))}}function p(e,t){if(e.length!==2*t.length)return!1;for(var r=0;r<t.length;r++){var n=r<<1;if(t[r]!==d(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}var m="a".charCodeAt(0)-10,g="0".charCodeAt(0);function b(e,t,r){for(var n=0,i=0;i<r;i++){var a=t[i]>>>4;e[n++]=a>9?a+m:a+g,a=15&t[i],e[n++]=a>9?a+m:a+g}return String.fromCharCode.apply(null,e)}for(var w=null!==h?function(e){if("string"===typeof e){var t=h.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(h.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:function(e){if("string"===typeof e)return f.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=new Uint8Array(256),Z=0;Z<y.length;Z++)_[y.charCodeAt(Z)]=Z;function k(e){var t=Math.floor(.75*e.length),r=e.length;return"="===e[r-1]&&(t-=1,"="===e[r-2]&&(t-=1)),t}function A(e){for(var t=k(e),r=e.length,n=new Uint8Array(t),i=0,a=0;a<r;a+=4){var s=_[e.charCodeAt(a)],o=_[e.charCodeAt(a+1)],u=_[e.charCodeAt(a+2)],l=_[e.charCodeAt(a+3)];n[i]=s<<2|o>>4,n[i+=1]=(15&o)<<4|u>>2,n[i+=1]=(3&u)<<6|63&l,i+=1}return n}var x=16384,E=new l,S=new Map;function I(e,t){return o(this,void 0,void 0,s().mark((function r(){var n,i,a,u,l,c,h,f,d,m,g,y,_,Z,k,I,O,C,R,D,B=this;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null,i=null,a=!1,"undefined"!==typeof WebAssembly){r.next=5;break}throw new Error("WebAssembly is not supported in this environment!");case 5:u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i.set(e,t)},l=function(){return i},c=function(){return n.exports},h=function(e){n.exports.Hash_SetMemorySize(e);var t=n.exports.Hash_GetBuffer(),r=n.exports.memory.buffer;i=new Uint8Array(r,t,e)},f=function(){return new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0)},d=E.dispatch((function(){return o(B,void 0,void 0,s().mark((function t(){var r,i,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S.has(e.name)||(r=A(e.data),i=WebAssembly.compile(r),S.set(e.name,i)),t.next=3,S.get(e.name);case 3:return a=t.sent,t.next=6,WebAssembly.instantiate(a,{});case 6:n=t.sent;case 7:case"end":return t.stop()}}),t)})))})),m=function(){return o(B,void 0,void 0,s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return e.next=3,d;case 3:t=n.exports.Hash_GetBuffer(),r=n.exports.memory.buffer,i=new Uint8Array(r,t,x);case 6:case"end":return e.stop()}}),e)})))},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a=!0,n.exports.Hash_Init(e)},y=function(e){for(var t=0;t<e.length;){var r=e.subarray(t,t+x);t+=r.length,i.set(r),n.exports.Hash_Update(r.length)}},_=function(e){if(!a)throw new Error("update() called before init()");var t=w(e);y(t)},Z=new Uint8Array(2*t),k=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!a)throw new Error("digest() called before init()");return a=!1,n.exports.Hash_Final(r),"binary"===e?i.slice(0,t):b(Z,i,t)},I=function(){if(!a)throw new Error("save() can only be called after init() and before digest()");var t=n.exports.Hash_GetState(),r=f(),i=n.exports.memory.buffer,s=new Uint8Array(i,t,r),o=new Uint8Array(4+r);return v(o,e.hash),o.set(s,4),o},O=function(t){if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");var r=n.exports.Hash_GetState(),i=f(),s=4+i,o=n.exports.memory.buffer;if(t.length!==s)throw new Error("Bad state length (expected ".concat(s," bytes, got ").concat(t.length,")"));if(!p(e.hash,t.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");var u=t.subarray(4);new Uint8Array(o,r,i).set(u),a=!0},C=function(e){return"string"===typeof e?e.length<4096:e.byteLength<x},R=C,r.t0=e.name,r.next="argon2"===r.t0||"scrypt"===r.t0?24:"blake2b"===r.t0||"blake2s"===r.t0?26:"blake3"===r.t0?28:"xxhash64"===r.t0||"xxhash3"===r.t0||"xxhash128"===r.t0?30:32;break;case 24:return R=function(){return!0},r.abrupt("break",32);case 26:return R=function(e,t){return t<=512&&C(e)},r.abrupt("break",32);case 28:return R=function(e,t){return 0===t&&C(e)},r.abrupt("break",32);case 30:return R=function(){return!1},r.abrupt("break",32);case 32:return D=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R(e,r))return g(r),_(e),k("hex",a);var s=w(e);return i.set(s),n.exports.Hash_Calculate(s.length,r,a),b(Z,i,t)},r.next=35,m();case 35:return r.abrupt("return",{getMemory:l,writeMemory:u,getExports:c,setMemorySize:h,init:g,update:_,digest:k,save:I,load:O,calculate:D,hashLength:t});case 36:case"end":return r.stop()}}),r)})))}function O(e,t,r){return o(this,void 0,void 0,s().mark((function n(){var i,a;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.lock();case 2:return i=n.sent,n.next=5,I(t,r);case 5:return a=n.sent,i(),n.abrupt("return",a);case 8:case"end":return n.stop()}}),n)})))}new l;new l;new DataView(new ArrayBuffer(4));new l;new l;new l;new l;new l;var C={name:"md5",data:"AGFzbQEAAAABEgRgAAF/YAAAYAF/AGACf38BfwMIBwABAgMBAAIEBQFwAQEBBQQBAQICBg4CfwFBoIoFC38AQYAICwdwCAZtZW1vcnkCAA5IYXNoX0dldEJ1ZmZlcgAACUhhc2hfSW5pdAABC0hhc2hfVXBkYXRlAAIKSGFzaF9GaW5hbAAEDUhhc2hfR2V0U3RhdGUABQ5IYXNoX0NhbGN1bGF0ZQAGClNUQVRFX1NJWkUDAQqzFgcFAEGACQstAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEL6AIBA39BAEEAKAKAiQEiASAAakH/////AXEiAjYCgIkBQQAoAoSJASEDAkAgAiABTw0AQQAgA0EBaiIDNgKEiQELQQAgAyAAQR12ajYChIkBAkACQAJAAkACQAJAIAFBP3EiAw0AQYAJIQIMAQtBwAAgA2siAiAASw0BIANBGGohA0EAIQEDQCADIAFqQYCJAWogAUGACWotAAA6AAAgAyABQQFqIgFqQdgARw0AC0GYiQFBwAAQAxogACACayEAIAJBgAlqIQILIABBwABPDQEgACEDDAILIABFDQJBACEBIANBmIkBakEALQCACToAACAAQQFGDQIgA0GZiQFqIQMgAEF/aiECA0AgAyABaiABQYEJai0AADoAACACIAFBAWoiAUcNAAwDCwsgAEE/cSEDIAIgAEFAcRADIQILIANFDQBBACEBA0AgAUGYiQFqIAIgAWotAAA6AAAgAyABQQFqIgFHDQALCwu0EAEZf0EAKAKUiQEhAkEAKAKQiQEhA0EAKAKMiQEhBEEAKAKIiQEhBQNAIABBCGooAgAiBiAAQRhqKAIAIgcgAEEoaigCACIIIABBOGooAgAiCSAAQTxqKAIAIgogAEEMaigCACILIABBHGooAgAiDCAAQSxqKAIAIg0gDCALIAogDSAJIAggByADIAZqIAIgAEEEaigCACIOaiAFIAQgAiADc3EgAnNqIAAoAgAiD2pB+Miqu31qQQd3IARqIhAgBCADc3EgA3NqQdbunsZ+akEMdyAQaiIRIBAgBHNxIARzakHb4YGhAmpBEXcgEWoiEmogAEEUaigCACITIBFqIABBEGooAgAiFCAQaiAEIAtqIBIgESAQc3EgEHNqQe6d9418akEWdyASaiIQIBIgEXNxIBFzakGvn/Crf2pBB3cgEGoiESAQIBJzcSASc2pBqoyfvARqQQx3IBFqIhIgESAQc3EgEHNqQZOMwcF6akERdyASaiIVaiAAQSRqKAIAIhYgEmogAEEgaigCACIXIBFqIAwgEGogFSASIBFzcSARc2pBgaqaampBFncgFWoiECAVIBJzcSASc2pB2LGCzAZqQQd3IBBqIhEgECAVc3EgFXNqQa/vk9p4akEMdyARaiISIBEgEHNxIBBzakGxt31qQRF3IBJqIhVqIABBNGooAgAiGCASaiAAQTBqKAIAIhkgEWogDSAQaiAVIBIgEXNxIBFzakG+r/PKeGpBFncgFWoiECAVIBJzcSASc2pBoqLA3AZqQQd3IBBqIhEgECAVc3EgFXNqQZPj4WxqQQx3IBFqIhUgESAQc3EgEHNqQY6H5bN6akERdyAVaiISaiAHIBVqIA4gEWogCiAQaiASIBUgEXNxIBFzakGhkNDNBGpBFncgEmoiECAScyAVcSASc2pB4sr4sH9qQQV3IBBqIhEgEHMgEnEgEHNqQcDmgoJ8akEJdyARaiISIBFzIBBxIBFzakHRtPmyAmpBDncgEmoiFWogCCASaiATIBFqIA8gEGogFSAScyARcSASc2pBqo/bzX5qQRR3IBVqIhAgFXMgEnEgFXNqQd2gvLF9akEFdyAQaiIRIBBzIBVxIBBzakHTqJASakEJdyARaiISIBFzIBBxIBFzakGBzYfFfWpBDncgEmoiFWogCSASaiAWIBFqIBQgEGogFSAScyARcSASc2pByPfPvn5qQRR3IBVqIhAgFXMgEnEgFXNqQeabh48CakEFdyAQaiIRIBBzIBVxIBBzakHWj9yZfGpBCXcgEWoiEiARcyAQcSARc2pBh5vUpn9qQQ53IBJqIhVqIAYgEmogGCARaiAXIBBqIBUgEnMgEXEgEnNqQe2p6KoEakEUdyAVaiIQIBVzIBJxIBVzakGF0o/PempBBXcgEGoiESAQcyAVcSAQc2pB+Me+Z2pBCXcgEWoiEiARcyAQcSARc2pB2YW8uwZqQQ53IBJqIhVqIBcgEmogEyARaiAZIBBqIBUgEnMgEXEgEnNqQYqZqel4akEUdyAVaiIQIBVzIhUgEnNqQcLyaGpBBHcgEGoiESAVc2pBge3Hu3hqQQt3IBFqIhIgEXMiGiAQc2pBosL17AZqQRB3IBJqIhVqIBQgEmogDiARaiAJIBBqIBUgGnNqQYzwlG9qQRd3IBVqIhAgFXMiFSASc2pBxNT7pXpqQQR3IBBqIhEgFXNqQamf+94EakELdyARaiISIBFzIgkgEHNqQeCW7bV/akEQdyASaiIVaiAPIBJqIBggEWogCCAQaiAVIAlzakHw+P71e2pBF3cgFWoiECAVcyIVIBJzakHG/e3EAmpBBHcgEGoiESAVc2pB+s+E1X5qQQt3IBFqIhIgEXMiCCAQc2pBheG8p31qQRB3IBJqIhVqIBkgEmogFiARaiAHIBBqIBUgCHNqQYW6oCRqQRd3IBVqIhEgFXMiECASc2pBuaDTzn1qQQR3IBFqIhIgEHNqQeWz7rZ+akELdyASaiIVIBJzIgcgEXNqQfj5if0BakEQdyAVaiIQaiAMIBVqIA8gEmogBiARaiAQIAdzakHlrLGlfGpBF3cgEGoiESAVQX9zciAQc2pBxMSkoX9qQQZ3IBFqIhIgEEF/c3IgEXNqQZf/q5kEakEKdyASaiIQIBFBf3NyIBJzakGnx9DcempBD3cgEGoiFWogCyAQaiAZIBJqIBMgEWogFSASQX9zciAQc2pBucDOZGpBFXcgFWoiESAQQX9zciAVc2pBw7PtqgZqQQZ3IBFqIhAgFUF/c3IgEXNqQZKZs/h4akEKdyAQaiISIBFBf3NyIBBzakH96L9/akEPdyASaiIVaiAKIBJqIBcgEGogDiARaiAVIBBBf3NyIBJzakHRu5GseGpBFXcgFWoiECASQX9zciAVc2pBz/yh/QZqQQZ3IBBqIhEgFUF/c3IgEHNqQeDNs3FqQQp3IBFqIhIgEEF/c3IgEXNqQZSGhZh6akEPdyASaiIVaiANIBJqIBQgEWogGCAQaiAVIBFBf3NyIBJzakGho6DwBGpBFXcgFWoiECASQX9zciAVc2pBgv3Nun9qQQZ3IBBqIhEgFUF/c3IgEHNqQbXk6+l7akEKdyARaiISIBBBf3NyIBFzakG7pd/WAmpBD3cgEmoiFSAEaiAWIBBqIBUgEUF/c3IgEnNqQZGnm9x+akEVd2ohBCAVIANqIQMgEiACaiECIBEgBWohBSAAQcAAaiEAIAFBQGoiAQ0AC0EAIAI2ApSJAUEAIAM2ApCJAUEAIAQ2AoyJAUEAIAU2AoiJASAAC6ECAQN/QQAoAoCJASIAQT9xIgFBmIkBakGAAToAAAJAAkACQCABQT9zIgJBB0sNAAJAIAJFDQAgAUGZiQFqIQADQCAAQQA6AAAgAEEBaiEAIAJBf2oiAg0ACwtBwAAhAkGYiQFBwAAQAxpBACEADAELIAJBCEYNASABQQFqIQALIABBj4kBaiEBA0AgASACakEAOgAAIAJBd2ohACACQX9qIQIgAEEASg0AC0EAKAKAiQEhAAtBACAAQRV2OgDTiQFBACAAQQ12OgDSiQFBACAAQQV2OgDRiQFBACAAQQN0IgI6ANCJAUEAIAI2AoCJAUEAQQAoAoSJATYC1IkBQZiJAUHAABADGkEAQQApAoiJATcDgAlBAEEAKQKQiQE3A4gJCwYAQYCJAQszAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEgABACEAQLCwsBAEGACAsEmAAAAA==",hash:"9b0fac7d"},R=new l,D=null;function B(e){if(null===D)return O(R,C,16).then((function(t){return(D=t).calculate(e)}));try{var t=D.calculate(e);return Promise.resolve(t)}catch(r){return Promise.reject(r)}}new l;new l;new l;new l;new l;new l;new l;new l;new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l;new l;new l},1025:function(e,t){var r,n,i;n=[],r=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,n=r&&/blob:/i.test((t.location||{}).protocol),i={},a=0,s={parse:function(r,n){var o=(n=n||{}).dynamicTyping||!1;if(_(o)&&(n.dynamicTypingFunction=o,o={}),n.dynamicTyping=o,n.transform=!!_(n.transform)&&n.transform,n.worker&&s.WORKERS_SUPPORTED){var u=function(){if(!s.WORKERS_SUPPORTED)return!1;var r,n,o=(r=t.URL||t.webkitURL||null,n=e.toString(),s.BLOB_URL||(s.BLOB_URL=r.createObjectURL(new Blob(["(",n,")();"],{type:"text/javascript"})))),u=new t.Worker(o);return u.onmessage=m,u.id=a++,i[u.id]=u}();return u.userStep=n.step,u.userChunk=n.chunk,u.userComplete=n.complete,u.userError=n.error,n.step=_(n.step),n.chunk=_(n.chunk),n.complete=_(n.complete),n.error=_(n.error),delete n.worker,void u.postMessage({input:r,config:n,workerId:u.id})}var d=null;return s.NODE_STREAM_INPUT,"string"==typeof r?d=n.download?new l(n):new h(n):!0===r.readable&&_(r.read)&&_(r.on)?d=new f(n):(t.File&&r instanceof File||r instanceof Object)&&(d=new c(n)),d.stream(r)},unparse:function(e,t){var r=!1,n=!0,i=",",a="\r\n",o='"',u=o+o,l=!1,c=null,h=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||s.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(i=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(a=t.newline),"string"==typeof t.quoteChar&&(o=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");c=t.columns}void 0!==t.escapeChar&&(u=t.escapeChar+o),("boolean"==typeof t.escapeFormulae||t.escapeFormulae instanceof RegExp)&&(h=t.escapeFormulae instanceof RegExp?t.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var f=new RegExp(v(o),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return d(null,e,l);if("object"==typeof e[0])return d(c||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||c),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),d(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function d(e,t,r){var s="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var o=Array.isArray(e)&&0<e.length,u=!Array.isArray(t[0]);if(o&&n){for(var l=0;l<e.length;l++)0<l&&(s+=i),s+=p(e[l],l);0<t.length&&(s+=a)}for(var c=0;c<t.length;c++){var h=o?e.length:t[c].length,f=!1,d=o?0===Object.keys(t[c]).length:0===t[c].length;if(r&&!o&&(f="greedy"===r?""===t[c].join("").trim():1===t[c].length&&0===t[c][0].length),"greedy"===r&&o){for(var v=[],m=0;m<h;m++){var g=u?e[m]:m;v.push(t[c][g])}f=""===v.join("").trim()}if(!f){for(var b=0;b<h;b++){0<b&&!d&&(s+=i);var w=o&&u?e[b]:b;s+=p(t[c][w],b)}c<t.length-1&&(!r||0<h&&!d)&&(s+=a)}}return s}function p(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var n=!1;h&&"string"==typeof e&&h.test(e)&&(e="'"+e,n=!0);var a=e.toString().replace(f,u);return(n=n||!0===r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(a,s.BAD_DELIMITERS)||-1<a.indexOf(i)||" "===a.charAt(0)||" "===a.charAt(a.length-1))?o+a+o:a}}};if(s.RECORD_SEP=String.fromCharCode(30),s.UNIT_SEP=String.fromCharCode(31),s.BYTE_ORDER_MARK="\ufeff",s.BAD_DELIMITERS=["\r","\n",'"',s.BYTE_ORDER_MARK],s.WORKERS_SUPPORTED=!r&&!!t.Worker,s.NODE_STREAM_INPUT=1,s.LocalChunkSize=10485760,s.RemoteChunkSize=5242880,s.DefaultDelimiter=",",s.Parser=p,s.ParserHandle=d,s.NetworkStreamer=l,s.FileStreamer=c,s.StringStreamer=h,s.ReadableStreamStreamer=f,t.jQuery){var o=t.jQuery;o.fn.parse=function(e){var r=e.config||{},n=[];return this.each((function(e){if("INPUT"!==o(this).prop("tagName").toUpperCase()||"file"!==o(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)n.push({file:this.files[i],inputElem:this,instanceConfig:o.extend({},r)})})),i(),this;function i(){if(0!==n.length){var t,r,i,u,l=n[0];if(_(e.before)){var c=e.before(l.file,l.inputElem);if("object"==typeof c){if("abort"===c.action)return t="AbortError",r=l.file,i=l.inputElem,u=c.reason,void(_(e.error)&&e.error({name:t},r,i,u));if("skip"===c.action)return void a();"object"==typeof c.config&&(l.instanceConfig=o.extend(l.instanceConfig,c.config))}else if("skip"===c)return void a()}var h=l.instanceConfig.complete;l.instanceConfig.complete=function(e){_(h)&&h(e,l.file,l.inputElem),a()},s.parse(l.file,l.instanceConfig)}else _(e.complete)&&e.complete()}function a(){n.splice(0,1),i()}}}function u(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new d(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&_(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var a=this._partialLine+e;this._partialLine="";var o=this._handle.parse(a,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var u=o.meta.cursor;this._finished||(this._partialLine=a.substring(u-this._baseIndex),this._baseIndex=u),o&&o.data&&(this._rowCount+=o.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:o,workerId:s.WORKER_ID,finished:l});else if(_(this._config.chunk)&&!r){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);o=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!l||!_(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(e){_(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:s.WORKER_ID,error:e,finished:!1})}}function l(e){var t;(e=e||{}).chunkSize||(e.chunkSize=s.RemoteChunkSize),u.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=y(this._chunkLoaded,this),t.onerror=y(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function c(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=s.LocalChunkSize),u.call(this,e);var n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=y(this._chunkLoaded,this),t.onerror=y(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,i)}var a=t.readAsText(e,this._config.encoding);n||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function h(e){var t;u.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function f(e){u.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=y((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=y((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=y((function(){this._streamCleanUp(),n=!0,this._streamData("")}),this),this._streamCleanUp=y((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function d(e){var t,r,n,i=Math.pow(2,53),a=-i,o=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,u=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,l=this,c=0,h=0,f=!1,d=!1,m=[],g={data:[],errors:[],meta:{}};if(_(e.step)){var b=e.step;e.step=function(t){if(g=t,k())Z();else{if(Z(),0===g.data.length)return;c+=t.data.length,e.preview&&c>e.preview?r.abort():(g.data=g.data[0],b(g,l))}}}function y(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function Z(){return g&&n&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+s.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines&&(g.data=g.data.filter((function(e){return!y(e)}))),k()&&function(){if(g)if(Array.isArray(g.data[0])){for(var t=0;k()&&t<g.data.length;t++)g.data[t].forEach(r);g.data.splice(0,1)}else g.data.forEach(r);function r(t,r){_(e.transformHeader)&&(t=e.transformHeader(t,r)),m.push(t)}}(),function(){if(!g||!e.header&&!e.dynamicTyping&&!e.transform)return g;function t(t,r){var n,i=e.header?{}:[];for(n=0;n<t.length;n++){var a=n,s=t[n];e.header&&(a=n>=m.length?"__parsed_extra":m[n]),e.transform&&(s=e.transform(s,a)),s=A(a,s),"__parsed_extra"===a?(i[a]=i[a]||[],i[a].push(s)):i[a]=s}return e.header&&(n>m.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+m.length+" fields but parsed "+n,h+r):n<m.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+m.length+" fields but parsed "+n,h+r)),i}var r=1;return!g.data.length||Array.isArray(g.data[0])?(g.data=g.data.map(t),r=g.data.length):g.data=t(g.data,0),e.header&&g.meta&&(g.meta.fields=m),h+=r,g}()}function k(){return e.header&&0===m.length}function A(t,r){return n=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[n]&&(e.dynamicTyping[n]=e.dynamicTypingFunction(n)),!0===(e.dynamicTyping[n]||e.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(e){if(o.test(e)){var t=parseFloat(e);if(a<t&&t<i)return!0}return!1}(r)?parseFloat(r):u.test(r)?new Date(r):""===r?null:r):r;var n}function x(e,t,r,n){var i={type:e,code:t,message:r};void 0!==n&&(i.row=n),g.errors.push(i)}this.parse=function(i,a,o){var u=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var r=new RegExp(v(t)+"([^]*?)"+v(t),"gm"),n=(e=e.replace(r,"")).split("\r"),i=e.split("\n"),a=1<i.length&&i[0].length<n[0].length;if(1===n.length||a)return"\n";for(var s=0,o=0;o<n.length;o++)"\n"===n[o][0]&&s++;return s>=n.length/2?"\r\n":"\r"}(i,u)),n=!1,e.delimiter)_(e.delimiter)&&(e.delimiter=e.delimiter(i),g.meta.delimiter=e.delimiter);else{var l=function(t,r,n,i,a){var o,u,l,c;a=a||[",","\t","|",";",s.RECORD_SEP,s.UNIT_SEP];for(var h=0;h<a.length;h++){var f=a[h],d=0,v=0,m=0;l=void 0;for(var g=new p({comments:i,delimiter:f,newline:r,preview:10}).parse(t),b=0;b<g.data.length;b++)if(n&&y(g.data[b]))m++;else{var w=g.data[b].length;v+=w,void 0!==l?0<w&&(d+=Math.abs(w-l),l=w):l=w}0<g.data.length&&(v/=g.data.length-m),(void 0===u||d<=u)&&(void 0===c||c<v)&&1.99<v&&(u=d,o=f,c=v)}return{successful:!!(e.delimiter=o),bestDelimiter:o}}(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(n=!0,e.delimiter=s.DefaultDelimiter),g.meta.delimiter=e.delimiter}var c=w(e);return e.preview&&e.header&&c.preview++,t=i,r=new p(c),g=r.parse(t,a,o),Z(),f?{meta:{paused:!0}}:g||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,r.abort(),t=_(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){l.streamer._halted?(f=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return d},this.abort=function(){d=!0,r.abort(),g.meta.aborted=!0,_(e.complete)&&e.complete(g),t=""}}function v(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p(e){var t,r=(e=e||{}).delimiter,n=e.newline,i=e.comments,a=e.step,o=e.preview,u=e.fastMode,l=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof r||-1<s.BAD_DELIMITERS.indexOf(r))&&(r=","),i===r)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<s.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var c=0,h=!1;this.parse=function(e,s,f){if("string"!=typeof e)throw new Error("Input must be a string");var d=e.length,p=r.length,m=n.length,g=i.length,b=_(a),w=[],y=[],Z=[],k=c=0;if(!e)return N();if(u||!1!==u&&-1===e.indexOf(t)){for(var A=e.split(n),x=0;x<A.length;x++){if(Z=A[x],c+=Z.length,x!==A.length-1)c+=n.length;else if(f)return N();if(!i||Z.substring(0,g)!==i){if(b){if(w=[],D(Z.split(r)),M(),h)return N()}else D(Z.split(r));if(o&&o<=x)return w=w.slice(0,o),N(!0)}}return N()}for(var E=e.indexOf(r,c),S=e.indexOf(n,c),I=new RegExp(v(l)+v(t),"g"),O=e.indexOf(t,c);;)if(e[c]!==t)if(i&&0===Z.length&&e.substring(c,c+g)===i){if(-1===S)return N();c=S+m,S=e.indexOf(n,c),E=e.indexOf(r,c)}else if(-1!==E&&(E<S||-1===S))Z.push(e.substring(c,E)),c=E+p,E=e.indexOf(r,c);else{if(-1===S)break;if(Z.push(e.substring(c,S)),F(S+m),b&&(M(),h))return N();if(o&&w.length>=o)return N(!0)}else for(O=c,c++;;){if(-1===(O=e.indexOf(t,O+1)))return f||y.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:c}),z();if(O===d-1)return z(e.substring(c,O).replace(I,t));if(t!==l||e[O+1]!==l){if(t===l||0===O||e[O-1]!==l){-1!==E&&E<O+1&&(E=e.indexOf(r,O+1)),-1!==S&&S<O+1&&(S=e.indexOf(n,O+1));var C=B(-1===S?E:Math.min(E,S));if(e.substr(O+1+C,p)===r){Z.push(e.substring(c,O).replace(I,t)),e[c=O+1+C+p]!==t&&(O=e.indexOf(t,c)),E=e.indexOf(r,c),S=e.indexOf(n,c);break}var R=B(S);if(e.substring(O+1+R,O+1+R+m)===n){if(Z.push(e.substring(c,O).replace(I,t)),F(O+1+R+m),E=e.indexOf(r,c),O=e.indexOf(t,c),b&&(M(),h))return N();if(o&&w.length>=o)return N(!0);break}y.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:c}),O++}}else O++}return z();function D(e){w.push(e),k=c}function B(t){var r=0;if(-1!==t){var n=e.substring(O+1,t);n&&""===n.trim()&&(r=n.length)}return r}function z(t){return f||(void 0===t&&(t=e.substring(c)),Z.push(t),c=d,D(Z),b&&M()),N()}function F(t){c=t,D(Z),Z=[],S=e.indexOf(n,c)}function N(e){return{data:w,errors:y,meta:{delimiter:r,linebreak:n,aborted:h,truncated:!!e,cursor:k+(s||0)}}}function M(){a(N()),w=[],y=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return c}}function m(e){var t=e.data,r=i[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){n=!0,g(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:b,resume:b};if(_(r.userStep)){for(var s=0;s<t.results.data.length&&(r.userStep({data:t.results.data[s],errors:t.results.errors,meta:t.results.meta},a),!n);s++);delete t.results}else _(r.userChunk)&&(r.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!n&&g(t.workerId,t.results)}function g(e,t){var r=i[e];_(r.userComplete)&&r.userComplete(t),r.terminate(),delete i[e]}function b(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=w(e[r]);return t}function y(e,t){return function(){e.apply(t,arguments)}}function _(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===s.WORKER_ID&&r&&(s.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:s.WORKER_ID,results:s.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var n=s.parse(r.input,r.config);n&&t.postMessage({workerId:s.WORKER_ID,results:n,finished:!0})}}),(l.prototype=Object.create(u.prototype)).constructor=l,(c.prototype=Object.create(u.prototype)).constructor=c,(h.prototype=Object.create(h.prototype)).constructor=h,(f.prototype=Object.create(u.prototype)).constructor=f,s},void 0===(i="function"===typeof r?r.apply(t,n):r)||(e.exports=i)},907:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},3878:function(e,t,r){"use strict";function n(e){if(Array.isArray(e))return e}r.d(t,{Z:function(){return n}})},7762:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(181);function i(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=(0,n.Z)(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}},1902:function(e,t,r){"use strict";function n(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(u){o=!0,i=u}finally{try{s||null==r.return||r.return()}finally{if(o)throw i}}return a}}r.d(t,{Z:function(){return n}})},5267:function(e,t,r){"use strict";function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}r.d(t,{Z:function(){return n}})},3324:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(3878),i=r(1902),a=r(181),s=r(5267);function o(e,t){return(0,n.Z)(e)||(0,i.Z)(e,t)||(0,a.Z)(e,t)||(0,s.Z)()}},181:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(907);function i(e,t){if(e){if("string"===typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,n.Z)(e,t):void 0}}},6204:function(e,t,r){"use strict";r.d(t,{Q7:function(){return Wl},bN:function(){return ql},TD:function(){return Tl},TN:function(){return wh},pY:function(){return Nh},Sl:function(){return Zh},Ol:function(){return Pl},us:function(){return Ul},j2:function(){return Th},MM:function(){return Sh},ve:function(){return Mh},t:function(){return Gh},G8:function(){return Oh},x6:function(){return kh},cN:function(){return xh},v9:function(){return Kc},rF:function(){return ma},ED:function(){return ga},$p:function(){return Jl},gj:function(){return Wh}});var n={};r.r(n),r.d(n,{Reader:function(){return Ea},abbreviate:function(){return Za},preflight:function(){return Aa},unserialize:function(){return Sa}});var i={};r.r(i),r.d(i,{Reader:function(){return za},abbreviate:function(){return Oa},preflight:function(){return Da},unserialize:function(){return Fa}});var a={};r.r(a),r.d(a,{Reader:function(){return Pa},abbreviate:function(){return Ma},preflight:function(){return ja},unserialize:function(){return La}});var s={};r.r(s),r.d(s,{Reader:function(){return us},abbreviate:function(){return Ha},preflight:function(){return as},unserialize:function(){return ls}});var o=r(7762),u=r(907);var l=r(181);function c(e){return function(e){if(Array.isArray(e))return(0,u.Z)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,l.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=r(3324),f=r(5861),d=r(4942);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=r(5671),g=r(3144),b=r(864);function w(e,t){(0,b.Z)(e,t),t.add(e)}var y=r(2346);function _(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function Z(e,t,r){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),r}var k=r(6033),A=r(3092),x=r(7757),E=r(8782),S=r(6635),I=r(2979),O=r(2306);function C(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.compressed,a=void 0===i?null:i,s=n.layered,o=void 0===s||s,u=null;try{a=R(a),"string"!==typeof e?(t=S.de(e,"Uint8WasmArray"),r=I.R((function(e){return e.read_matrix_market_from_buffer(t.offset,t.length,a,o)}),O.p)):r=I.R((function(t){return t.read_matrix_market_from_file(e,a,o)}),O.p),r.isReorganized()&&(u=r.identities(),r.wipeIdentities())}catch(l){throw S.gd(r),l}finally{S.gd(t)}return{matrix:r,row_ids:u}}function R(e){return null===e?-1:e?1:0}function D(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.compressed,i=void 0===n?null:n,a=S.RJ(3),s={};try{i=R(i),"string"!==typeof e?(t=S.de(e,"Uint8WasmArray"),E.RE((function(e){return e.read_matrix_market_header_from_buffer(t.offset,t.length,i,a.offset)}))):E.RE((function(t){return t.read_matrix_market_header_from_file(e,i,a.offset)}));var o=a.array();s.rows=o[0],s.columns=o[1],s.lines=o[2]}finally{S.gd(t),S.gd(a)}return s}function B(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.layered,a=void 0===i||i,s=null;try{(r=I.R((function(r){return r.read_hdf5_matrix(e,t,a)}),O.p)).isReorganized()&&(s=r.identities(),r.wipeIdentities())}catch(o){throw S.gd(r),o}return{matrix:r,row_ids:s}}var z=r(7326),F=r(136),N=r(9388);function M(e,t){var r,n=new TextDecoder,i=[],a=0,s=(0,o.Z)(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,l=e.slice(a,a+u);i.push(n.decode(l)),a+=u}}catch(bn){s.e(bn)}finally{s.f()}return i}function G(e){var t,r,n,i=(0,o.Z)(e);try{for(i.s();!(n=i.n()).done;){if("string"!=typeof n.value)throw new Error("all entries of 'x' should be strings for a string HDF5 dataset")}}catch(bn){i.e(bn)}finally{i.f()}try{var a=(r=S.Wf(e.length)).array(),s=0,u=new TextEncoder,l=new Array(e.length);e.forEach((function(e,t){var r=u.encode(e);a[t]=r.length,l[t]=r,s+=r.length}));var c=(t=S.TS(s)).array();s=0,l.forEach((function(e){c.set(e,s),s+=e.length}))}catch(h){throw S.gd(t),S.gd(r),h}return[r,t]}function W(e,t){if(t.length>0){var r=t.reduce((function(e,t){return e*t}));if(e.length!=r)throw new Error("length of 'x' must be equal to the product of 'shape'")}else if(e instanceof Array||ArrayBuffer.isView(e)){if(1!=e.length)throw new Error("length of 'x' should be 1 for a scalar dataset")}else e=[e];return e}function j(e,t){return null===t?"string"==typeof e||"number"==typeof e?(e=[e],t=[]):t=[e.length]:e=W(e,t),{x:e,shape:t}}function T(e){if(Array.isArray(e)){var t,r=(0,o.Z)(e);try{for(r.s();!(t=r.n()).done;){if("string"===typeof t.value)throw new Error("'x' should not contain any strings for a non-string HDF5 dataset")}}catch(bn){r.e(bn)}finally{r.f()}}}function U(e){var t=0;return e.array().forEach((function(e){t<e&&(t=e)})),t}var Q=new WeakMap,q=new WeakMap,P=new WeakMap,L=new WeakSet,V=function(){function e(t,r){(0,m.Z)(this,e),w(this,L),(0,y.Z)(this,Q,{writable:!0,value:void 0}),(0,y.Z)(this,q,{writable:!0,value:void 0}),(0,y.Z)(this,P,{writable:!0,value:void 0}),(0,A.Z)(this,Q,t),(0,A.Z)(this,q,r)}return(0,g.Z)(e,[{key:"file",get:function(){return(0,k.Z)(this,Q)}},{key:"name",get:function(){return(0,k.Z)(this,q)}},{key:"attributes",get:function(){return(0,k.Z)(this,P)}},{key:"set_attributes",value:function(e){(0,A.Z)(this,P,e)}},{key:"readAttribute",value:function(e){var t,r,n=this,i=E.RE((function(t){return new t.LoadedH5Attr(n.file,n.name,e)}));try{r=Array.from(i.shape());var a=i.type();if("other"==a)throw new Error("cannot load dataset for an unsupported type");t="String"==a?M(i.values(),i.lengths()):i.values().slice()}finally{i.delete()}return{values:t,shape:r}}},{key:"writeAttribute",value:function(e,t,r,n){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=a.maxStringLength,o=void 0===s?null:s;if(null===n)throw new Error("cannot write 'null' to HDF5");var u=j(n,r);if(n=u.x,r=u.shape,"String"==t){var l=G(n),c=(0,h.Z)(l,2),f=c[0],d=c[1];try{null==o&&(o=U(f)),_(this,L,H).call(this,e,t,r,{maxStringLength:o}),E.RE((function(t){return t.write_string_hdf5_attribute(i.file,i.name,e,f.length,f.offset,d.offset)}))}finally{S.gd(d),S.gd(f)}}else{T(n);var v=S.de(n,null);try{_(this,L,H).call(this,e,t,r),E.RE((function(t){return t.write_numeric_hdf5_attribute(i.file,i.name,e,v.constructor.className,v.offset)}))}finally{v.free()}}}}]),e}();function H(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=i.maxStringLength,s=void 0===a?10:a,o=S.de(r,"Int32WasmArray");try{E.RE((function(r){return r.create_hdf5_attribute(n.file,n.name,e,t,o.length,o.offset,s)})),(0,k.Z)(this,P).push(e)}finally{o.free()}}var Y=new WeakMap,J=new WeakMap,X=new WeakSet,K=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.newlyCreated,o=void 0!==s&&s;if((0,m.Z)(this,r),i=t.call(this,e,n),w((0,z.Z)(i),X),(0,y.Z)((0,z.Z)(i),Y,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),J,{writable:!0,value:void 0}),o)(0,A.Z)((0,z.Z)(i),Y,{}),i.set_attributes([]);else{var u=E.RE((function(t){return new t.H5GroupDetails(e,n)}));try{var l=M(u.child_buffer(),u.child_lengths()),c=u.child_types(),h=["Group","DataSet","Other"];(0,A.Z)((0,z.Z)(i),Y,{});for(var f=0;f<l.length;f++)(0,k.Z)((0,z.Z)(i),Y)[l[f]]=h[c[f]];var d=M(u.attr_buffer(),u.attr_lengths());i.set_attributes(d)}finally{u.delete()}}return i}return(0,g.Z)(r,[{key:"children",get:function(){return(0,k.Z)(this,Y)}},{key:"open",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=_(this,X,$).call(this,e);if(e in(0,k.Z)(this,Y)){if("Group"==(0,k.Z)(this,Y)[e])return new r(this.file,n,t);if("DataSet"==(0,k.Z)(this,Y)[e])return new se(this.file,n,t);throw new Error("don't know how to open '"+e+"'")}throw new Error("no '"+e+"' child in this HDF5 Group")}},{key:"createGroup",value:function(e){var t=this,n=_(this,X,$).call(this,e);if(e in this.children){if("Group"==this.children[e])return new r(this.file,n);throw new Error("existing child '"+n+"' is not a HDF5 group")}return E.RE((function(e){return e.create_hdf5_group(t.file,n)})),this.children[e]="Group",new r(this.file,n,{newlyCreated:!0})}},{key:"createDataSet",value:function(e,t,r){var n,i,a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=s.maxStringLength,u=void 0===o?10:o,l=s.compression,c=void 0===l?6:l,h=s.chunks,f=void 0===h?null:h,d=_(this,X,$).call(this,e);try{var v=(n=S.de(r,"Int32WasmArray")).offset;if(null!==f){if((i=S.de(f,"Int32WasmArray")).length!=n.length)throw new Error("'chunks' and 'shape' should have the same dimensions");v=i.offset}E.RE((function(e){return e.create_hdf5_dataset(a.file,d,t,n.length,n.offset,u,c,v)}))}finally{n.free()}return this.children[e]="DataSet",new se(this.file,d,{newlyCreated:!0,type:t,shape:r})}},{key:"writeDataSet",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i.compression,s=void 0===a?6:a,o=i.chunks,u=void 0===o?null:o,l=i.cache,c=void 0!==l&&l;if(null===n)throw new Error("cannot write 'null' to HDF5");var f,d=j(n,r);if(n=d.x,r=d.shape,"String"==t){var v=G(n),p=(0,h.Z)(v,2),m=p[0],g=p[1];try{var b=U(m);f=this.createDataSet(e,"String",r,{maxStringLength:b,compression:s,chunks:u}),E.RE((function(e){return e.write_string_hdf5_dataset(f.file,f.name,m.length,m.offset,g.offset)}))}finally{S.gd(m),S.gd(g)}f.cache_loaded(n,c)}else(f=this.createDataSet(e,t,r,{compression:s,chunks:u})).write(n,{cache:c});return f}}]),r}(V);function $(e){var t=this.name;return"/"!=t&&(t+="/"),t+=e}var ee=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.Z)(this,r),t.call(this,e,"/",n)}return(0,g.Z)(r)}(K);function te(e){return E.RE((function(t){return t.create_hdf5_file(e)})),new ee(e,{newlyCreated:!0})}var re=new WeakMap,ne=new WeakMap,ie=new WeakMap,ae=new WeakMap,se=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.load,o=void 0!==s&&s,u=a.newlyCreated,l=void 0!==u&&u,c=a.shape,h=void 0===c?null:c,f=a.type,d=void 0===f?null:f,v=a.values,p=void 0===v?null:v;if((0,m.Z)(this,r),i=t.call(this,e,n),(0,y.Z)((0,z.Z)(i),re,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),ne,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),ie,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),ae,{writable:!0,value:void 0}),l){if(null===h||null===d)throw new Error("need to pass 'shape' and 'type' if 'newlyCreated = true'");(0,A.Z)((0,z.Z)(i),re,h),(0,A.Z)((0,z.Z)(i),ne,d),(0,A.Z)((0,z.Z)(i),ie,p),(0,A.Z)((0,z.Z)(i),ae,null!==p),i.set_attributes([])}else{if(o){var g=Z(r,r,oe).call(r,e,n);(0,A.Z)((0,z.Z)(i),ne,g.type),(0,A.Z)((0,z.Z)(i),re,g.shape),(0,A.Z)((0,z.Z)(i),ie,g.values),i.set_attributes(g.attributes)}else{var b=E.RE((function(t){return new t.H5DataSetDetails(e,n)}));try{(0,A.Z)((0,z.Z)(i),ne,b.type()),(0,A.Z)((0,z.Z)(i),re,Array.from(b.shape())),(0,A.Z)((0,z.Z)(i),ie,null),i.set_attributes(M(b.attr_buffer(),b.attr_lengths()))}finally{b.delete()}}(0,A.Z)((0,z.Z)(i),ae,o)}return i}return(0,g.Z)(r,[{key:"type",get:function(){return(0,k.Z)(this,ne)}},{key:"shape",get:function(){return(0,k.Z)(this,re)}},{key:"loaded",get:function(){return(0,k.Z)(this,ae)}},{key:"values",get:function(){return(0,k.Z)(this,ie)}},{key:"load",value:function(){if(!(0,k.Z)(this,ae)){var e=Z(r,r,oe).call(r,this.file,this.name);(0,A.Z)(this,ie,e.values),(0,A.Z)(this,ae,!0)}return(0,k.Z)(this,ie)}},{key:"cache_loaded",value:function(e,t){t?((0,A.Z)(this,ie,e.slice()),(0,A.Z)(this,ae,!0)):((0,A.Z)(this,ae,!1),(0,A.Z)(this,ie,null))}},{key:"write",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.cache,i=void 0!==n&&n;if(null===e)throw new Error("cannot write 'null' to HDF5");if(e=W(e,this.shape),"String"==this.type){var a=G(e),s=(0,h.Z)(a,2),o=s[0],u=s[1];try{E.RE((function(e){return e.write_string_hdf5_dataset(t.file,t.name,o.length,o.offset,u.offset)}))}finally{S.gd(u),S.gd(o)}this.cache_loaded(e,i)}else{T(e);var l=S.de(e,null);try{E.RE((function(e){return e.write_numeric_hdf5_dataset(t.file,t.name,l.constructor.className,l.offset)})),this.cache_loaded(l,i)}finally{l.free()}}}}]),r}(V);function oe(e,t){var r,n,i,a,s=E.RE((function(r){return new r.LoadedH5DataSet(e,t)}));try{if("other"==(n=s.type()))throw new Error("cannot load dataset for an unsupported type");r="String"==n?M(s.values(),s.lengths()):s.values().slice(),i=Array.from(s.shape()),a=M(s.attr_buffer(),s.attr_lengths())}finally{s.delete()}return{values:r,type:n,shape:i,attributes:a}}var ue=function(){function e(t,r,n){(0,m.Z)(this,e),this.id=t,this.object=r,this.parent=n}return(0,g.Z)(e,[{key:"type",value:function(){return this.object.type()}},{key:"free",value:function(){null!==this.object&&(I.A(this.id),this.object=null)}}]),e}(),le=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"length",value:function(){return this.object.size()}},{key:"attributeNames",value:function(){var e=this;return E.RE((function(t){return e.object.fill_attribute_names(),M(e.object.attribute_names_buffer(),e.object.attribute_names_length())}))}},{key:"findAttribute",value:function(e){var t=this;return E.RE((function(r){return t.object.find_attribute(e)}))}},{key:"attribute",value:function(e){var t=this;return ge("number"==typeof e?function(r){return t.object.load_attribute_by_index(e)}:function(r){return t.object.load_attribute_by_name(e)},this.parent)}}]),r}(ue),ce=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"values",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj(this.object.numeric_vector(),r)}}]),r}(le),he=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"values",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj(this.object.numeric_vector(),r)}}]),r}(le),fe=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"values",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj(this.object.numeric_vector(),r)}}]),r}(le),de=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"values",value:function(){var e=this;return E.RE((function(t){return e.object.fill_string_vector(),M(e.object.string_vector_buffer(),e.object.string_vector_length())}))}}]),r}(le),ve=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"load",value:function(e){var t=this;return ge((function(r){return t.object.load_list_element(e)}),this.parent)}}]),r}(le),pe=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r,[{key:"className",value:function(){var e=this;return E.RE((function(t){return e.object.class_name()}))}},{key:"packageName",value:function(){var e=this;return E.RE((function(t){return e.object.package_name()}))}},{key:"attributeNames",value:function(){var e=this;return E.RE((function(t){return e.object.fill_attribute_names(),M(e.object.attribute_names_buffer(),e.object.attribute_names_length())}))}},{key:"findAttribute",value:function(e){var t=this;return E.RE((function(r){return t.object.find_attribute(e)}))}},{key:"attribute",value:function(e){var t=this;return ge("number"==typeof e?function(r){return t.object.load_attribute_by_index(e)}:function(r){return t.object.load_attribute_by_name(e)},this.parent)}}]),r}(ue),me=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){return(0,m.Z)(this,r),t.call(this,e,n,i)}return(0,g.Z)(r)}(le);function ge(e,t){var r,n=E.RE(e),i=null;try{i=n.type()}catch(a){throw n.delete(),a}return r="integer"==i?ce:"double"==i?fe:"boolean"==i?he:"string"==i?de:"vector"==i?ve:"S4"==i?pe:"null"==i?me:ue,I.R((function(e){return n}),r,t)}var be=new WeakMap,we=new WeakMap,ye=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,be,{writable:!0,value:void 0}),(0,y.Z)(this,we,{writable:!0,value:void 0}),(0,A.Z)(this,be,t),(0,A.Z)(this,we,r)}return(0,g.Z)(e,[{key:"formatVersion",value:function(){return(0,k.Z)(this,we).format_version()}},{key:"writerVersion",value:function(){var e=(0,k.Z)(this,we).writer_version();return String(e[0])+"."+String(e[1])+"."+String(e[2])}},{key:"readerVersion",value:function(){var e=(0,k.Z)(this,we).reader_version();return String(e[0])+"."+String(e[1])+"."+String(e[2])}},{key:"value",value:function(){var e=this;return ge((function(t){return(0,k.Z)(e,we).load()}),this)}},{key:"free",value:function(){null!==(0,k.Z)(this,we)&&(I.A((0,k.Z)(this,be)),(0,A.Z)(this,we,null))}}]),e}();function _e(e){var t,r;try{"string"==typeof e?r=I.R((function(t){return t.parse_rds_from_file(e)}),ye):(t=S.de(e,"Uint8WasmArray"),r=I.R((function(e){return e.parse_rds_from_buffer(t.offset,t.length)}),ye))}finally{S.gd(t)}return r}function Ze(e,t){if(null!==e){var r=new t.constructor(e.length);return e.forEach((function(e,n){r[n]=t[e]})),r}return t.slice()}function ke(e,t){if(e instanceof O.p)throw new Error("supplying a ScranMatrix is deprecated");var r,n=e;if(null===n)r=t.length;else if(r=e.length,t.length!=r)throw new Error("length of 'x' should be the same as length of 'old'");var i=!0;if(null!==n){var a,s=(0,o.Z)(n.entries());try{for(s.s();!(a=s.n()).done;){var u=(0,h.Z)(a.value,2),l=u[0],c=u[1];if(t[l]!=c){i=!1;break}}}catch(bn){s.e(bn)}finally{s.f()}}else{var f,d=(0,o.Z)(t.entries());try{for(d.s();!(f=d.n()).done;){var v=(0,h.Z)(f.value,2),p=v[0];if(v[1]!=p){i=!1;break}}}catch(bn){d.e(bn)}finally{d.f()}}if(i)return null;var m={};t.forEach((function(e,t){m[e]=t}));var g=new Int32Array(r);if(null!==n)for(var b=0;b<n.length;b++){var w=n[b];if(!(w in m))throw new Error("mismatch in row identities between 'x' and 'old'");g[b]=m[w]}else for(var y=0;y<r;y++){if(!(y in m))throw new Error("mismatch in row identities between 'x' and 'old'");g[y]=m[y]}return g}function Ae(e){var t=0;e.forEach((function(e){e&&e.match(/^ENSG[0-9]{11}$/)&&t++}));var r=0;e.forEach((function(e){e&&e.match(/^[A-Z][^a-z]+$/)&&!e.match(/^ENS[A-Z]+[0-9]{11}/)&&r++}));var n=0;e.forEach((function(e){e&&e.match(/^ENSMUSG[0-9]{11}$/)&&n++}));var i=0;e.forEach((function(e){e&&e.match(/^[A-Z][^A-Z]+$/)&&i++}));for(var a=[{species:"human",type:"ensembl",confidence:t},{species:"human",type:"symbol",confidence:r},{species:"mouse",type:"ensembl",confidence:n},{species:"mouse",type:"symbol",confidence:i}],s=a[0],o=1;o<a.length;o++)a[o].confidence>s.confidence&&(s=a[o]);return s.confidence/=e.length,s}var xe=r(6737);function Ee(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.filter,i=void 0===n?null:n,a={},s=[];try{for(var u=function(){var e=(0,h.Z)(c[l],2),r=e[0],n=e[1],s=void 0;if(null===i)s=new n.constructor(t.length),t.forEach((function(e,t){s[t]=n[e]}));else{if(t.length!==n.length)throw new Error("'subset' and each value of 'x' should have the same length");var o=t;t instanceof xe.PQ&&(o=t.array()),s=i?n.filter((function(e,t){return!o[t]})):n.filter((function(e,t){return!!o[t]}))}a[r]=s},l=0,c=Object.entries(e);l<c.length;l++)u()}catch(p){var f,d=(0,o.Z)(s);try{for(d.s();!(f=d.n()).done;){var v=f.value;v.free()}}catch(bn){d.e(bn)}finally{d.f()}throw p}return a}function Se(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.filter,a=void 0===i?null:i,s=n.buffer,o=void 0===s?null:s,u=0;if(null===a)u=t.length;else{if(t.length!=e.length)throw new Error("'x' and 'filter' should have the same length");var l=0;t.forEach((function(e){l+=0!=e})),u=a?t.length-l:l}try{if(null==o)o=r=S.Wf(u);else if(o.length!==u)throw new Error("length of 'buffer' is not consistent with 'subset'");var c=o.array(),h=e.array();if(null==a)t.forEach((function(e,t){c[t]=h[e]}));else if(a){var f=0;t.forEach((function(e,t){0==e&&(c[f]=h[t],f++)}))}else{var d=0;t.forEach((function(e,t){0!==e&&(c[d]=h[t],d++)}))}}catch(v){throw S.gd(r),v}return o}function Ie(e){for(var t=S.GF(e.length),r=t.array(),n=0;n<e.length;n++)r[n]=BigInt(e[n].matrix.$$.ptr);return t}var Oe=new WeakMap,Ce=new WeakMap,Re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.store,n=void 0===r?{}:r;(0,m.Z)(this,e),(0,y.Z)(this,Oe,{writable:!0,value:void 0}),(0,y.Z)(this,Ce,{writable:!0,value:void 0}),(0,A.Z)(this,Oe,n),(0,A.Z)(this,Ce,null);var i=Object.keys(n);if(i.length)for(var a=0;a<i.length;a++){var s=n[i[a]];if(0==a)(0,A.Z)(this,Ce,s.numberOfColumns());else if(s.numberOfColumns()!=(0,k.Z)(this,Ce))throw new Error("all matrices should have the same number of columns")}}return(0,g.Z)(e,[{key:"numberOfColumns",value:function(){return(0,k.Z)(this,Ce)}},{key:"available",value:function(){return Object.keys((0,k.Z)(this,Oe))}},{key:"has",value:function(e){return e in(0,k.Z)(this,Oe)}},{key:"get",value:function(e){return(0,k.Z)(this,Oe)[e]}},{key:"add",value:function(e,t){if(null===(0,k.Z)(this,Ce))(0,A.Z)(this,Ce,t.numberOfColumns());else if(t.numberOfColumns()!=(0,k.Z)(this,Ce))throw new Error("all matrices should have the same number of columns");if(e in(0,k.Z)(this,Oe)){var r=(0,k.Z)(this,Oe)[e];S.gd(r)}(0,k.Z)(this,Oe)[e]=t}},{key:"remove",value:function(e){S.gd((0,k.Z)(this,Oe)[e]),delete(0,k.Z)(this,Oe)[e],0==Object.keys((0,k.Z)(this,Oe)).length&&(0,A.Z)(this,Ce,null)}},{key:"rename",value:function(e,t){e!==t&&(t in(0,k.Z)(this,Oe)&&S.gd((0,k.Z)(this,Oe)[t]),(0,k.Z)(this,Oe)[t]=(0,k.Z)(this,Oe)[e],delete(0,k.Z)(this,Oe)[e])}},{key:"free",value:function(){for(var e=0,t=Object.entries((0,k.Z)(this,Oe));e<t.length;e++){var r=(0,h.Z)(t[e],2),n=(r[0],r[1]);S.gd(n)}}}]),e}();function De(e,t){var r,n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.inPlace,o=void 0!==s&&s;try{o?n=e:(r=e.clone(),n=r),i=S.de(t,"Int32WasmArray"),E.RE((function(e){return e.row_subset(n.matrix,i.offset,i.length)}))}catch(u){throw S.gd(r),u}finally{S.gd(i)}return n}function Be(e,t){var r,n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.inPlace,o=void 0!==s&&s;try{o?n=e:(r=e.clone(),n=r),i=S.de(t,"Int32WasmArray"),E.RE((function(e){return e.column_subset(n.matrix,i.offset,i.length)}))}catch(u){throw S.gd(r),u}finally{S.gd(i)}return n}function ze(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.singleNull,a=void 0!==i&&i,s=n.createMultiMatrix,o=void 0!==s&&s,u={},l=Object.keys(t);if(1==l.length)return a?null:(u[l[0]]=e.clone(),u);try{for(var c=0,h=l;c<h.length;c++){var f=h[c];u[f]=De(e,t[f])}o&&(r=new Re({store:u}))}catch(m){for(var d=0,v=Object.values(u);d<v.length;d++){var p=v[d];p.free()}throw m}return o?r:u}r(5219);function Fe(e,t,r){var n,i,a=[];try{var s=0,o=0;if(null!=t){s=t.length,o=(i=S.GF(s)).offset;for(var u=i.array(),l=0;l<s;l++){var c=S.de(t[l],"Uint8WasmArray");if(c.length!=e.numberOfRows())throw new Error("length of each array in 'subsets' should be equal to the matrix rows");a.push(c),u[l]=BigInt(c.offset)}}n=r(e.matrix,s,o)}catch(v){throw S.gd(n),v}finally{S.gd(i);for(var h=0,f=a;h<f.length;h++){var d=f[h];S.gd(d)}}return n}var Ne=new WeakMap,Me=new WeakMap,Ge=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Ne,{writable:!0,value:void 0}),(0,y.Z)(this,Me,{writable:!0,value:void 0}),(0,A.Z)(this,Ne,t),(0,A.Z)(this,Me,r)}return(0,g.Z)(e,[{key:"results",get:function(){return(0,k.Z)(this,Me)}},{key:"sums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Me).sums(),r)}},{key:"detected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Me).detected(),r)}},{key:"subsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,Me).subset_proportions(e),n)}},{key:"isProportion",value:function(){return(0,k.Z)(this,Me).is_proportion()}},{key:"numberOfSubsets",value:function(){return(0,k.Z)(this,Me).num_subsets()}},{key:"free",value:function(){null!==(0,k.Z)(this,Me)&&(I.A((0,k.Z)(this,Ne)),(0,A.Z)(this,Me,null))}}]),e}();var We=new WeakMap,je=new WeakMap,Te=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,We,{writable:!0,value:void 0}),(0,y.Z)(this,je,{writable:!0,value:void 0}),(0,A.Z)(this,We,t),(0,A.Z)(this,je,r)}return(0,g.Z)(e,[{key:"results",get:function(){return(0,k.Z)(this,je)}},{key:"sums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,je).sums(),r)}},{key:"detected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,je).detected(),r)}},{key:"subsetTotals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,je).subset_totals(e),n)}},{key:"numberOfSubsets",value:function(){return(0,k.Z)(this,je).num_subsets()}},{key:"free",value:function(){null!==(0,k.Z)(this,je)&&(I.A((0,k.Z)(this,We)),(0,A.Z)(this,je,null))}}]),e}();function Ue(e,t,r,n){var i,a;try{var s=0,o=!1;if(null!==t){if((i=S.de(t,"Int32WasmArray")).length!=r(e))throw new Error("'block' must be of length equal to the number of cells in 'metrics'");o=!0,s=i.offset}a=n(e,o,s)}catch(u){throw S.gd(a),u}finally{S.gd(i)}return a}var Qe=new WeakMap,qe=new WeakMap,Pe=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Qe,{writable:!0,value:void 0}),(0,y.Z)(this,qe,{writable:!0,value:void 0}),(0,A.Z)(this,Qe,t),(0,A.Z)(this,qe,r)}return(0,g.Z)(e,[{key:"discardSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,qe).discard_sums(),r)}},{key:"discardDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,qe).discard_detected(),r)}},{key:"discardSubsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,qe).discard_proportions(e),n)}},{key:"discardOverall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,qe).discard_overall(),r)}},{key:"thresholdsSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,qe).thresholds_sums(),r)}},{key:"thresholdsDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,qe).thresholds_detected(),r)}},{key:"thresholdsSubsetProportions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,qe).thresholds_proportions(e),n)}},{key:"numberOfSubsets",value:function(){return(0,k.Z)(this,qe).num_subsets()}},{key:"free",value:function(){null!==(0,k.Z)(this,qe)&&(I.A((0,k.Z)(this,Qe)),(0,A.Z)(this,qe,null))}}]),e}();var Le=new WeakMap,Ve=new WeakMap,He=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Le,{writable:!0,value:void 0}),(0,y.Z)(this,Ve,{writable:!0,value:void 0}),(0,A.Z)(this,Ve,t),(0,A.Z)(this,Le,r)}return(0,g.Z)(e,[{key:"discardDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Le).discard_detected(),r)}},{key:"discardSubsetTotals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,Le).discard_subset_totals(e),n)}},{key:"discardOverall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Le).discard_overall(),r)}},{key:"thresholdsDetected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Le).thresholds_detected(),r)}},{key:"thresholdsSubsetTotals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r;return S.Yj((0,k.Z)(this,Le).thresholds_subset_totals(e),n)}},{key:"numberOfSubsets",value:function(){return(0,k.Z)(this,Le).num_subsets()}},{key:"free",value:function(){null!==(0,k.Z)(this,Le)&&(I.A((0,k.Z)(this,Ve)),(0,A.Z)(this,Le,null))}}]),e}();function Ye(e,t){var r,n;try{var i;if(t instanceof Pe){var a=t.discardOverall({copy:!1});i=a.byteOffset}else{if((r=S.de(t,"Uint8WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'filters' must be equal to number of columns in 'x'");i=r.offset}n=I.R((function(t){return t.filter_cells(e.matrix,i,!1)}),e.constructor)}catch(s){throw S.gd(n),s}finally{S.gd(r)}return n}r(845);function Je(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.center,s=void 0===a||a,o=i.buffer,u=void 0===o?null:o,l=i.priorCount,c=void 0===l?10:l,h=i.reference,f=void 0===h?null:h,d=i.numberOfThreads,v=void 0===d?null:d,p=S.mV(v);try{if(u instanceof xe.lt){if(u.length!==e.numberOfColumns())throw new Error("length of 'buffer' must be equal to the number of columns in 'x'")}else r=S.RJ(e.numberOfColumns()),u=r;n=S.de(t,"Int32WasmArray"),null==f&&(f=-1),E.RE((function(t){return t.grouped_size_factors(e.matrix,n.offset,s,c,f,u.offset,p)}))}catch(m){throw S.gd(r),m}finally{S.gd(n)}return u}var Xe=new WeakMap,Ke=new WeakMap,$e=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Xe,{writable:!0,value:void 0}),(0,y.Z)(this,Ke,{writable:!0,value:void 0}),(0,A.Z)(this,Xe,t),(0,A.Z)(this,Ke,r)}return(0,g.Z)(e,[{key:"principalComponents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Ke).pcs(),r)}},{key:"varianceExplained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,Ke).variance_explained(),r)}},{key:"totalVariance",value:function(){return(0,k.Z)(this,Ke).total_variance()}},{key:"numberOfPCs",value:function(){return(0,k.Z)(this,Ke).num_pcs()}},{key:"numberOfCells",value:function(){return this.principalComponents({copy:!1}).length/this.numberOfPCs()}},{key:"free",value:function(){null!==(0,k.Z)(this,Ke)&&(I.A((0,k.Z)(this,Xe)),(0,A.Z)(this,Ke,null))}}]),e}();function et(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.features,s=void 0===a?null:a,o=i.numberOfPCs,u=void 0===o?25:o,l=i.scale,c=void 0!==l&&l,h=i.block,f=void 0===h?null:h,d=i.blockMethod,v=void 0===d?"regress":d,p=i.numberOfThreads,m=void 0===p?null:p;S.c2("blockMethod",v,["none","regress","weight","block"]);var g=S.mV(m);try{var b=!1,w=0;if(null!==s){if((t=S.de(s,"Uint8WasmArray")).length!=e.numberOfRows())throw new Error("length of 'features' should be equal to number of rows in 'x'");b=!0,w=t.offset}if(u=Math.min(u,e.numberOfRows()-1,e.numberOfColumns()-1),null===f||"none"==v)n=I.R((function(t){return t.run_pca(e.matrix,u,b,w,c,g)}),$e);else{if((r=S.de(f,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'block' should be equal to the number of columns in 'x'");if("regress"==v||"block"==v)n=I.R((function(t){return t.run_blocked_pca(e.matrix,u,b,w,c,r.offset,g)}),$e);else{if("weight"!=v)throw new Error("unknown value '"+v+"' for 'blockMethod='");n=I.R((function(t){return t.run_multibatch_pca(e.matrix,u,b,w,c,r.offset,g)}),$e)}}}catch(y){throw S.gd(n),y}finally{S.gd(t),S.gd(r)}return n}var tt=new WeakMap,rt=new WeakMap,nt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,tt,{writable:!0,value:void 0}),(0,y.Z)(this,rt,{writable:!0,value:void 0}),(0,A.Z)(this,rt,r),(0,A.Z)(this,tt,t)}return(0,g.Z)(e,[{key:"numberOfCells",value:function(){return(0,k.Z)(this,rt).num_obs()}},{key:"numberOfClusters",value:function(){return(0,k.Z)(this,rt).num_clusters()}},{key:"clusters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,rt).clusters(),r)}},{key:"clusterSizes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,rt).cluster_sizes(),r)}},{key:"withinClusterSumSquares",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,rt).wcss(),r)}},{key:"clusterCenters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,rt).centers(),r)}},{key:"iterations",value:function(){return(0,k.Z)(this,rt).iterations()}},{key:"status",value:function(){return(0,k.Z)(this,rt).status()}},{key:"free",value:function(){null!==(0,k.Z)(this,rt)&&(I.A((0,k.Z)(this,tt)),(0,A.Z)(this,rt,null))}}]),e}();function it(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.numberOfDims,s=void 0===a?null:a,o=i.numberOfCells,u=void 0===o?null:o,l=i.initMethod,c=void 0===l?"pca-part":l,h=i.initSeed,f=void 0===h?5768:h,d=i.initPCASizeAdjust,v=void 0===d?1:d,p=i.numberOfThreads,m=void 0===p?null:p,g=S.mV(m);try{var b;if(e instanceof $e){s=e.numberOfPCs(),u=e.numberOfCells();var w=e.principalComponents({copy:!1});b=w.byteOffset}else{if(null===s||null===u)throw new Error("'numberOfDims' and 'numberOfCells' must be specified when 'x' is an Array");if((r=S.de(e,"Float64WasmArray")).length!=s*u)throw new Error("length of 'x' must be the product of 'numberOfDims' and 'numberOfCells'");b=r.offset}n=I.R((function(e){return e.cluster_kmeans(b,s,u,t,c,f,v,g)}),nt)}catch(y){throw S.gd(n),y}finally{S.gd(r)}return n}function at(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.sizeFactors,s=void 0===a?null:a,o=i.block,u=void 0===o?null:o,l=i.allowZeros,c=void 0!==l&&l;try{var h=0,f=!1;if(null!==s){if((t=S.de(s,"Float64WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'sizeFactors' must be equal to number of columns in 'x'");h=t.offset,f=!0}var d=0,v=!1;if(null!==u){if((r=S.de(u,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");v=!0,d=r.offset}n=I.R((function(t){return t.log_norm_counts(e.matrix,f,h,v,d,c)}),e.constructor)}catch(p){throw S.gd(n),p}finally{S.gd(t),S.gd(r)}return n}var st=r(4812),ot=(r(6199),new WeakMap),ut=new WeakMap,lt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,ot,{writable:!0,value:void 0}),(0,y.Z)(this,ut,{writable:!0,value:void 0}),(0,A.Z)(this,ot,t),(0,A.Z)(this,ut,r)}return(0,g.Z)(e,[{key:"numberOfCells",value:function(){return(0,k.Z)(this,ut).num_obs()}},{key:"numberOfDims",value:function(){return(0,k.Z)(this,ut).num_dim()}},{key:"free",value:function(){null!==(0,k.Z)(this,ut)&&(I.A((0,k.Z)(this,ot)),(0,A.Z)(this,ut,null))}},{key:"index",get:function(){return(0,k.Z)(this,ut)}}]),e}();var ct=new WeakMap,ht=new WeakMap,ft=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,ct,{writable:!0,value:void 0}),(0,y.Z)(this,ht,{writable:!0,value:void 0}),(0,A.Z)(this,ct,t),(0,A.Z)(this,ht,r)}return(0,g.Z)(e,[{key:"size",value:function(){return(0,k.Z)(this,ht).size()}},{key:"numberOfCells",value:function(){return(0,k.Z)(this,ht).num_obs()}},{key:"results",get:function(){return(0,k.Z)(this,ht)}},{key:"serialize",value:function(){var e,t,r,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.runs,s=void 0===a?null:a,o=i.indices,u=void 0===o?null:o,l=i.distances,c=void 0===l?null:l,h=(null===s)+(null===u)+(null===c);if(3!=h&&0!=h)throw new Error("either all or none of 'runs', 'indices' and 'distances' can be 'null'");if(3===h)try{t=S.Wf(this.numberOfCells());var f=this.size();r=S.Wf(f),n=S.RJ(f),(0,k.Z)(this,ht).serialize(t.offset,r.offset,n.offset),e={runs:t.slice(),indices:r.slice(),distances:n.slice()}}finally{S.gd(t),S.gd(r),S.gd(n)}else(0,k.Z)(this,ht).serialize(s.offset,u.offset,c.offset),e={runs:s.array(),indices:u.array(),distances:c.array()};return e}},{key:"free",value:function(){null!==(0,k.Z)(this,ht)&&(I.A((0,k.Z)(this,ct)),(0,A.Z)(this,ht,null))}}],[{key:"unserialize",value:function(t,r,n){var i,a,s,o;try{a=S.de(t,"Int32WasmArray"),s=S.de(r,"Int32WasmArray"),o=S.de(n,"Float64WasmArray"),i=I.R((function(e){return new e.NeighborResults(t.length,a.offset,s.offset,o.offset)}),e)}catch(u){throw S.gd(i),u}finally{S.gd(a),S.gd(s),S.gd(o)}return i}}]),e}();function dt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.numberOfThreads,i=void 0===n?null:n,a=S.mV(i);return I.R((function(r){return r.find_nearest_neighbors(e.index,t,a)}),ft)}var vt=new WeakMap,pt=new WeakMap,mt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,vt,{writable:!0,value:void 0}),(0,y.Z)(this,pt,{writable:!0,value:void 0}),(0,A.Z)(this,vt,t),(0,A.Z)(this,pt,r)}return(0,g.Z)(e,[{key:"free",value:function(){null!==(0,k.Z)(this,pt)&&(I.A((0,k.Z)(this,vt)),(0,A.Z)(this,pt,null))}},{key:"graph",get:function(){return(0,k.Z)(this,pt)}}]),e}();var gt=new WeakMap,bt=new WeakMap,wt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,gt,{writable:!0,value:void 0}),(0,y.Z)(this,bt,{writable:!0,value:void 0}),(0,A.Z)(this,gt,t),(0,A.Z)(this,bt,r)}return(0,g.Z)(e,[{key:"best",value:function(){return(0,k.Z)(this,bt).best()}},{key:"numberOfLevels",value:function(){return(0,k.Z)(this,bt).number()}},{key:"modularity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.level,r=void 0===t?null:t;return null===r&&(r=this.best()),(0,k.Z)(this,bt).modularity(r)}},{key:"membership",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.level,r=void 0===t?null:t,n=e.copy,i=void 0===n||n;return null===r&&(r=this.best()),S.Yj((0,k.Z)(this,bt).membership(r),i)}},{key:"free",value:function(){null!==(0,k.Z)(this,bt)&&(I.A((0,k.Z)(this,gt)),(0,A.Z)(this,bt,null))}}]),e}(),yt=new WeakMap,_t=new WeakMap,Zt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,yt,{writable:!0,value:void 0}),(0,y.Z)(this,_t,{writable:!0,value:void 0}),(0,A.Z)(this,yt,t),(0,A.Z)(this,_t,r)}return(0,g.Z)(e,[{key:"modularity",value:function(){return(0,k.Z)(this,_t).modularity()}},{key:"membership",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,_t).membership(),r)}},{key:"free",value:function(){null!==(0,k.Z)(this,_t)&&(I.A((0,k.Z)(this,yt)),(0,A.Z)(this,_t,null))}}]),e}(),kt=new WeakMap,At=new WeakMap,xt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,kt,{writable:!0,value:void 0}),(0,y.Z)(this,At,{writable:!0,value:void 0}),(0,A.Z)(this,kt,t),(0,A.Z)(this,At,r)}return(0,g.Z)(e,[{key:"modularity",value:function(){return(0,k.Z)(this,At).modularity()}},{key:"membership",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return S.Yj((0,k.Z)(this,At).membership(),r)}},{key:"free",value:function(){null!==(0,k.Z)(this,At)&&(I.A((0,k.Z)(this,kt)),(0,A.Z)(this,At,null))}}]),e}();function Et(e){return E.RE((function(t){return t.perplexity_to_k(e)}))}var St=new WeakMap,It=new WeakMap,Ot=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,St,{writable:!0,value:void 0}),(0,y.Z)(this,It,{writable:!0,value:void 0}),(0,A.Z)(this,St,t),(0,A.Z)(this,It,r)}return(0,g.Z)(e,[{key:"numberOfBlocks",value:function(){return(0,k.Z)(this,It).num_blocks()}},{key:"numberOfGroups",value:function(){return(0,k.Z)(this,It).num_groups()}},{key:"means",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.block,n=void 0===r?-1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).means(e,n),a)}},{key:"detected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.block,n=void 0===r?-1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).detected(e,n),a)}},{key:"cohen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).cohen(e,n),a)}},{key:"auc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).auc(e,n),a)}},{key:"lfc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).lfc(e,n),a)}},{key:"deltaDetected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0===r?1:r,i=t.copy,a=void 0===i||i;return S.Yj((0,k.Z)(this,It).delta_detected(e,n),a)}},{key:"free",value:function(){null!==(0,k.Z)(this,It)&&(I.A((0,k.Z)(this,St)),(0,A.Z)(this,It,null))}}]),e}();function Ct(e,t){var r,n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.block,o=void 0===s?null:s,u=a.numberOfThreads,l=void 0===u?null:u,c=S.mV(l);try{if((i=S.de(t,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("length of 'groups' should be equal to number of columns in 'x'");var h=0,f=!1;if(null!==o){if((n=S.de(o,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");f=!0,h=n.offset}r=I.R((function(t){return t.score_markers(e.matrix,i.offset,f,h,c)}),Ot)}catch(d){throw S.gd(r),d}finally{S.gd(n),S.gd(i)}return r}var Rt=new WeakMap,Dt=new WeakMap,Bt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Rt,{writable:!0,value:void 0}),(0,y.Z)(this,Dt,{writable:!0,value:void 0}),(0,A.Z)(this,Rt,t),(0,A.Z)(this,Dt,r)}return(0,g.Z)(e,[{key:"reference",get:function(){return(0,k.Z)(this,Dt)}},{key:"numberOfSamples",value:function(){return(0,k.Z)(this,Dt).num_samples()}},{key:"numberOfFeatures",value:function(){return(0,k.Z)(this,Dt).num_features()}},{key:"numberOfLabels",value:function(){return(0,k.Z)(this,Dt).num_labels()}},{key:"free",value:function(){null!==(0,k.Z)(this,Dt)&&(I.A((0,k.Z)(this,Rt)),(0,A.Z)(this,Dt,null))}}]),e}();function zt(e,t,r){var n,i,a,s;try{i=S.de(e,"Uint8WasmArray"),a=S.de(t,"Uint8WasmArray"),s=S.de(r,"Uint8WasmArray"),n=I.R((function(e){return e.load_singlepp_reference(s.offset,s.length,a.offset,a.length,i.offset,i.length)}),Bt)}catch(o){throw S.gd(n),o}finally{S.gd(i),S.gd(a),S.gd(s)}return n}var Ft=new WeakMap,Nt=new WeakMap,Mt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Ft,{writable:!0,value:void 0}),(0,y.Z)(this,Nt,{writable:!0,value:void 0}),(0,A.Z)(this,Ft,t),(0,A.Z)(this,Nt,r)}return(0,g.Z)(e,[{key:"reference",get:function(){return(0,k.Z)(this,Nt)}},{key:"sharedFeatures",value:function(){return(0,k.Z)(this,Nt).shared_features()}},{key:"free",value:function(){null!==(0,k.Z)(this,Nt)&&(I.A((0,k.Z)(this,Ft)),(0,A.Z)(this,Nt,null))}}]),e}();function Gt(e,t){var r=t.array(),n={},i=0;return e.forEach((function(e){n[e]=i,r[i]=i,i++})),n}function Wt(e,t,r){var n=r.array(),i=Object.keys(t).length;e.forEach((function(e,r){e in t?n[r]=t[e]:(n[r]=i,i++)}))}function jt(e,t,r){var n,i,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=s.top,u=void 0===o?20:o,l=s.numberOfThreads,c=void 0===l?null:l,h=S.mV(c);try{var f=e.length;if(n=S.Wf(f),i=S.Wf(t.numberOfFeatures()),r.length!=i.length)throw new Error("length of 'referenceFeatures' should be equal to the number of features in 'reference'");var d=Gt(e,n);Wt(r,d,i),(a=I.R((function(e){return e.build_singlepp_reference(f,n.offset,t.reference,i.offset,u,h)}),Mt)).expectedNumberOfFeatures=f}catch(v){throw S.gd(a),v}finally{S.gd(n),S.gd(i)}return a}function Tt(e,t,r,n,i,a,s){var o,u,l,c=null,h=r instanceof xe.do;try{var f,d;if(e instanceof O.p)f=e.matrix;else{if(!(e instanceof xe.lt))throw new Error("unknown type for 'x'");if(e.length!==n*i)throw new Error("length of 'x' must be equal to the product of 'numberOfFeatures' and 'numberOfCells'");o=S.de(e,null),f=(u=I.R((function(e){return e.initialize_dense_matrix(n,i,o.offset,"Float64Array")}),O.p)).matrix}if(f.nrow()!=t)throw new Error("number of rows in 'x' should be equal to length of 'features' used to build '"+s+"'");d=h?r.offset:(l=S.Wf(f.ncol())).offset,a(f,d),h||(c=l.slice())}finally{S.gd(o),S.gd(u),S.gd(l)}return c}function Ut(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.buffer,i=void 0===n?null:n,a=r.numberOfFeatures,s=void 0===a?null:a,o=r.numberOfCells,u=void 0===o?null:o,l=r.quantile,c=void 0===l?.8:l,h=r.numberOfThreads,f=void 0===h?null:h,d=S.mV(f),v=function(e,r){E.RE((function(n){return n.run_singlepp(e,t.reference,c,r,d)}))},p=Tt(e,t.expectedNumberOfFeatures,i,s,u,v,"reference");return null===p&&(p=i.array()),p}var Qt=new WeakMap,qt=new WeakMap,Pt=function(){function e(t,r){(0,m.Z)(this,e),(0,y.Z)(this,Qt,{writable:!0,value:void 0}),(0,y.Z)(this,qt,{writable:!0,value:void 0}),(0,A.Z)(this,Qt,t),(0,A.Z)(this,qt,r)}return(0,g.Z)(e,[{key:"integrated",get:function(){return(0,k.Z)(this,qt)}},{key:"numberOfReferences",value:function(){return(0,k.Z)(this,qt).num_references()}},{key:"free",value:function(){null!==(0,k.Z)(this,qt)&&(I.A((0,k.Z)(this,Qt)),(0,A.Z)(this,qt,null))}}]),e}();function Lt(e,t,r){var n,i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=a.buffer,o=void 0===s?null:s,u=a.numberOfFeatures,l=void 0===u?null:u,c=a.numberOfCells,h=void 0===c?null:c,f=a.quantile,d=void 0===f?.8:f,v=a.numberOfThreads,p=void 0===v?null:v,m=r.numberOfReferences();if(t.length!=m)throw new Error("length of 'assigned' should be equal to the number of references in 'integrated'");var g=new Array(m),b=S.mV(p);try{for(var w=(i=S.GF(m)).array(),y=0;y<t.length;y++){var _=t[y],Z=!1;if(e instanceof O.p?_.length!=e.numberOfColumns()&&(Z=!0):_.length!=h&&(Z=!0),Z)throw new Error("length of each element 'assigned' should be equal to number of columns in 'x'");g[y]=S.de(_,"Int32WasmArray"),w[y]=BigInt(g[y].offset)}var k=function(e,t){E.RE((function(n){return n.integrate_singlepp(e,w.offset,r.integrated,d,t,b)}))};n=Tt(e,r.expectedNumberOfFeatures,o,l,h,k,"integrated")}finally{S.gd(i);for(var A=0,x=g;A<x.length;A++){var I=x[A];S.gd(I)}}return null===n&&(n=o.array()),n}function Vt(e,t){if("className"in e.constructor&&e.constructor.className.endsWith("WasmArray"))return"view"==t||"hdf5"==t?e.view():t?e.slice():e.array();if(!0===t)return e.slice();if("view"==t)throw new Error("'copy: \"view\"' not supported for mimics");return e}function Ht(e){S.ek(e)}function Yt(e,t,r,n){if(!r&&(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("parameters cannot contain ArrayBuffers or their views");if(!n&&(t instanceof ArrayBuffer||ArrayBuffer.isView(t)))throw new Error("parameters cannot contain ArrayBuffers or their views")}function Jt(e,t){if(typeof e!=typeof t)return Yt(e,t,!1,!1),!0;if("object"!=typeof e)return e!=t;var r=null===e,n=null===t;if(r!==n)return Yt(e,t,r,n),!0;if(r)return!1;var i=e instanceof Array,a=t instanceof Array;if(i!=a)return Yt(e,t,i,a),!0;if(i){if(e.length!=t.length)return!0;for(var s=0;s<e.length;s++)if(Jt(e[s],t[s]))return!0;return!1}Yt(e,t,!1,!1);var o=Object.keys(e),u=Object.keys(t);if(o.length!=u.length)return!0;o.sort(),u.sort();for(s=0;s<o.length;s++)if(o[s]!=u[s])return!0;for(var l=0,c=o;l<c.length;l++){var h=c[l];if(Jt(e[h],t[h]))return!0}return!1}function Xt(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",i=!0;if(n in r){var a=r[n];a.size!=e||a.constructor.className!=t||null!==a.owner?a.free():i=!1}if(i)switch(t){case"Uint8Array":r[n]=S.TS(e);break;case"Int32Array":r[n]=S.Wf(e);break;case"Float64Array":r[n]=S.RJ(e);break;default:throw"allocating '"+t+"' not yet supported"}return r[n]}function Kt(e,t){for(var r=[],n=0,i=Object.entries(e);n<i.length;n++){var a=(0,h.Z)(i[n],2),s=a[0];a[1].valid()&&r.push(s)}if(0==r.length)throw new Error("expected at least one valid upstream "+t+" state");return r}function $t(e,t){if(null!==t){var r,n=(0,o.Z)(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("subset indices are out of range")}}catch(bn){n.e(bn)}finally{n.f()}}for(var a=1;a<e.length;a++)if(e[a]<=e[a-1])throw new Error("subset indices must be sorted and unique")}function er(e){for(var t=e.length;--t>=0;)e[t]=0}var tr=256,rr=286,nr=30,ir=15,ar=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),sr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),or=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ur=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lr=new Array(576);er(lr);var cr=new Array(60);er(cr);var hr=new Array(512);er(hr);var fr=new Array(256);er(fr);var dr=new Array(29);er(dr);var vr,pr,mr,gr=new Array(nr);function br(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function wr(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}er(gr);var yr=function(e){return e<256?hr[e]:hr[256+(e>>>7)]},_r=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Zr=function(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,_r(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},kr=function(e,t,r){Zr(e,r[2*t],r[2*t+1])},Ar=function(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},xr=function(e,t,r){var n,i,a=new Array(16),s=0;for(n=1;n<=ir;n++)a[n]=s=s+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=Ar(a[o]++,o))}},Er=function(e){var t;for(t=0;t<rr;t++)e.dyn_ltree[2*t]=0;for(t=0;t<nr;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Sr=function(e){e.bi_valid>8?_r(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ir=function(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]},Or=function(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&Ir(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Ir(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},Cr=function(e,t,r){var n,i,a,s,o=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?kr(e,i,t):(a=fr[i],kr(e,a+tr+1,t),0!==(s=ar[a])&&(i-=dr[a],Zr(e,i,s)),n--,a=yr(n),kr(e,a,r),0!==(s=sr[a])&&(n-=gr[a],Zr(e,n,s)))}while(o<e.last_lit);kr(e,256,t)},Rr=function(e,t){var r,n,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==a[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=l,r=e.heap_len>>1;r>=1;r--)Or(e,a,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Or(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,Or(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,s,o,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,v=t.stat_desc.max_length,p=0;for(a=0;a<=ir;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=u[2*u[2*(n=e.heap[r])+1]+1]+1)>v&&(a=v,p++),u[2*n+1]=a,n>l||(e.bl_count[a]++,s=0,n>=d&&(s=f[n-d]),o=u[2*n],e.opt_len+=o*(a+s),h&&(e.static_len+=o*(c[2*n+1]+s)));if(0!==p){do{for(a=v-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[v]--,p-=2}while(p>0);for(a=v;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>l||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),n--)}}(e,t),xr(a,l,e.bl_count)},Dr=function(e,t,r){var n,i,a=-1,s=t[1],o=0,u=7,l=4;for(0===s&&(u=138,l=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++o<u&&i===s||(o<l?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(u=138,l=3):i===s?(u=6,l=3):(u=7,l=4))},Br=function(e,t,r){var n,i,a=-1,s=t[1],o=0,u=7,l=4;for(0===s&&(u=138,l=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++o<u&&i===s)){if(o<l)do{kr(e,i,e.bl_tree)}while(0!==--o);else 0!==i?(i!==a&&(kr(e,i,e.bl_tree),o--),kr(e,16,e.bl_tree),Zr(e,o-3,2)):o<=10?(kr(e,17,e.bl_tree),Zr(e,o-3,3)):(kr(e,18,e.bl_tree),Zr(e,o-11,7));o=0,a=i,0===s?(u=138,l=3):i===s?(u=6,l=3):(u=7,l=4)}},zr=!1,Fr=function(e,t,r,n){Zr(e,0+(n?1:0),3),function(e,t,r,n){Sr(e),n&&(_r(e,r),_r(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r}(e,t,r,!0)},Nr=function(e,t,r,n){var i,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<tr;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),Rr(e,e.l_desc),Rr(e,e.d_desc),s=function(e){var t;for(Dr(e,e.dyn_ltree,e.l_desc.max_code),Dr(e,e.dyn_dtree,e.d_desc.max_code),Rr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*ur[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?Fr(e,t,r,n):4===e.strategy||a===i?(Zr(e,2+(n?1:0),3),Cr(e,lr,cr)):(Zr(e,4+(n?1:0),3),function(e,t,r,n){var i;for(Zr(e,t-257,5),Zr(e,r-1,5),Zr(e,n-4,4),i=0;i<n;i++)Zr(e,e.bl_tree[2*ur[i]+1],3);Br(e,e.dyn_ltree,t-1),Br(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Cr(e,e.dyn_ltree,e.dyn_dtree)),Er(e),n&&Sr(e)},Mr={_tr_init:function(e){zr||(!function(){var e,t,r,n,i,a=new Array(16);for(r=0,n=0;n<28;n++)for(dr[n]=r,e=0;e<1<<ar[n];e++)fr[r++]=n;for(fr[r-1]=n,i=0,n=0;n<16;n++)for(gr[n]=i,e=0;e<1<<sr[n];e++)hr[i++]=n;for(i>>=7;n<nr;n++)for(gr[n]=i<<7,e=0;e<1<<sr[n]-7;e++)hr[256+i++]=n;for(t=0;t<=ir;t++)a[t]=0;for(e=0;e<=143;)lr[2*e+1]=8,e++,a[8]++;for(;e<=255;)lr[2*e+1]=9,e++,a[9]++;for(;e<=279;)lr[2*e+1]=7,e++,a[7]++;for(;e<=287;)lr[2*e+1]=8,e++,a[8]++;for(xr(lr,287,a),e=0;e<nr;e++)cr[2*e+1]=5,cr[2*e]=Ar(e,5);vr=new br(lr,ar,257,rr,ir),pr=new br(cr,sr,0,nr,ir),mr=new br(new Array(0),or,0,19,7)}(),zr=!0),e.l_desc=new wr(e.dyn_ltree,vr),e.d_desc=new wr(e.dyn_dtree,pr),e.bl_desc=new wr(e.bl_tree,mr),e.bi_buf=0,e.bi_valid=0,Er(e)},_tr_stored_block:Fr,_tr_flush_block:Nr,_tr_tally:function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(fr[r]+tr+1)]++,e.dyn_dtree[2*yr(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){Zr(e,2,3),kr(e,256,lr),function(e){16===e.bi_valid?(_r(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},Gr=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16|0},Wr=new Uint32Array(function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}()),jr=function(e,t,r,n){var i=Wr,a=n+r;e^=-1;for(var s=n;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},Tr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ur={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Qr=Mr._tr_init,qr=Mr._tr_stored_block,Pr=Mr._tr_flush_block,Lr=Mr._tr_tally,Vr=Mr._tr_align,Hr=Ur.Z_NO_FLUSH,Yr=Ur.Z_PARTIAL_FLUSH,Jr=Ur.Z_FULL_FLUSH,Xr=Ur.Z_FINISH,Kr=Ur.Z_BLOCK,$r=Ur.Z_OK,en=Ur.Z_STREAM_END,tn=Ur.Z_STREAM_ERROR,rn=Ur.Z_DATA_ERROR,nn=Ur.Z_BUF_ERROR,an=Ur.Z_DEFAULT_COMPRESSION,sn=Ur.Z_FILTERED,on=Ur.Z_HUFFMAN_ONLY,un=Ur.Z_RLE,ln=Ur.Z_FIXED,cn=Ur.Z_DEFAULT_STRATEGY,hn=Ur.Z_UNKNOWN,fn=Ur.Z_DEFLATED,dn=258,vn=262,pn=103,mn=113,gn=666,bn=function(e,t){return e.msg=Tr[t],t},wn=function(e){return(e<<1)-(e>4?9:0)},yn=function(e){for(var t=e.length;--t>=0;)e[t]=0},_n=function(e,t,r){return(t<<e.hash_shift^r)&e.hash_mask},Zn=function(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},kn=function(e,t){Pr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Zn(e.strm)},An=function(e,t){e.pending_buf[e.pending++]=t},xn=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},En=function(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),1===e.state.wrap?e.adler=Gr(e.adler,t,i,r):2===e.state.wrap&&(e.adler=jr(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},Sn=function(e,t){var r,n,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-vn?e.strstart-(e.w_size-vn):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+dn,d=l[a+s-1],v=l[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(r=t)+s]===v&&l[r+s-1]===d&&l[r]===l[a]&&l[++r]===l[a+1]){a+=2,r++;do{}while(l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&l[++a]===l[++r]&&a<f);if(n=dn-(f-a),a=f-dn,n>s){if(e.match_start=t,s=n,n>=o)break;d=l[a+s-1],v=l[a+s]}}}while((t=h[t&c])>u&&0!==--i);return s<=e.lookahead?s:e.lookahead},In=function(e){var t,r,n,i,a,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-vn)){e.window.set(e.window.subarray(s,s+s),0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=En(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=_n(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=_n(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<vn&&0!==e.strm.avail_in)},On=function(e,t){for(var r,n;;){if(e.lookahead<vn){if(In(e),e.lookahead<vn&&t===Hr)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-vn&&(e.match_length=Sn(e,r)),e.match_length>=3)if(n=Lr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=_n(e,e.ins_h,e.window[e.strstart+1]);else n=Lr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(kn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Xr?(kn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(kn(e,!1),0===e.strm.avail_out)?1:2},Cn=function(e,t){for(var r,n,i;;){if(e.lookahead<vn){if(In(e),e.lookahead<vn&&t===Hr)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-vn&&(e.match_length=Sn(e,r),e.match_length<=5&&(e.strategy===sn||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Lr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(kn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=Lr(e,0,e.window[e.strstart-1]))&&kn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Lr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Xr?(kn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(kn(e,!1),0===e.strm.avail_out)?1:2};function Rn(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}var Dn=[new Rn(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(In(e),0===e.lookahead&&t===Hr)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,kn(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-vn&&(kn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Xr?(kn(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(kn(e,!1),e.strm.avail_out),1)})),new Rn(4,4,8,4,On),new Rn(4,5,16,8,On),new Rn(4,6,32,32,On),new Rn(4,4,16,16,Cn),new Rn(8,16,32,32,Cn),new Rn(8,16,128,128,Cn),new Rn(8,32,128,256,Cn),new Rn(32,128,258,1024,Cn),new Rn(32,258,258,4096,Cn)];function Bn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),yn(this.dyn_ltree),yn(this.dyn_dtree),yn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),yn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),yn(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var zn=function(e){if(!e||!e.state)return bn(e,tn);e.total_in=e.total_out=0,e.data_type=hn;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:mn,e.adler=2===t.wrap?0:1,t.last_flush=Hr,Qr(t),$r},Fn=function(e){var t,r=zn(e);return r===$r&&((t=e.state).window_size=2*t.w_size,yn(t.head),t.max_lazy_match=Dn[t.level].max_lazy,t.good_match=Dn[t.level].good_length,t.nice_match=Dn[t.level].nice_length,t.max_chain_length=Dn[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r},Nn=function(e,t,r,n,i,a){if(!e)return tn;var s=1;if(t===an&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>9||r!==fn||n<8||n>15||t<0||t>9||a<0||a>ln)return bn(e,tn);8===n&&(n=9);var o=new Bn;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=a,o.method=r,Fn(e)},Mn={deflateInit:function(e,t){return Nn(e,t,fn,15,8,cn)},deflateInit2:Nn,deflateReset:Fn,deflateResetKeep:zn,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?tn:(e.state.gzhead=t,$r):tn},deflate:function(e,t){var r,n;if(!e||!e.state||t>Kr||t<0)return e?bn(e,tn):tn;var i=e.state;if(!e.output||!e.input&&0!==e.avail_in||i.status===gn&&t!==Xr)return bn(e,0===e.avail_out?nn:tn);i.strm=e;var a=i.last_flush;if(i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,An(i,31),An(i,139),An(i,8),i.gzhead?(An(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),An(i,255&i.gzhead.time),An(i,i.gzhead.time>>8&255),An(i,i.gzhead.time>>16&255),An(i,i.gzhead.time>>24&255),An(i,9===i.level?2:i.strategy>=on||i.level<2?4:0),An(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(An(i,255&i.gzhead.extra.length),An(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=jr(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(An(i,0),An(i,0),An(i,0),An(i,0),An(i,0),An(i,9===i.level?2:i.strategy>=on||i.level<2?4:0),An(i,3),i.status=mn);else{var s=fn+(i.w_bits-8<<4)<<8;s|=(i.strategy>=on||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(s|=32),s+=31-s%31,i.status=mn,xn(i,s),0!==i.strstart&&(xn(i,e.adler>>>16),xn(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),Zn(e),r=i.pending,i.pending!==i.pending_buf_size));)An(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),Zn(e),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,An(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),0===n&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),Zn(e),r=i.pending,i.pending===i.pending_buf_size)){n=1;break}n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,An(i,n)}while(0!==n);i.gzhead.hcrc&&i.pending>r&&(e.adler=jr(e.adler,i.pending_buf,i.pending-r,r)),0===n&&(i.status=pn)}else i.status=pn;if(i.status===pn&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Zn(e),i.pending+2<=i.pending_buf_size&&(An(i,255&e.adler),An(i,e.adler>>8&255),e.adler=0,i.status=mn)):i.status=mn),0!==i.pending){if(Zn(e),0===e.avail_out)return i.last_flush=-1,$r}else if(0===e.avail_in&&wn(t)<=wn(a)&&t!==Xr)return bn(e,nn);if(i.status===gn&&0!==e.avail_in)return bn(e,nn);if(0!==e.avail_in||0!==i.lookahead||t!==Hr&&i.status!==gn){var o=i.strategy===on?function(e,t){for(var r;;){if(0===e.lookahead&&(In(e),0===e.lookahead)){if(t===Hr)return 1;break}if(e.match_length=0,r=Lr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(kn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Xr?(kn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(kn(e,!1),0===e.strm.avail_out)?1:2}(i,t):i.strategy===un?function(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=dn){if(In(e),e.lookahead<=dn&&t===Hr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=e.strstart+dn;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=dn-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Lr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Lr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(kn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Xr?(kn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(kn(e,!1),0===e.strm.avail_out)?1:2}(i,t):Dn[i.level].func(i,t);if(3!==o&&4!==o||(i.status=gn),1===o||3===o)return 0===e.avail_out&&(i.last_flush=-1),$r;if(2===o&&(t===Yr?Vr(i):t!==Kr&&(qr(i,0,0,!1),t===Jr&&(yn(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Zn(e),0===e.avail_out))return i.last_flush=-1,$r}return t!==Xr?$r:i.wrap<=0?en:(2===i.wrap?(An(i,255&e.adler),An(i,e.adler>>8&255),An(i,e.adler>>16&255),An(i,e.adler>>24&255),An(i,255&e.total_in),An(i,e.total_in>>8&255),An(i,e.total_in>>16&255),An(i,e.total_in>>24&255)):(xn(i,e.adler>>>16),xn(i,65535&e.adler)),Zn(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?$r:en)},deflateEnd:function(e){if(!e||!e.state)return tn;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==pn&&t!==mn&&t!==gn?bn(e,tn):(e.state=null,t===mn?bn(e,rn):$r)},deflateSetDictionary:function(e,t){var r=t.length;if(!e||!e.state)return tn;var n=e.state,i=n.wrap;if(2===i||1===i&&42!==n.status||n.lookahead)return tn;if(1===i&&(e.adler=Gr(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===i&&(yn(n.head),n.strstart=0,n.block_start=0,n.insert=0);var a=new Uint8Array(n.w_size);a.set(t.subarray(r-n.w_size,r),0),t=a,r=n.w_size}var s=e.avail_in,o=e.next_in,u=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,In(n);n.lookahead>=3;){var l=n.strstart,c=n.lookahead-2;do{n.ins_h=_n(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++}while(--c);n.strstart=l,n.lookahead=2,In(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=u,e.avail_in=s,n.wrap=i,$r},deflateInfo:"pako deflate (from Nodeca project)"},Gn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Wn=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==typeof r)throw new TypeError(r+"must be non-object");for(var n in r)Gn(r,n)&&(e[n]=r[n])}}return e},jn=function(e){for(var t=0,r=0,n=e.length;r<n;r++)t+=e[r].length;for(var i=new Uint8Array(t),a=0,s=0,o=e.length;a<o;a++){var u=e[a];i.set(u,s),s+=u.length}return i},Tn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Uh){Tn=!1}for(var Un=new Uint8Array(256),Qn=0;Qn<256;Qn++)Un[Qn]=Qn>=252?6:Qn>=248?5:Qn>=240?4:Qn>=224?3:Qn>=192?2:1;Un[254]=Un[254]=1;var qn=function(e){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,r,n,i,a,s=e.length,o=0;for(i=0;i<s;i++)55296===(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320===(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)55296===(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320===(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},Pn=function(e,t){var r,n,i=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(n=0,r=0;r<i;){var s=e[r++];if(s<128)a[n++]=s;else{var o=Un[s];if(o>4)a[n++]=65533,r+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&r<i;)s=s<<6|63&e[r++],o--;o>1?a[n++]=65533:s<65536?a[n++]=s:(s-=65536,a[n++]=55296|s>>10&1023,a[n++]=56320|1023&s)}}}return function(e,t){if(t<65534&&e.subarray&&Tn)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}(a,n)},Ln=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var r=t-1;r>=0&&128===(192&e[r]);)r--;return r<0||0===r?t:r+Un[e[r]]>t?r:t};var Vn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Hn=Object.prototype.toString,Yn=Ur.Z_NO_FLUSH,Jn=Ur.Z_SYNC_FLUSH,Xn=Ur.Z_FULL_FLUSH,Kn=Ur.Z_FINISH,$n=Ur.Z_OK,ei=Ur.Z_STREAM_END,ti=Ur.Z_DEFAULT_COMPRESSION,ri=Ur.Z_DEFAULT_STRATEGY,ni=Ur.Z_DEFLATED;function ii(e){this.options=Wn({level:ti,method:ni,chunkSize:16384,windowBits:15,memLevel:8,strategy:ri},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vn,this.strm.avail_out=0;var r=Mn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==$n)throw new Error(Tr[r]);if(t.header&&Mn.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"===typeof t.dictionary?qn(t.dictionary):"[object ArrayBuffer]"===Hn.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=Mn.deflateSetDictionary(this.strm,n))!==$n)throw new Error(Tr[r]);this._dict_set=!0}}ii.prototype.push=function(e,t){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Kn:Yn,"string"===typeof e?i.input=qn(e):"[object ArrayBuffer]"===Hn.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(n===Jn||n===Xn)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((r=Mn.deflate(i,n))===ei)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=Mn.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===$n;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ii.prototype.onData=function(e){this.chunks.push(e)},ii.prototype.onEnd=function(e){e===$n&&(this.result=jn(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ai=function(e,t){var r,n,i,a,s,o,u,l,c,h,f,d,v,p,m,g,b,w,y,_,Z,k,A,x,E=e.state;r=e.next_in,A=e.input,n=r+(e.avail_in-5),i=e.next_out,x=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),o=E.dmax,u=E.wsize,l=E.whave,c=E.wnext,h=E.window,f=E.hold,d=E.bits,v=E.lencode,p=E.distcode,m=(1<<E.lenbits)-1,g=(1<<E.distbits)-1;e:do{d<15&&(f+=A[r++]<<d,d+=8,f+=A[r++]<<d,d+=8),b=v[f&m];t:for(;;){if(f>>>=w=b>>>24,d-=w,0===(w=b>>>16&255))x[i++]=65535&b;else{if(!(16&w)){if(0===(64&w)){b=v[(65535&b)+(f&(1<<w)-1)];continue t}if(32&w){E.mode=12;break e}e.msg="invalid literal/length code",E.mode=30;break e}y=65535&b,(w&=15)&&(d<w&&(f+=A[r++]<<d,d+=8),y+=f&(1<<w)-1,f>>>=w,d-=w),d<15&&(f+=A[r++]<<d,d+=8,f+=A[r++]<<d,d+=8),b=p[f&g];r:for(;;){if(f>>>=w=b>>>24,d-=w,!(16&(w=b>>>16&255))){if(0===(64&w)){b=p[(65535&b)+(f&(1<<w)-1)];continue r}e.msg="invalid distance code",E.mode=30;break e}if(_=65535&b,d<(w&=15)&&(f+=A[r++]<<d,(d+=8)<w&&(f+=A[r++]<<d,d+=8)),(_+=f&(1<<w)-1)>o){e.msg="invalid distance too far back",E.mode=30;break e}if(f>>>=w,d-=w,_>(w=i-a)){if((w=_-w)>l&&E.sane){e.msg="invalid distance too far back",E.mode=30;break e}if(Z=0,k=h,0===c){if(Z+=u-w,w<y){y-=w;do{x[i++]=h[Z++]}while(--w);Z=i-_,k=x}}else if(c<w){if(Z+=u+c-w,(w-=c)<y){y-=w;do{x[i++]=h[Z++]}while(--w);if(Z=0,c<y){y-=w=c;do{x[i++]=h[Z++]}while(--w);Z=i-_,k=x}}}else if(Z+=c-w,w<y){y-=w;do{x[i++]=h[Z++]}while(--w);Z=i-_,k=x}for(;y>2;)x[i++]=k[Z++],x[i++]=k[Z++],x[i++]=k[Z++],y-=3;y&&(x[i++]=k[Z++],y>1&&(x[i++]=k[Z++]))}else{Z=i-_;do{x[i++]=x[Z++],x[i++]=x[Z++],x[i++]=x[Z++],y-=3}while(y>2);y&&(x[i++]=x[Z++],y>1&&(x[i++]=x[Z++]))}break}}break}}while(r<n&&i<s);r-=y=d>>3,f&=(1<<(d-=y<<3))-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<s?s-i+257:257-(i-s),E.hold=f,E.bits=d},si=15,oi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ui=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),li=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ci=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),hi=function(e,t,r,n,i,a,s,o){var u,l,c,h,f,d,v,p,m,g=o.bits,b=0,w=0,y=0,_=0,Z=0,k=0,A=0,x=0,E=0,S=0,I=null,O=0,C=new Uint16Array(16),R=new Uint16Array(16),D=null,B=0;for(b=0;b<=si;b++)C[b]=0;for(w=0;w<n;w++)C[t[r+w]]++;for(Z=g,_=si;_>=1&&0===C[_];_--);if(Z>_&&(Z=_),0===_)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(y=1;y<_&&0===C[y];y++);for(Z<y&&(Z=y),x=1,b=1;b<=si;b++)if(x<<=1,(x-=C[b])<0)return-1;if(x>0&&(0===e||1!==_))return-1;for(R[1]=0,b=1;b<si;b++)R[b+1]=R[b]+C[b];for(w=0;w<n;w++)0!==t[r+w]&&(s[R[t[r+w]]++]=w);if(0===e?(I=D=s,d=19):1===e?(I=oi,O-=257,D=ui,B-=257,d=256):(I=li,D=ci,d=-1),S=0,w=0,b=y,f=a,k=Z,A=0,c=-1,h=(E=1<<Z)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){v=b-A,s[w]<d?(p=0,m=s[w]):s[w]>d?(p=D[B+s[w]],m=I[O+s[w]]):(p=96,m=0),u=1<<b-A,y=l=1<<k;do{i[f+(S>>A)+(l-=u)]=v<<24|p<<16|m|0}while(0!==l);for(u=1<<b-1;S&u;)u>>=1;if(0!==u?(S&=u-1,S+=u):S=0,w++,0===--C[b]){if(b===_)break;b=t[r+s[w]]}if(b>Z&&(S&h)!==c){for(0===A&&(A=Z),f+=y,x=1<<(k=b-A);k+A<_&&!((x-=C[k+A])<=0);)k++,x<<=1;if(E+=1<<k,1===e&&E>852||2===e&&E>592)return 1;i[c=S&h]=Z<<24|k<<16|f-a|0}}return 0!==S&&(i[f+S]=b-A<<24|64<<16|0),o.bits=Z,0},fi=Ur.Z_FINISH,di=Ur.Z_BLOCK,vi=Ur.Z_TREES,pi=Ur.Z_OK,mi=Ur.Z_STREAM_END,gi=Ur.Z_NEED_DICT,bi=Ur.Z_STREAM_ERROR,wi=Ur.Z_DATA_ERROR,yi=Ur.Z_MEM_ERROR,_i=Ur.Z_BUF_ERROR,Zi=Ur.Z_DEFLATED,ki=12,Ai=30,xi=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function Ei(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Si,Ii,Oi=function(e){if(!e||!e.state)return bi;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,pi},Ci=function(e){if(!e||!e.state)return bi;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Oi(e)},Ri=function(e,t){var r;if(!e||!e.state)return bi;var n=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?bi:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Ci(e))},Di=function(e,t){if(!e)return bi;var r=new Ei;e.state=r,r.window=null;var n=Ri(e,t);return n!==pi&&(e.state=null),n},Bi=!0,zi=function(e){if(Bi){Si=new Int32Array(512),Ii=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(hi(1,e.lens,0,288,Si,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;hi(2,e.lens,0,32,Ii,0,e.work,{bits:5}),Bi=!1}e.lencode=Si,e.lenbits=9,e.distcode=Ii,e.distbits=5},Fi=function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),a.window.set(t.subarray(r-n,r-n+i),a.wnext),(n-=i)?(a.window.set(t.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},Ni={inflateReset:Ci,inflateReset2:Ri,inflateResetKeep:Oi,inflateInit:function(e){return Di(e,15)},inflateInit2:Di,inflate:function(e,t){var r,n,i,a,s,o,u,l,c,h,f,d,v,p,m,g,b,w,y,_,Z,k,A,x,E=0,S=new Uint8Array(4),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return bi;(r=e.state).mode===ki&&(r.mode=13),s=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,l=r.hold,c=r.bits,h=o,f=u,k=pi;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;c<16;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(2&r.wrap&&35615===l){r.check=0,S[0]=255&l,S[1]=l>>>8&255,r.check=jr(r.check,S,2,0),l=0,c=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",r.mode=Ai;break}if((15&l)!==Zi){e.msg="unknown compression method",r.mode=Ai;break}if(c-=4,Z=8+(15&(l>>>=4)),0===r.wbits)r.wbits=Z;else if(Z>r.wbits){e.msg="invalid window size",r.mode=Ai;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&l?10:ki,l=0,c=0;break;case 2:for(;c<16;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(r.flags=l,(255&r.flags)!==Zi){e.msg="unknown compression method",r.mode=Ai;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=Ai;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=jr(r.check,S,2,0)),l=0,c=0,r.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.head&&(r.head.time=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,r.check=jr(r.check,S,4,0)),l=0,c=0,r.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=jr(r.check,S,2,0)),l=0,c=0,r.mode=5;case 5:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(S[0]=255&l,S[1]=l>>>8&255,r.check=jr(r.check,S,2,0)),l=0,c=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=r.length)>o&&(d=o),d&&(r.head&&(Z=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+d),Z)),512&r.flags&&(r.check=jr(r.check,n,d,a)),o-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;d=0;do{Z=n[a+d++],r.head&&Z&&r.length<65536&&(r.head.name+=String.fromCharCode(Z))}while(Z&&d<o);if(512&r.flags&&(r.check=jr(r.check,n,d,a)),o-=d,a+=d,Z)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;d=0;do{Z=n[a+d++],r.head&&Z&&r.length<65536&&(r.head.comment+=String.fromCharCode(Z))}while(Z&&d<o);if(512&r.flags&&(r.check=jr(r.check,n,d,a)),o-=d,a+=d,Z)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Ai;break}l=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ki;break;case 10:for(;c<32;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}e.adler=r.check=xi(l),l=0,c=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=c,gi;e.adler=r.check=1,r.mode=ki;case ki:if(t===di||t===vi)break e;case 13:if(r.last){l>>>=7&c,c-=7&c,r.mode=27;break}for(;c<3;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}switch(r.last=1&l,c-=1,3&(l>>>=1)){case 0:r.mode=14;break;case 1:if(zi(r),r.mode=20,t===vi){l>>>=2,c-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=Ai}l>>>=2,c-=2;break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Ai;break}if(r.length=65535&l,l=0,c=0,r.mode=15,t===vi)break e;case 15:r.mode=16;case 16:if(d=r.length){if(d>o&&(d=o),d>u&&(d=u),0===d)break e;i.set(n.subarray(a,a+d),s),o-=d,a+=d,u-=d,s+=d,r.length-=d;break}r.mode=ki;break;case 17:for(;c<14;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(r.nlen=257+(31&l),l>>>=5,c-=5,r.ndist=1+(31&l),l>>>=5,c-=5,r.ncode=4+(15&l),l>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Ai;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.lens[I[r.have++]]=7&l,l>>>=3,c-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},k=hi(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,k){e.msg="invalid code lengths set",r.mode=Ai;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(E=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,b=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(b<16)l>>>=m,c-=m,r.lens[r.have++]=b;else{if(16===b){for(x=m+2;c<x;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(l>>>=m,c-=m,0===r.have){e.msg="invalid bit length repeat",r.mode=Ai;break}Z=r.lens[r.have-1],d=3+(3&l),l>>>=2,c-=2}else if(17===b){for(x=m+3;c<x;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}c-=m,Z=0,d=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(x=m+7;c<x;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}c-=m,Z=0,d=11+(127&(l>>>=m)),l>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Ai;break}for(;d--;)r.lens[r.have++]=Z}}if(r.mode===Ai)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=Ai;break}if(r.lenbits=9,A={bits:r.lenbits},k=hi(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,k){e.msg="invalid literal/lengths set",r.mode=Ai;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},k=hi(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,k){e.msg="invalid distances set",r.mode=Ai;break}if(r.mode=20,t===vi)break e;case 20:r.mode=21;case 21:if(o>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=c,ai(e,f),s=e.next_out,i=e.output,u=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,l=r.hold,c=r.bits,r.mode===ki&&(r.back=-1);break}for(r.back=0;g=(E=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,b=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(g&&0===(240&g)){for(w=m,y=g,_=b;g=(E=r.lencode[_+((l&(1<<w+y)-1)>>w)])>>>16&255,b=65535&E,!(w+(m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}l>>>=w,c-=w,r.back+=w}if(l>>>=m,c-=m,r.back+=m,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=ki;break}if(64&g){e.msg="invalid literal/length code",r.mode=Ai;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(E=r.distcode[l&(1<<r.distbits)-1])>>>16&255,b=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(0===(240&g)){for(w=m,y=g,_=b;g=(E=r.distcode[_+((l&(1<<w+y)-1)>>w)])>>>16&255,b=65535&E,!(w+(m=E>>>24)<=c);){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}l>>>=w,c-=w,r.back+=w}if(l>>>=m,c-=m,r.back+=m,64&g){e.msg="invalid distance code",r.mode=Ai;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Ai;break}r.mode=25;case 25:if(0===u)break e;if(d=f-u,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Ai;break}d>r.wnext?(d-=r.wnext,v=r.wsize-d):v=r.wnext-d,d>r.length&&(d=r.length),p=r.window}else p=i,v=s-r.offset,d=r.length;d>u&&(d=u),u-=d,r.length-=d;do{i[s++]=p[v++]}while(--d);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;i[s++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;c<32;){if(0===o)break e;o--,l|=n[a++]<<c,c+=8}if(f-=u,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?jr(r.check,i,f,s-f):Gr(r.check,i,f,s-f)),f=u,(r.flags?l:xi(l))!==r.check){e.msg="incorrect data check",r.mode=Ai;break}l=0,c=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,l+=n[a++]<<c,c+=8}if(l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Ai;break}l=0,c=0}r.mode=29;case 29:k=mi;break e;case Ai:k=wi;break e;case 31:return yi;default:return bi}return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=o,r.hold=l,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<Ai&&(r.mode<27||t!==fi))&&Fi(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?jr(r.check,i,f,e.next_out-f):Gr(r.check,i,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ki?128:0)+(20===r.mode||15===r.mode?256:0),(0===h&&0===f||t===fi)&&k===pi&&(k=_i),k},inflateEnd:function(e){if(!e||!e.state)return bi;var t=e.state;return t.window&&(t.window=null),e.state=null,pi},inflateGetHeader:function(e,t){if(!e||!e.state)return bi;var r=e.state;return 0===(2&r.wrap)?bi:(r.head=t,t.done=!1,pi)},inflateSetDictionary:function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?bi:11===r.mode&&Gr(1,t,n,0)!==r.check?wi:Fi(e,t,n,n)?(r.mode=31,yi):(r.havedict=1,pi):bi},inflateInfo:"pako inflate (from Nodeca project)"};var Mi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Gi=Object.prototype.toString,Wi=Ur.Z_NO_FLUSH,ji=Ur.Z_FINISH,Ti=Ur.Z_OK,Ui=Ur.Z_STREAM_END,Qi=Ur.Z_NEED_DICT,qi=Ur.Z_STREAM_ERROR,Pi=Ur.Z_DATA_ERROR,Li=Ur.Z_MEM_ERROR;function Vi(e){this.options=Wn({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Vn,this.strm.avail_out=0;var r=Ni.inflateInit2(this.strm,t.windowBits);if(r!==Ti)throw new Error(Tr[r]);if(this.header=new Mi,Ni.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=qn(t.dictionary):"[object ArrayBuffer]"===Gi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Ni.inflateSetDictionary(this.strm,t.dictionary))!==Ti))throw new Error(Tr[r])}function Hi(e,t){var r=new Vi(t);if(r.push(e),r.err)throw r.msg||Tr[r.err];return r.result}Vi.prototype.push=function(e,t){var r,n,i,a=this.strm,s=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(n=t===~~t?t:!0===t?ji:Wi,"[object ArrayBuffer]"===Gi.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(s),a.next_out=0,a.avail_out=s),(r=Ni.inflate(a,n))===Qi&&o&&((r=Ni.inflateSetDictionary(a,o))===Ti?r=Ni.inflate(a,n):r===Pi&&(r=Qi));a.avail_in>0&&r===Ui&&a.state.wrap>0&&0!==e[a.next_in];)Ni.inflateReset(a),r=Ni.inflate(a,n);switch(r){case qi:case Pi:case Qi:case Li:return this.onEnd(r),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||r===Ui))if("string"===this.options.to){var u=Ln(a.output,a.next_out),l=a.next_out-u,c=Pn(a.output,u);a.next_out=l,a.avail_out=s-l,l&&a.output.set(a.output.subarray(u,u+l),0),this.onData(c)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(r!==Ti||0!==i){if(r===Ui)return r=Ni.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},Vi.prototype.onData=function(e){this.chunks.push(e)},Vi.prototype.onEnd=function(e){e===Ti&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=jn(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Yi={Inflate:Vi,inflate:Hi,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Hi(e,t)},ungzip:Hi,constants:Ur},Ji=Yi.ungzip,Xi=r(1025);var Ki=new WeakMap,$i=function(){function e(t){if((0,m.Z)(this,e),(0,y.Z)(this,Ki,{writable:!0,value:void 0}),t instanceof File){var r=new FileReaderSync;(0,A.Z)(this,Ki,r.readAsArrayBuffer(t))}else{if(!(t instanceof ArrayBuffer))throw"unknown type '"+typeof t+"' for LoadedFile constructor";(0,A.Z)(this,Ki,t)}}return(0,g.Z)(e,[{key:"buffer",value:function(){return(0,k.Z)(this,Ki)}},{key:"size",value:function(){return(0,k.Z)(this,Ki).byteLength}},{key:"serialized",value:function(){return(0,k.Z)(this,Ki)}}]),e}();function ea(e){return new Uint8Array(e.buffer())}function ta(e){return ea(e)}function ra(e){var t;do{t="temp_"+String(Number(new Date))+"_"+String(Math.round(1e4*Math.random()))+".h5"}while(E.ki(t));return E.NC(t,new Uint8Array(e.buffer())),t}function na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.allowed;E.ki(e)&&E.Yd(e)}function ia(e,t){if(!(t in e.children))return null;if("DataSet"!==e.children[t])return null;var r=e.open(t);return"String"!==r.type?null:r.load()}function aa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.limit,n=void 0===r?50:r;if(e instanceof Array){var i=Array.from(new Set(e));i.sort();var a=!1;return i.length>n&&(i=i.slice(0,n),a=!0),{type:"categorical",values:i,truncated:a}}var s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return e.forEach((function(e){e<s&&(s=e),e>o&&(o=e)})),{type:"continuous",min:s,max:o}}function sa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.compression,n=void 0===r?null:r,i=e;null===n&&e.length>=3&&31==e[0]&&139==e[1]&&8==e[2]&&(n="gz"),"gz"===n&&(i=Ji(e));var a=new TextDecoder;return a.decode(i)}function oa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.compression,n=void 0===r?null:r,i=sa(e,{compression:n}),a=i.split("\n");return a.length>0&&""==a[a.length-1]&&a.pop(),a}function ua(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.compression,i=void 0===n?null:n,a=r.delim,s=void 0===a?"\t":a,o=r.firstOnly,u=void 0!==o&&o;if(e instanceof Uint8Array)t=e;else{if(!(e instanceof ArrayBuffer)){var l=new $i(e);e=l.buffer()}t=new Uint8Array(e)}var c=sa(t,{compression:i}),h=Xi.parse(c,{delimiter:s,preview:u?1:0}),f=h.data[h.data.length-1];return 1===f.length&&""===f[0]&&h.data.pop(),h.data}function la(e){for(var t=new Float64Array(e.length),r=0,n=Object.entries(e);r<n.length;r++){var i=(0,h.Z)(n[r],2),a=i[0],s=i[1],o=Number(s),u=parseFloat(s);if(isNaN(o)||isNaN(u))if(""===s||"NA"===s||"na"==s||"NaN"==s||"nan"==s)t[a]=NaN;else if("Inf"==s||"inf"==s)t[a]=Number.POSITIVE_INFINITY;else{if("-Inf"!=s&&"-inf"!=s)return null;t[a]=Number.NEGATIVE_INFINITY}else t[a]=o}return t}function ca(e,t,r){if(null===r){var n=[];if(null!==t){var i,a=(0,o.Z)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;n.push("Gene ".concat(s+1))}}catch(bn){a.e(bn)}finally{a.f()}}else for(var u=0;u<e;u++)n.push("Gene ".concat(u+1));r={id:n}}else if(null!=t)for(var l=0,c=Object.entries(r);l<c.length;l++){var f=(0,h.Z)(c[l],2),d=f[0],v=f[1];r[d]=Ze(t,v)}return r}function ha(e){if(!("type"in e))return null;var t=function(e){var t={};return e.forEach((function(e,r){e in t||(t[e]=[]),t[e].push(r)})),t}(e.type);if(1==Object.keys(t).length)return null;for(var r={},n=0,i=Object.entries(t);n<i.length;n++){var a=(0,h.Z)(i[n],2),s=a[0],o=a[1];s.match(/gene expression/i)?r.RNA=o:s.match(/antibody capture/i)&&(r.ADT=o)}var u={types:r},l=p({},e);return delete l.type,u.genes=function(e,t){for(var r={},n=0,i=Object.entries(t);n<i.length;n++){var a=(0,h.Z)(i[n],2),s=a[0],o=a[1];r[s]=Ee(e,o)}return r}(l,r),u}function fa(e){var t=ha(e);return null===t?null:(delete t.types,t)}function da(e,t,r){var n=ha(r);if(null===n)return null;var i,a=n.types;delete n.types;try{i=new Re({store:ze(e,a)}),n.matrices=i}catch(f){throw S.gd(i),f}if(null===t)n.row_ids=a;else{n.row_ids={};for(var s=0,o=Object.entries(a);s<o.length;s++){var u=(0,h.Z)(o[s],2),l=u[0],c=u[1];n.row_ids[l]=Ze(c,t)}}return n}function va(e,t){var r,n={name:(r=e,r.name)};return t?n.size=function(e){return e.size}(e):n.content=new $i(e),n}var pa={file2link:null,link2file:null};function ma(e){var t=pa.file2link;return pa.file2link=e,t}function ga(e){var t=pa.link2file;return pa.link2file=e,t}function ba(e,t,r){return wa.apply(this,arguments)}function wa(){return(wa=(0,f.Z)(x.mark((function e(t,r,n){var i,a,s,o;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={type:r,name:t.name},a=t.content.serialized(),null===n){e.next=10;break}return e.next=5,n(a,t.content.size());case 5:s=e.sent,i.offset=s.offset,i.size=s.size,e.next=16;break;case 10:if(null!==(o=pa.file2link)){e.next=13;break}throw new Error("link-creating function has not been set by 'setCreateLink'");case 13:return e.next=15,o(r,t.name,a);case 15:i.id=e.sent;case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ya(e,t){return _a.apply(this,arguments)}function _a(){return(_a=(0,f.Z)(x.mark((function e(t,r){var n,i;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={name:t.name},!("id"in t)){e.next=12;break}if(null!==(i=pa.link2file)){e.next=5;break}throw new Error("link-resolving function has not been set by 'setResolveLink'");case 5:return e.t0=$i,e.next=8,i(t.id);case 8:e.t1=e.sent,n.content=new e.t0(e.t1),e.next=17;break;case 12:return e.t2=$i,e.next=15,r(t.offset,t.size);case 15:e.t3=e.sent,n.content=new e.t2(e.t3);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Za(e){return{format:"10X",h5:va(e.h5,!0)}}function ka(e){var t=null;if(!("matrix"in e.children)||"Group"!=e.children.matrix)throw new Error("expected a 'matrix' group at the top level of the file");var r=e.open("matrix");if("features"in r.children&&"Group"==r.children.features){var n=r.open("features"),i=ia(n,"id");if(null!==i){t={id:i};var a=ia(n,"name");null!==a&&(t.name=a);var s=ia(n,"feature_type");null!==s&&(t.type=s)}}return t}function Aa(e){var t={},r=ra(va(e.h5,!1).content);try{var n=ka(new ee(r)),i=fa(n);t.genes=null!==i?i.genes:{RNA:n},t.annotations=null}finally{na(r)}return t}var xa=new WeakMap,Ea=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,m.Z)(this,e),(0,y.Z)(this,xa,{writable:!0,value:void 0}),r?(0,A.Z)(this,xa,t):(0,A.Z)(this,xa,va(t.h5,!1))}return(0,g.Z)(e,[{key:"load",value:function(){var e={matrix:new Re},t=ra((0,k.Z)(this,xa).content);try{var r=B(t,"matrix"),n=r.matrix,i=r.row_ids;e.matrix.add("RNA",n);var a=ka(new ee(t)),s=ca(n.numberOfRows(),i,a),o=da(n,i,s);null!==o?(S.gd(n),e.matrix=o.matrices,e.row_ids=o.row_ids,e.genes=o.genes):(e.row_ids={RNA:i},e.genes={RNA:s}),e.annotations=null}catch(u){throw S.gd(e.matrix),u}finally{na(t)}return e}},{key:"format",value:function(){return"10X"}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ba((0,k.Z)(this,xa),"h5",t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Sa(e,t){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,f.Z)(x.mark((function e(t,r){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Ea,e.next=3,ya(t[0],r);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1,!0));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oa(e){return{format:"H5AD",h5:va(e.h5,!0)}}function Ca(e){var t=null;if("var"in e.children&&"Group"==e.children.var){var r=e.open("var"),n=ia(r,"_index");if(null!==n){t={_index:n};for(var i=0,a=Object.entries(r.children);i<a.length;i++){var s=(0,h.Z)(a[i],2),o=s[0];if("DataSet"===s[1]&&(o.match(/name/i)||o.match(/symb/i))){var u=r.open(o);"String"==u.type&&(t[o]=u.load())}}}}return t}function Ra(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=void 0!==r&&r,i=t.summaryLimit,a=void 0===i?50:i,s=null;if("obs"in e.children&&"Group"==e.children.obs){var o=e.open("obs");s={};var u=ia(o,"_index");null!==u&&(s._index=u);for(var l=0,c=Object.entries(o.children);l<c.length;l++){var f=(0,h.Z)(c[l],2),d=f[0],v=f[1];if("DataSet"==v){var p=o.open(d);if("Other"!=p.type){var m=p.load();s[d]=n?aa(m,{limit:a}):m}}}if("__categories"in o.children&&"Group"==o.children.__categories)for(var g=o.open("__categories"),b=0,w=Object.entries(g.children);b<w.length;b++){var y=(0,h.Z)(w[b],2),_=y[0];y[1];_ in s&&function(){var e=ia(g,_);if(null!==e)if(n)s[_]=aa(e,{limit:a});else{var t=s[_],r=new Array(t.length);t.forEach((function(t,n){r[n]=e[t]})),s[_]=r}}()}}return s}function Da(e){var t={},r=ra(va(e.h5,!1).content);try{var n=new ee(r),i=Ca(n),a=fa(i);t.genes=null!==a?a.genes:{RNA:i},t.annotations=Ra(n,{summary:!0})}finally{na(r)}return t}var Ba=new WeakMap,za=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,m.Z)(this,e),(0,y.Z)(this,Ba,{writable:!0,value:void 0}),r?(0,A.Z)(this,Ba,t):(0,A.Z)(this,Ba,va(t.h5,!1))}return(0,g.Z)(e,[{key:"load",value:function(){var e={matrix:new Re},t=ra((0,k.Z)(this,Ba).content);try{var r=B(t,"X"),n=r.matrix,i=r.row_ids;e.matrix.add("RNA",n);var a=new ee(t),s=Ca(a);e.genes={RNA:ca(n,i,s)},e.row_ids={RNA:i},e.annotations=Ra(a)}catch(o){throw S.gd(e.matrix),o}finally{na(t)}return e}},{key:"format",value:function(){return"H5AD"}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ba((0,k.Z)(this,Ba),"h5",t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Fa(e,t){return Na.apply(this,arguments)}function Na(){return(Na=(0,f.Z)(x.mark((function e(t,r){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=za,e.next=3,ya(t[0],r);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1,!0));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ma(e){var t={format:"MatrixMarket",mtx:va(e.mtx,!0)};return"genes"in e&&(t.genes=va(e.genes,!0)),"annotations"in e&&(t.annotations=va(e.annotations,!0)),t}function Ga(e,t){var r=ua(new Uint8Array(e.content.buffer()),{compression:e.name.endsWith(".gz")?"gz":"none"});if(r.length==t+1){var n={};return r.shift().forEach((function(e,t){n[e]=r.map((function(e){return e[t]}))})),n}if(r.length!==t)throw new Error("number of matrix rows is not equal to the number of rows in '"+e.name+"'");var i=[],a=[];r.forEach((function(e){i.push(e[0]),a.push(e[1])}));var s={id:i,symbol:a};if(r[0].length>=3){var o=[];r.forEach((function(e){o.push(e[2])})),s.type=o}return s}function Wa(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.summary,a=void 0!==i&&i,s=n.summaryLimit,o=void 0===s?50:s,u=new Uint8Array(e.content.buffer()),l=e.name.endsWith(".gz"),c=ua(u,{compression:l?"gz":"none"}),f=!0,d=t-c.length;if(0===d)f=!1;else if(-1!==d)throw"number of matrix columns is not equal to the number of rows in '"+e.name+"'";r=f?c.shift():c[0];var v={};r.forEach((function(e,t){v[e]=c.map((function(e){return e[t]}))}));for(var p=0,m=Object.entries(v);p<m.length;p++){var g=(0,h.Z)(m[p],2),b=g[0],w=g[1],y=la(w);null!==y&&(v[b]=y),a&&(v[b]=aa(v[b],{limit:o}))}return v}function ja(e){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,f.Z)(x.mark((function e(t){var r,n,i,a,s,o,u,l,c,h;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=null,("genes"in t||"annotations"in t)&&(i=va(t.mtx,!1),a=i.name.endsWith(".gz"),s=ta(i.content),o=D(s,{compressed:a}),n=[o.rows,o.columns]),"genes"in t?(u=va(t.genes,!1),l=Ga(u,n[0]),c=fa(l),r.genes=null!==c?c.genes:{RNA:l}):r.genes=null,"annotations"in t?(h=va(t.annotations,!1),r.annotations=Wa(h,n[1],{summary:!0})):r.annotations=null,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ua=new WeakMap,Qa=new WeakMap,qa=new WeakMap,Pa=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,m.Z)(this,e),(0,y.Z)(this,Ua,{writable:!0,value:void 0}),(0,y.Z)(this,Qa,{writable:!0,value:void 0}),(0,y.Z)(this,qa,{writable:!0,value:void 0}),r?((0,A.Z)(this,Ua,t.mtx),"genes"in t?(0,A.Z)(this,Qa,t.genes):(0,A.Z)(this,Qa,null),"annotations"in t?(0,A.Z)(this,qa,t.annotations):(0,A.Z)(this,qa,null)):((0,A.Z)(this,Ua,va(t.mtx,!1)),"genes"in t?(0,A.Z)(this,Qa,va(t.genes,!1)):(0,A.Z)(this,Qa,null),"annotations"in t?(0,A.Z)(this,qa,va(t.annotations,!1)):(0,A.Z)(this,qa,null))}return(0,g.Z)(e,[{key:"load",value:function(){var e="gz"==(0,k.Z)(this,Ua).name.split(".").pop(),t=ta((0,k.Z)(this,Ua).content),r={matrix:new Re};try{var n=C(t,{compressed:e}),i=n.matrix,a=n.row_ids;r.matrix.add("RNA",i);var s=null;null!==(0,k.Z)(this,Qa)&&(s=Ga((0,k.Z)(this,Qa),i.numberOfRows()));var o=ca(i.numberOfRows(),a,s),u=da(i,a,o);null!==u?(S.gd(i),r.matrix=u.matrices,r.row_ids=u.row_ids,r.genes=u.genes):(r.genes={RNA:o},r.row_ids={RNA:a}),null!==(0,k.Z)(this,qa)?r.annotations=Wa((0,k.Z)(this,qa),r.matrix.numberOfColumns()):r.annotations=null}catch(l){throw S.gd(r.matrix),l}return r}},{key:"format",value:function(){return"MatrixMarket"}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){var r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ba((0,k.Z)(this,Ua),"mtx",t);case 2:if(e.t0=e.sent,r=[e.t0],null===(0,k.Z)(this,Qa)){e.next=10;break}return e.t1=r,e.next=8,ba((0,k.Z)(this,Qa),"genes",t);case 8:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 10:if(null===(0,k.Z)(this,qa)){e.next=16;break}return e.t3=r,e.next=14,ba((0,k.Z)(this,qa),"annotations",t);case 14:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function La(e,t){return Va.apply(this,arguments)}function Va(){return(Va=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},i=(0,o.Z)(t),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=11;break}return s=a.value,e.next=8,ya(s,r);case 8:n[s.type]=e.sent;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),i.e(e.t0);case 16:return e.prev=16,i.f(),e.finish(16);case 19:return e.abrupt("return",new Pa(n,!0));case 20:case"end":return e.stop()}}),e,null,[[2,13,16,19]])})))).apply(this,arguments)}function Ha(e){return{format:"SummarizedExperiment",rds:va(e.rds,!0)}}function Ya(e){var t,r,n=e.findAttribute("names");if(n<0)return null;try{r=(t=e.attribute(n)).values()}catch(i){throw new Error("failed to load listData names; "+i.message)}finally{S.gd(t)}if(r.length!=e.length())throw new Error("expected names to have same length as listData");return r}function Ja(e){Xa(e,{DFrame:"S4Vectors"},"DFrame");var t,r,n={},i={};try{if(!((t=e.attribute("listData"))instanceof ve))throw new Error("listData slot should be a generic list");var a=Ya(t);if(null==a)throw new Error("expected the listData list to be named");for(var s=0;s<t.length();s++){var o=void 0;try{(o=t.load(s))instanceof le&&!(o instanceof ve)&&(i[a[s]]=o.values())}finally{S.gd(o)}}}catch(u){throw new Error("failed to retrieve data from DataFrame's listData; "+u.message)}finally{S.gd(t)}n.columns=i;try{(r=e.attribute("rownames")).type()instanceof de&&(n.row_names=rhandle.values())}catch(u){throw new Error("failed to retrieve row names from DataFrame; "+u.message)}finally{S.gd(r)}return n}function Xa(e,t,r){if(!(e instanceof pe))throw new Error("expected an S4 object as the data frame");for(var n=0,i=Object.entries(t);n<i.length;n++){var a=(0,h.Z)(i[n],2),s=a[0],o=a[1];if(e.className()==s&&e.packageName()==o)return}throw new Error("object is not a "+r+" or one of its recognized subclasses")}function Ka(e){var t,r=e.attribute("colData");try{t=Ja(r)}catch(n){throw new Error("failed to extract colData from a SummarizedExperiment; "+n.message)}finally{S.gd(r)}return t.columns}function $a(e){var t,r=e.findAttribute("NAMES");if(r<0)return null;var n=null;try{(t=e.attribute(r))instanceof de&&(n=t.values())}catch(i){throw new Error("failed to extract NAMES; "+i.message)}finally{S.gd(t)}return n}function es(e){var t={},r=null,n=e.findAttribute("rowRanges");if(n<0){var i;try{t=Ja(i=e.attribute("elementMetadata"))}catch(g){throw new Error("failed to extract features from the rowData; "+g.message)}finally{S.gd(i)}r=$a(e)}else{var a;try{var s=(a=e.attribute(n)).attribute("elementMetadata");try{t=Ja(s)}catch(g){throw new Error("failed to extract mcols from the rowRanges; "+g.message)}finally{S.gd(s)}var o,u,l=a.findAttribute("partitioning");if(l<0)try{r=$a(o=a.attribute("ranges"))}catch(g){throw new Error("failed to extract names from the rowRanges; "+g.message)}finally{S.gd(o)}else try{r=$a(u=a.attribute(l))}catch(g){throw new Error("failed to extract names from the rowRanges; "+g.message)}finally{S.gd(u)}}catch(g){throw new Error("failed to extract features from the rowRanges; "+g.message)}finally{S.gd(a)}}for(var c={id:r},f=0,d=Object.entries(t.columns);f<d.length;f++){var v=(0,h.Z)(d[f],2),p=v[0],m=v[1];p.match(/^sym/)&&(c[p]=m)}return c}function ts(e){var t,r,n,i;try{var a,s=Ya(i=(n=(r=e.attribute("assays")).attribute("data")).attribute("listData")),o=1;if(null!=s)for(var u=0;u<s.length;u++)if(s[u].match(/^count/i)){o=u;break}try{t=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.consume,i=void 0!==n&&n,a=r.layered,s=void 0===a||a,o=null;try{(t=I.R((function(t){return t.initialize_sparse_matrix_from_rds(e.object.$$.ptr,s,i)}),O.p)).isReorganized()&&(o=t.identities(),t.wipeIdentities())}catch(u){throw S.gd(t),u}return{matrix:t,row_ids:o}}(a=i.load(o))}catch(l){throw new Error("failed to initialize sparse matrix from assay; "+l.message)}finally{S.gd(a)}}catch(l){throw new Error("failed to extract assay data; "+l.message)}finally{S.gd(r),S.gd(i),S.gd(n)}return t}function rs(e){Xa(e,{SummarizedExperiment:"SummarizedExperiment",RangedSummarizedExperiment:"SummarizedExperiment",SingleCellExperiment:"SingleCellExperiment",SpatialExperiment:"SpatialExperiment"},"SummarizedExperiment");var t={};t.genes=es(e);var r=Ka(e),n=Object.entries(r);if(n.length){t.annotations={};var i,a=(0,o.Z)(n);try{for(a.s();!(i=a.n()).done;){var s=(0,h.Z)(i.value,2),u=s[0],l=s[1];t.annotations[u]=aa(l)}}catch(bn){a.e(bn)}finally{a.f()}}else t.annotations=null;return t}function ns(e){var t=e.findAttribute("int_colData");if(t<0)return{};var r,n,i,a,s,o,u={};try{var l=(r=e.attribute(t)).findAttribute("listData");if(l<0)return{};var c=(n=r.attribute(l)).findAttribute("names");if(c<0)return{};var h=(i=n.attribute(c)).values().indexOf("altExps");if(h<0)return{};var f=(a=n.load(h)).findAttribute("listData");if(f<0)return{};var d=(s=a.attribute(f)).findAttribute("names");if(d<0)return{};for(var v=(o=s.attribute(d)).values(),p=0;p<v.length;p++){var m=void 0;try{m=s.load(p),u[v[p]]=m.attribute("se")}finally{S.gd(m)}}}catch(y){for(var g=0,b=Object.values(u);g<b.length;g++){var w=b[g];S.gd(w)}throw y}finally{S.gd(o),S.gd(s),S.gd(i),S.gd(n),S.gd(r)}return u}var is={ADT:[/^adt/i,/^hto/i,/^antibody/i]};function as(e){return ss.apply(this,arguments)}function ss(){return(ss=(0,f.Z)(x.mark((function e(t){var r,n,i,a,s,u,l,c,f,d,v,p,m,g,b,w,y,_,Z,k,A,E,I,O;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},n={},i=va(t.rds,!1),a=ea(i.content),l={},e.prev=5,s=_e(a),u=s.value(),c=rs(u),r=c.annotations,n.RNA=c.genes,l=ns(u),f=0,d=Object.entries(is);case 13:if(!(f<d.length)){e.next=47;break}v=(0,h.Z)(d[f],2),p=v[0],m=v[1],g=!1,b=(0,o.Z)(m),e.prev=17,b.s();case 19:if((w=b.n()).done){e.next=36;break}y=w.value,_=0,Z=Object.keys(l);case 22:if(!(_<Z.length)){e.next=32;break}if(!(k=Z[_]).match(y)){e.next=29;break}return g=!0,A=rs(l[k]),n[p]=A.genes,e.abrupt("break",32);case 29:_++,e.next=22;break;case 32:if(!g){e.next=34;break}return e.abrupt("break",36);case 34:e.next=19;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(17),b.e(e.t0);case 41:return e.prev=41,b.f(),e.finish(41);case 44:f++,e.next=13;break;case 47:for(e.prev=47,E=0,I=Object.values(l);E<I.length;E++)O=I[E],S.gd(O);return S.gd(u),S.gd(s),e.finish(47);case 52:return e.abrupt("return",{annotations:r,genes:n});case 53:case"end":return e.stop()}}),e,null,[[5,,47,52],[17,38,41,44]])})))).apply(this,arguments)}var os=new WeakMap,us=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,m.Z)(this,e),(0,y.Z)(this,os,{writable:!0,value:void 0}),r?(0,A.Z)(this,os,t.rds):(0,A.Z)(this,os,va(t.rds,!1))}return(0,g.Z)(e,[{key:"load",value:function(){var e,t,r=ea((0,k.Z)(this,os).content),n={},i={};try{t=(e=_e(r)).value(),n.matrix=new Re;var a=ts(t),s=a.matrix,u=a.row_ids;n.matrix.add("RNA",s);var l=es(t),c=ca(s.numberOfRows(),u,l);n.genes={RNA:c},n.row_ids={RNA:u},n.annotations=Ka(t),i=ns(t);for(var f=0,d=Object.entries(is);f<d.length;f++){var v,p=(0,h.Z)(d[f],2),m=p[0],g=p[1],b=!1,w=(0,o.Z)(g);try{for(w.s();!(v=w.n()).done;){for(var y=v.value,_=0,Z=Object.keys(i);_<Z.length;_++){var A=Z[_];if(A.match(y)){b=!0;var x=i[A],E=ts(x);n.matrix.add(m,E.matrix),n.row_ids[m]=E.row_ids;var I=es(x),O=ca(s.numberOfRows(),E.row_ids,I);n.genes[m]=O;break}}if(b)break}}catch(bn){w.e(bn)}finally{w.f()}}}catch(B){throw S.gd(n.matrix),B}finally{for(var C=0,R=Object.values(i);C<R.length;C++){var D=R[C];S.gd(D)}S.gd(t),S.gd(e)}return n}},{key:"format",value:function(){return"SummarizedExperiment"}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ba((0,k.Z)(this,os),"rds",t);case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ls(e,t){return cs.apply(this,arguments)}function cs(){return(cs=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},i=(0,o.Z)(t),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=11;break}return s=a.value,e.next=8,ya(s,r);case 8:n[s.type]=e.sent;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),i.e(e.t0);case 16:return e.prev=16,i.f(),e.finish(16);case 19:return e.abrupt("return",new us(n,!0));case 20:case"end":return e.stop()}}),e,null,[[2,13,16,19]])})))).apply(this,arguments)}function hs(e){if(!(e in fs))throw"unknown matrix format '"+e+"'";return fs[e]}var fs={MatrixMarket:a,"10X":n,H5AD:i,SummarizedExperiment:s},ds="inputs",vs="raw_subset_indices",ps=new WeakMap,ms=new WeakMap,gs=new WeakMap,bs=new WeakSet,ws=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,m.Z)(this,e),w(this,bs),(0,y.Z)(this,ps,{writable:!0,value:void 0}),(0,y.Z)(this,ms,{writable:!0,value:void 0}),(0,y.Z)(this,gs,{writable:!0,value:void 0}),(0,A.Z)(this,ps,null===t?{}:t),(0,A.Z)(this,ms,null===r?{}:r),(0,A.Z)(this,gs,null===n?{}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,ms).matrix),Ht((0,k.Z)(this,ms).raw_matrix),Ht((0,k.Z)(this,ms).block_ids),Ht((0,k.Z)(this,ms).raw_block_ids),Ht((0,k.Z)(this,ms).multi_block_ids)}},{key:"listAvailableTypes",value:function(){return(0,k.Z)(this,ms).matrix.available()}},{key:"hasAvailable",value:function(e){return(0,k.Z)(this,ms).matrix.has(e)}},{key:"fetchCountMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=void 0===t?"RNA":t;return(0,k.Z)(this,ms).matrix.get(r)}},{key:"fetchGenes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=void 0===t?"RNA":t;return(0,k.Z)(this,ms).genes[r]}},{key:"fetchRowIds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=void 0===t?"RNA":t;return(0,k.Z)(this,ms).row_ids[r]}},{key:"fetchGeneTypes",value:function(){return(0,k.Z)(this,ms).gene_types}},{key:"fetchAnnotations",value:function(e){var t=(0,k.Z)(this,ms).annotations;if(null===t||!(e in t))throw new Error("".concat(e," does not exist in the column annotations"));return t[e].slice()}},{key:"fetchBlock",value:function(){return(0,k.Z)(this,ms).block_ids}},{key:"fetchBlockLevels",value:function(){return(0,k.Z)(this,ms).block_levels}},{key:"fetchParameters",value:function(){var t,r=p({},(0,k.Z)(this,ps));return r.subset=Z(t=this.constructor,e,ys).call(t,r.subset),r}},{key:"fetchDirectSubset",value:function(){return vs in(0,k.Z)(this,ms)?(0,k.Z)(this,ms).raw_subset_indices.slice():null}},{key:"compute",value:function(){var t=(0,f.Z)(x.mark((function t(r,n,i){var a,s,u,l,c,f,d,v,p,m,g,b,w,y,_,E;return x.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.changed=!1,null===r){t.next=14;break}for(a=Object.entries(r),s={},u=0,l=a;u<l.length;u++)c=(0,h.Z)(l[u],2),f=c[0],d=c[1],v=hs(d.format),s[f]=v.abbreviate(d);if(!Jt(s,(0,k.Z)(this,gs))){t.next=14;break}p={},m=(0,o.Z)(a);try{for(m.s();!(g=m.n()).done;)b=(0,h.Z)(g.value,2),w=b[0],y=b[1],_=hs(y.format),p[w]=new _.Reader(y)}catch(bn){m.e(bn)}finally{m.f()}return t.next=11,Cs(p,(0,k.Z)(this,ms));case 11:(0,A.Z)(this,gs,s),(0,k.Z)(this,ms).readers=p,this.changed=!0;case 14:return(this.changed||(0,k.Z)(this,ps).sample_factor!==n)&&(Ds(n,(0,k.Z)(this,ms)),(0,k.Z)(this,ps).sample_factor=n,this.changed=!0),(this.changed||!(vs in(0,k.Z)(this,ms))&&Jt(i,(0,k.Z)(this,ps).subset))&&(Bs(i,(0,k.Z)(this,ms)),(0,k.Z)(this,ps).subset=Z(E=this.constructor,e,ys).call(E,i),this.changed=!0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"undoSubset",value:function(e){var t=null;"subset"in(0,k.Z)(this,ps)&&(t=(0,k.Z)(this,ps).subset);var r=Ss(t,(0,k.Z)(this,ms));null!==r&&e.forEach((function(t,n){e[n]=r[t]}))}},{key:"setDirectSubset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r,i=t.onOriginal,a=void 0!==i&&i;null!==e?(0,k.Z)(this,ms).raw_subset_indices=_(this,bs,_s).call(this,e,n,a):delete(0,k.Z)(this,ms).raw_subset_indices,"matrix"in(0,k.Z)(this,ms)&&(Bs((0,k.Z)(this,ps).subset,(0,k.Z)(this,ms)),this.changed=!0)}},{key:"createDirectSubset",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.copy,i=void 0===n||n,a=r.onOriginal,s=void 0!==a&&a,o={};o.raw_subset_indices=_(this,bs,_s).call(this,t,i,s),o.raw_matrix=Is((0,k.Z)(this,ms).raw_matrix);for(var u=0,l=["multi_block_ids","raw_block_ids"];u<l.length;u++){var c=l[u];c in(0,k.Z)(this,ms)&&(null===(0,k.Z)(this,ms)[c]?o[c]=null:o[c]=(0,k.Z)(this,ms)[c].clone())}for(var h=0,f=["raw_annotations","genes","gene_types","multi_block_levels","raw_block_levels"];h<f.length;h++){var d=f[h];d in(0,k.Z)(this,ms)&&(o[d]=(0,k.Z)(this,ms)[d])}Bs(null,o);var v=this.fetchParameters();return v.subset=null,new e(v,o,(0,k.Z)(this,gs))}},{key:"summary",value:function(){var e,t={},r=(0,o.Z)((0,k.Z)(this,ms).matrix.available());try{for(r.s();!(e=r.n()).done;){var n=e.value;t[n]=(0,k.Z)(this,ms).matrix.get(n).numberOfRows()}}catch(bn){r.e(bn)}finally{r.f()}var i={num_cells:(0,k.Z)(this,ms).matrix.numberOfColumns(),num_genes:t,genes:p({},(0,k.Z)(this,ms).genes)};return null!==(0,k.Z)(this,ms).annotations&&(i.annotations=Object.keys((0,k.Z)(this,ms).annotations)),i}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s,u,l,h,f,d,v,p,m,g,b,w,y,_,Z,A,E,S,I,O,C,R,D,B,z,F,N;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.createGroup("inputs"),!1,i=n.createGroup("parameters"),(a=Object.keys((0,k.Z)(this,ms).readers)).sort(),s=[],u=[],l=i.createGroup("files"),h=0,f=0,d=a;case 10:if(!(f<d.length)){e.next=50;break}return v=d[f],p=(0,k.Z)(this,ms).readers[v],s.push(p.format()),e.next=16,p.serialize(r);case 16:m=e.sent,u.push(m.length),g=(0,o.Z)(m),e.prev=19,g.s();case 21:if((b=g.n()).done){e.next=39;break}if(w=b.value,(y=l.createGroup(String(h))).writeDataSet("type","String",[],w.type),y.writeDataSet("name","String",[],w.name),"string"!=typeof w.id){e.next=30;break}y.writeDataSet("id","String",[],w.id),e.next=36;break;case 30:if("number"!=typeof w.offset||"number"!=typeof w.size){e.next=35;break}y.writeDataSet("offset","Uint32",[],w.offset),y.writeDataSet("size","Uint32",[],w.size),e.next=36;break;case 35:throw new Error("object should contain either an 'id' string or 'offset' and 'size' numbers");case 36:h++;case 37:e.next=21;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(19),g.e(e.t0);case 44:return e.prev=44,g.f(),e.finish(44);case 47:f++,e.next=10;break;case 50:if(s.length>1?(!0,i.writeDataSet("format","String",null,s),i.writeDataSet("sample_groups","Int32",null,u),i.writeDataSet("sample_names","String",null,a)):(i.writeDataSet("format","String",[],s[0]),null!==(0,k.Z)(this,ps).sample_factor&&i.writeDataSet("sample_factor","String",[],(0,k.Z)(this,ps).sample_factor)),null===(0,k.Z)(this,ps).subset&&!(vs in(0,k.Z)(this,ms))){e.next=64;break}if(_=i.createGroup("subset"),Z=_.createGroup("cells"),!(vs in(0,k.Z)(this,ms))){e.next=58;break}Z.writeDataSet("indices","Int32",null,(0,k.Z)(this,ms).raw_subset_indices),e.next=64;break;case 58:if(!("field"in(0,k.Z)(this,ps).subset)){e.next=63;break}Z.writeDataSet("field","String",[],(0,k.Z)(this,ps).subset.field),"values"in(0,k.Z)(this,ps).subset?Z.writeDataSet("values","String",null,(0,k.Z)(this,ps).subset.values):(E=(0,k.Z)(this,ps).subset.ranges,Os(S=(A=[]).concat.apply(A,c(E))),Z.writeDataSet("ranges","Float64",[S.length/2,2],S)),e.next=64;break;case 63:throw new Error("unrecognized specification for 'subset'");case 64:(I=n.createGroup("results")).writeDataSet("num_cells","Int32",[],(0,k.Z)(this,ms).matrix.numberOfColumns()),O=I.createGroup("num_features"),C=(0,o.Z)((0,k.Z)(this,ms).matrix.available());try{for(C.s();!(R=C.n()).done;)D=R.value,O.writeDataSet(D,"Int32",[],(0,k.Z)(this,ms).matrix.get(D).numberOfRows())}catch(bn){C.e(bn)}finally{C.f()}null!==(0,k.Z)(this,ms).block_levels&&I.writeDataSet("num_samples","Int32",[],(0,k.Z)(this,ms).block_levels.length),B=I.createGroup("identities"),z=(0,o.Z)((0,k.Z)(this,ms).matrix.available());try{for(z.s();!(F=z.n()).done;)N=F.value,B.writeDataSet(N,"Int32",null,(0,k.Z)(this,ms).row_ids[N])}catch(bn){z.e(bn)}finally{z.f()}return e.abrupt("return");case 74:case"end":return e.stop()}}),e,this,[[19,41,44,47]])})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"defaults",value:function(){return{sample_factor:null,subset:null}}}]),e}();function ys(e){if(null==e)return e;var t=p({},e);return"values"in t&&(t.values=t.values.slice()),"ranges"in t&&(t.ranges=t.ranges.map((function(e){return e.slice()}))),t}function _s(e,t,r){return $t(e,null),t&&(e=e.slice()),r||this.undoSubset(e),e}function Zs(e){var t={"symbol-mouse":[],"symbol-human":[],"ensembl-mouse":[],"ensembl-human":[]},r={};Object.keys(t).forEach((function(e){r[e]=[]}));for(var n=Object.keys(e),i=0,a=n;i<a.length;i++){for(var s=e[a[i]],o={},u={},l=0,c=Object.entries(s);l<c.length;l++){var f=(0,h.Z)(c[l],2),d=f[0],v=Ae(f[1]),p=v.type+"-"+v.species;(!(p in o)||v.confidence>o[p])&&(o[p]=v.confidence,u[p]=d)}for(var m=0,g=Object.entries(u);m<g.length;m++){var b=(0,h.Z)(g[m],2),w=b[0],y=b[1];r[w].push(y),t[w].push(o[w])}}for(var _=-1e3,Z=null,k=0,A=Object.entries(t);k<A.length;k++){var x=(0,h.Z)(A[k],2),E=x[0],S=x[1];if(S.length==n.length){var I=S.reduce((function(e,t){return e*t}));I>_&&(_=I,Z=E)}}var O={},C=null;if(null!==Z){var R=r[Z],D=Z.split("-");C={type:D[0],species:D[1]};for(var B=0;B<n.length;B++)O[n[B]]=R[B]}return{best_type:C,best_fields:O}}function ks(e,t,r){var n={};try{var i,a={},s=(0,o.Z)(e);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(a[u]=t[u].genes[r],null===a[u])throw new Error("no gene annotations found in matrix '"+u+"'")}}catch(bn){s.e(bn)}finally{s.f()}var l=Zs(a);if(null===l.best_type)throw new Error("no common feature types available across all matrices");var c,h=l.best_fields,f=[],d=[],v=(0,o.Z)(e);try{for(v.s();!(c=v.n()).done;){var p=c.value;f.push(a[p][h[p]]),d.push(t[p].matrix.get(r))}}catch(bn){v.e(bn)}finally{v.f()}var m=function(e,t){var r,n,i,a=[],s={};try{var u;!function(){if(t.length!==e.length)throw new Error("length of 'names' should be equal to length of 'x'");var l={},c=[];for(u=0;u<t.length;u++){if(e[u].numberOfRows()!==t[u].length)throw new Error("length of each 'names' must equal number of rows of its corresponding 'x'");t[u].forEach((function(e){e in l||(l[e]=c.length,c.push(e))}))}var h=(n=S.GF(e.length)).array(),f=function(){var e=t[u],r=S.Wf(e.length),n=r.array();e.forEach((function(e,t){n[t]=l[e]})),a.push(r),h[u]=BigInt(r.offset)};for(u=0;u<t.length;u++)f();r=Ie(e),i=S.Wf(e[0].numberOfRows()),s.matrix=I.R((function(t){return t.cbind_with_rownames(e.length,r.offset,n.offset,i.offset)}),O.p),s.indices=i.slice(0,s.matrix.numberOfRows());var d,v=[],p=(0,o.Z)(s.indices);try{for(p.s();!(d=p.n()).done;){var m=d.value;v.push(t[0][m])}}catch(bn){p.e(bn)}finally{p.f()}s.names=v}()}catch(f){throw S.gd(s.matrix),f}finally{S.gd(r),S.gd(n),S.gd(i);for(var l=0,c=a;l<c.length;l++){var h=c[l];S.gd(h)}}return s}(d,f);n.matrix=m.matrix;var g=e[0];n.genes=Ee(a[g],m.indices),n.row_ids=Ze(m.indices,t[g].row_ids[r])}catch(b){throw Ht(n.matrix),b}return n}function As(e,t){var r,n,i=null,a=(0,o.Z)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;null===i?i=t[s].matrix.available():function(){var e=new Set(t[s].matrix.available());i=i.filter((function(t){return e.has(t)}))}()}}catch(bn){a.e(bn)}finally{a.f()}var u={matrix:new Re,genes:{},row_ids:{}};try{var l,c=(0,o.Z)(i);try{for(c.s();!(l=c.n()).done;){var h=l.value,f=ks(e,t,h);u.matrix.add(h,f.matrix),u.genes[h]=f.genes,u.row_ids[h]=f.row_ids}}catch(bn){c.e(bn)}finally{c.f()}var d,v=[],p=[],m=(0,o.Z)(e);try{for(m.s();!(d=m.n()).done;){var g=d.value,b=t[g];null!==b.annotations?p.push(b.annotations):p.push({}),v.push(b.matrix.numberOfColumns())}}catch(bn){m.e(bn)}finally{m.f()}u.annotations=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).lengths,r=void 0===t?null:t;if(null===r){r=[];var n,i=(0,o.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,s=Object.keys(a);if(0==s.length)throw new Error("all 'inputs' must be non-empty if 'lengths = null'");r.push(a[s[0]].length)}}catch(bn){i.e(bn)}finally{i.f()}}else if(r.length!=e.length)throw new Error("'lengths' and 'inputs' should have the same length");var u=0;r.forEach((function(e){u+=e}));var l,c=new Set,h=(0,o.Z)(e);try{for(h.s();!(l=h.n()).done;)for(var f=l.value,d=0,v=Object.keys(f);d<v.length;d++){var p=v[d];c.add(p)}}catch(bn){h.e(bn)}finally{h.f()}for(var m=Array.from(c),g={},b=function(){var t=y[w],n=void 0;for(_=0;_<r.length;_++){var i=e[_];if(!(t in i)){n=Array;break}if("undefined"==typeof n)n=i[t].constructor;else if(n!==i[t].constructor){n=Array;break}}var a=new n(u),s=0;for(_=0;_<r.length;_++){var o=e[_],l=r[_];if(t in o){if(o[t].length!=l)throw new Error("mismatch in lengths for '"+t+"' in input object "+String(_+1));o[t].forEach((function(e,t){a[t+s]=e}))}else a.fill(null,s,s+l);s+=l}g[t]=a},w=0,y=m;w<y.length;w++){var _;b()}return g}(p,{lengths:v});var w=new Array(e.length);e.forEach((function(e,r){w[r]=t[e].matrix.numberOfColumns()})),n=function(e){var t,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).buffer,n=void 0===r?null:r,i=0;e.forEach((function(e){i+=e}));try{if(null==n)n=t=S.Wf(i);else if(n.length!==i)throw new Error("'buffer' should have length equal to sum of 'ncells'");for(var a=n.array(),s=0,o=0;o<e.length;o++){var u=s;s+=e[o],a.fill(o,u,s)}}catch(l){throw S.gd(t),l}return n}(w),u.block_ids=n,u.block_levels=e;var y=new Array(n.length);n.forEach((function(t,r){y[r]=e[t]})),u.annotations.__batch__=y}catch(_){throw Ht(n),Ht(u.matrix),_}return u}function xs(e){return Es.apply(this,arguments)}function Es(){return(Es=(0,f.Z)(x.mark((function e(t){var r,n,i,a,s,o,u,l,c,f,d,v,p,m;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},e.prev=1,n=0,i=Object.entries(t);case 3:if(!(n<i.length)){e.next=11;break}return a=(0,h.Z)(i[n],2),s=a[0],o=a[1],e.next=7,o.load();case 7:r[s]=e.sent;case 8:n++,e.next=3;break;case 11:e.next=17;break;case 13:for(e.prev=13,e.t0=e.catch(1),u=0,l=Object.entries(r);u<l.length;u++)c=(0,h.Z)(l[u],2),c[0],Ht(c[1].matrix);throw e.t0;case 17:if((f=Object.keys(r)).sort(),1==f.length)(d=r[f[0]]).block_ids=null,d.block_levels=null;else try{d=As(f,r)}finally{for(v=0,p=Object.entries(r);v<p.length;v++)m=(0,h.Z)(p[v],2),m[0],Ht(m[1].matrix)}return e.abrupt("return",d);case 21:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function Ss(e,t){var r=null;if(vs in t)r=t.raw_subset_indices;else if(null!==e){if(!(e.field in t.raw_annotations))throw new Error("failed to find 'subset.field' in the column annotations");var n=t.raw_annotations[e.field];if(r=[],"values"in e){var i=new Set(e.values);n.forEach((function(e,t){i.has(e)&&r.push(t)}))}else n.forEach((function(t,n){var i,a=(0,o.Z)(e.ranges);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(t>=s[0]&&t<=s[1])return void r.push(n)}}catch(bn){a.e(bn)}finally{a.f()}}))}return r}function Is(e){var t=new Re;try{var r,n=(0,o.Z)(e.available());try{for(n.s();!(r=n.n()).done;){var i=r.value,a=e.get(i);t.add(i,a.clone())}}catch(bn){n.e(bn)}finally{n.f()}}catch(s){throw t.free(),s}return t}function Os(e){if(e.length%2!==0)throw new Error("'ranges' should have two columns in 'subset'");for(var t=1;t<e.length;t++)if(e[t]<e[t-1])throw new Error("'ranges' should be sorted in increasing order")}function Cs(e,t){return Rs.apply(this,arguments)}function Rs(){return Rs=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s,o,u,l,c;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ht(r.raw_matrix),Ht(r.matrix),Ht(r.multi_block_ids),e.next=5,xs(t);case 5:for(n=e.sent,r.raw_matrix=n.matrix,r.row_ids=n.row_ids,r.raw_annotations=n.annotations,r.multi_block_ids=n.block_ids,r.multi_block_levels=n.block_levels,r.genes=n.genes,i={},a=r.genes.RNA,s=0,o=Object.entries(a);s<o.length;s++)u=(0,h.Z)(o[s],2),l=u[0],c=u[1],i[l]=Ae(c);r.gene_types=i;case 16:case"end":return e.stop()}}),e)}))),Rs.apply(this,arguments)}function Ds(e,t){Ht(t.raw_block_ids);var r=null,n=null;if(null!==e)try{var i=t.raw_annotations[e];if(i.length!=t.raw_matrix.numberOfColumns())throw new Error("length of sample factor '"+e+"' should be equal to the number of cells");var a=function(e){var t,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).buffer,n=void 0===r?null:r,i=[];try{if(null==n)n=t=S.Wf(e.length);else if(n.length!==e.length)throw new Error("'buffer' should have length equal to that of 'x'");var a=n.array(),s={};e.forEach((function(e,t){e in s||(s[e]=i.length,i.push(e)),a[t]=s[e]}))}catch(o){throw S.gd(t),o}return{ids:n,levels:i}}(i);r=a.ids,n=a.levels}catch(s){throw Ht(r),s}else r=null!==t.multi_block_ids?t.multi_block_ids.view():null,n=t.multi_block_levels;t.raw_block_ids=r,t.raw_block_levels=n}function Bs(e,t){Ht(t.matrix),Ht(t.block_ids);var r,n,i,a,s=Ss(e,t);try{if(null===s)r=t.raw_annotations,n=Is(t.raw_matrix),null!==t.raw_block_ids?(i=t.raw_block_ids.view(),a=t.raw_block_levels):(i=null,a=null);else{if(r=Ee(t.raw_annotations,s),null!==t.raw_block_ids)a=function(e){e instanceof xe.PQ&&(e=e.array());var t=new Set(e),r=Array.from(t).sort(),n={};return r.forEach((function(e,t){n[e]=t})),e.forEach((function(t,r){e[r]=n[t]})),r}(i=Se(t.raw_block_ids,s)).map((function(e){return t.raw_block_levels[e]}));else i=null,a=null;n=new Re;var u,l=(0,o.Z)(t.raw_matrix.available());try{for(l.s();!(u=l.n()).done;){var c=u.value,h=t.raw_matrix.get(c);n.add(c,Be(h,s))}}catch(bn){l.e(bn)}finally{l.f()}}}catch(f){throw Ht(n),Ht(i),f}t.annotations=r,t.block_levels=a,t.block_ids=i,t.matrix=n}function zs(e){return function(t){var r=t.slice();t.forEach((function(n,i){t[i]=r[e[i]]}))}}function Fs(e,t){return Ns.apply(this,arguments)}function Ns(){return Ns=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s,u,l,c,h,f,d,v,p,m,g,b,w,y,_,Z,k,A,E,S,I,O,C,R,D,B,z,F,N,M,G,W,j,T,U,Q,q,P,L,V,H,Y,J,X,K,$,ee,te,re,ne,ie,ae,se,oe,ue,le,ce,he;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.open("inputs"),i=n.open("parameters"),a=i.open("files"),s=a.children,u=new Array(s.length),l=0,c=Object.keys(s);l<c.length;l++){for(h=c[l],f=a.open(h),d={},v=0,p=["type","name"];v<p.length;v++)m=p[v],g=f.open(m,{load:!0}),d[m]=g.values[0];if("id"in f.children)d.id=f.open("id",{load:!0}).values[0];else for(b=0,w=["offset","size"];b<w.length;b++)d[y=w[b]]=f.open(y,{load:!0}).values[0];_=Number(h),u[_]=d}if(Z={},k={sample_factor:null},A=i.open("format",{load:!0}),!(E=0==A.shape.length)){e.next=19;break}return S=A.values[0],I=hs(S),e.next=15,I.unserialize(u,r);case 15:Z.default=e.sent,"sample_factor"in i.children?k.sample_factor=i.open("sample_factor",{load:!0}).values[0]:k.sample_factor=null,e.next=35;break;case 19:O=A.values,C=i.open("sample_names",{load:!0}).values,R=i.open("sample_groups",{load:!0}).values,D=0,B=0;case 24:if(!(B<O.length)){e.next=35;break}return z=D,D+=R[B],F=u.slice(z,D),N=hs(O[B]),e.next=31,N.unserialize(F,r);case 31:Z[C[B]]=e.sent;case 32:B++,e.next=24;break;case 35:if(M=null,G=null,!("subset"in i.children)){e.next=51;break}if(!("cells"in(W=i.open("subset")).children)){e.next=51;break}if(!("indices"in(j=W.open("cells")).children)){e.next=45;break}G=j.open("indices",{load:!0}).values,e.next=51;break;case 45:if(!("field"in j.children)){e.next=50;break}if(M={field:j.open("field",{load:!0}).values[0]},"values"in j.children)M.values=j.open("values",{load:!0}).values;else{for(Os(T=j.open("ranges",{load:!0}).values),U=[],B=0;B<T.length/2;B++)U.push([T[2*B],T[2*B+1]]);M.ranges=U}e.next=51;break;case 50:throw new Error("unrecognized specification for 'subset'");case 51:return k.subset=M,Q={readers:Z},e.next=55,Cs(Z,Q);case 55:if(Ds(k.sample_factor,Q),null!==G&&(Q.raw_subset_indices=G),Bs(k.subset,Q),q=n.open("results"),P={},!E){e.next=64;break}if("permutation"in q.children)L=q.open("permutation",{load:!0}),V=new Int32Array(L.values.length),L.values.forEach((function(e,t){V[e]=t})),P.RNA=ke(Q.row_ids.RNA,V);else if("identities"in q.children)if("DataSet"==q.children.identities)H=q.open("identities",{load:!0}),P.RNA=ke(Q.row_ids.RNA,H.values);else for(Y=q.open("identities"),J=0,X=Object.keys(Y.children);J<X.length;J++)K=X[J],Q.matrix.has(K)&&($=Y.open(K,{load:!0}),P[K]=ke(Q.row_ids[K],$.values));e.next=80;break;case 64:if(!("indices"in q.children)){e.next=79;break}ee=q.open("indices",{load:!0}).values,te=Q.row_ids.RNA.slice().sort(),re=ee.slice().sort(),B=0;case 69:if(!(B<re.length)){e.next=76;break}if(te[B]==re[B]){e.next=73;break}return console.log([B,te[B],re[B]]),e.abrupt("break",76);case 73:B++,e.next=69;break;case 76:P.RNA=ke(Q.row_ids.RNA,ee),e.next=80;break;case 79:if("DataSet"==q.children.identities)ee=q.open("identities",{load:!0}).values,P.RNA=ke(Q.row_ids.RNA,ee);else for(ne=q.open("identities"),ie=0,ae=Object.keys(ne.children);ie<ae.length;ie++)se=ae[ie],Q.matrix.has(se)&&(oe=ne.open(se,{load:!0}),P[se]=ke(Q.row_ids[se],oe.values));case 80:ue={},le=(0,o.Z)(Q.matrix.available());try{for(le.s();!(ce=le.n()).done;)(he=ce.value)in P&&null!==P[he]?ue[he]=zs(P[he]):ue[he]=function(e){}}catch(bn){le.e(bn)}finally{le.f()}return e.abrupt("return",{state:new ws(k,Q),permuters:ue});case 84:case"end":return e.stop()}}),e)}))),Ns.apply(this,arguments)}function Ms(e,t,r){for(var n={},i=r.array(),a=0;a<t.length;a++){for(var s={},o=0,u=Object.entries(e);o<u.length;o++){var l=(0,h.Z)(u[o],2),c=l[0],f=l[1];s[c]=f.array().filter((function(e,t){return i[t]==a}))}n[t[a]]=s}return n}function Gs(e,t){var r,n={},i=(0,o.Z)(t);try{for(i.s();!(r=i.n()).done;){n[r.value]={}}}catch(bn){i.e(bn)}finally{i.f()}for(var a=0,s=Object.entries(e);a<s.length;a++)for(var u=(0,h.Z)(s[a],2),l=u[0],c=u[1],f=0;f<t.length;f++)n[t[f]][l]=c[f];return n}var Ws=(0,g.Z)((function e(){(0,m.Z)(this,e)})),js={};js.ensembl=new Set(["ENSMUSG00000064336","ENSMUSG00000064337","ENSMUSG00000064338","ENSMUSG00000064339","ENSMUSG00000064340","ENSMUSG00000064341","ENSMUSG00000064342","ENSMUSG00000064343","ENSMUSG00000064344","ENSMUSG00000064345","ENSMUSG00000064346","ENSMUSG00000064347","ENSMUSG00000064348","ENSMUSG00000064349","ENSMUSG00000064350","ENSMUSG00000064351","ENSMUSG00000064352","ENSMUSG00000064353","ENSMUSG00000064354","ENSMUSG00000064355","ENSMUSG00000064356","ENSMUSG00000064357","ENSMUSG00000064358","ENSMUSG00000064359","ENSMUSG00000064360","ENSMUSG00000064361","ENSMUSG00000064363","ENSMUSG00000064364","ENSMUSG00000064365","ENSMUSG00000064366","ENSMUSG00000064367","ENSMUSG00000064368","ENSMUSG00000064369","ENSMUSG00000064370","ENSMUSG00000064371","ENSMUSG00000064372","ENSMUSG00000065947","ENSG00000198695","ENSG00000198712","ENSG00000198727","ENSG00000198763","ENSG00000198786","ENSG00000198804","ENSG00000198840","ENSG00000198886","ENSG00000198888","ENSG00000198899","ENSG00000198938","ENSG00000209082","ENSG00000210049","ENSG00000210077","ENSG00000210082","ENSG00000210100","ENSG00000210107","ENSG00000210112","ENSG00000210117","ENSG00000210127","ENSG00000210135","ENSG00000210140","ENSG00000210144","ENSG00000210151","ENSG00000210154","ENSG00000210156","ENSG00000210164","ENSG00000210174","ENSG00000210176","ENSG00000210184","ENSG00000210191","ENSG00000210194","ENSG00000210195","ENSG00000210196","ENSG00000211459","ENSG00000212907","ENSG00000228253"]),js.symbol=new Set(["mt-Tf","mt-Rnr1","mt-Tv","mt-Rnr2","mt-Tl1","mt-Nd1","mt-Ti","mt-Tq","mt-Tm","mt-Nd2","mt-Tw","mt-Ta","mt-Tn","mt-Tc","mt-Ty","mt-Co1","mt-Ts1","mt-Td","mt-Co2","mt-Tk","mt-Atp8","mt-Atp6","mt-Co3","mt-Tg","mt-Nd3","mt-Tr","mt-Nd4","mt-Th","mt-Ts2","mt-Tl2","mt-Nd5","mt-Nd6","mt-Te","mt-Cytb","mt-Tt","mt-Tp","mt-Nd4l","MT-ND6","MT-CO2","MT-CYB","MT-ND2","MT-ND5","MT-CO1","MT-ND3","MT-ND4","MT-ND1","MT-ATP6","MT-CO3","MT-TL1","MT-TF","MT-TV","MT-RNR2","MT-TI","MT-TQ","MT-TM","MT-TW","MT-TA","MT-TN","MT-TC","MT-TY","MT-TS1","MT-TD","MT-TK","MT-TG","MT-TR","MT-TH","MT-TS2","MT-TL2","MT-TE","MT-TT","MT-TP","MT-RNR1","MT-ND4L","MT-ATP8"]);var Ts="quality_control",Us=new WeakMap,Qs=new WeakMap,qs=new WeakMap,Ps=new WeakSet,Ls=new WeakSet,Vs=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,r),n=t.call(this),w((0,z.Z)(n),Ls),w((0,z.Z)(n),Ps),(0,y.Z)((0,z.Z)(n),Us,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(n),Qs,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(n),qs,{writable:!0,value:void 0}),!(e instanceof ws))throw new Error("'inputs' should be a State object from './inputs.js'");return(0,A.Z)((0,z.Z)(n),Us,e),(0,A.Z)((0,z.Z)(n),qs,null===i?{}:i),(0,A.Z)((0,z.Z)(n),Qs,null===a?{}:a),n.changed=!1,n}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,Qs).metrics),Ht((0,k.Z)(this,Qs).filters),Ht((0,k.Z)(this,Qs).metrics_buffer)}},{key:"valid",value:function(){return!0}},{key:"skipped",value:function(){return(0,k.Z)(this,qs).skip}},{key:"fetchSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unsafe,r=void 0!==t&&t;return(0,k.Z)(this,Qs).metrics.sums({copy:!r})}},{key:"fetchDiscards",value:function(){return(0,k.Z)(this,Qs).filters.discardOverall({copy:"view"})}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,qs))}},{key:"compute",value:function(e,t,r,n){this.changed=!1;var i=!e&&!("metrics"in(0,k.Z)(this,Qs)),a=!e&&!("filters"in(0,k.Z)(this,Qs));if((0,k.Z)(this,Us).changed||t!==(0,k.Z)(this,qs).use_mito_default||r!==(0,k.Z)(this,qs).mito_prefix||i){if(Ht((0,k.Z)(this,Qs).metrics),e)delete(0,k.Z)(this,Qs).metrics;else{var s=(0,k.Z)(this,Us).fetchCountMatrix(),o=Xt(1*s.numberOfRows(),"Uint8Array",(0,k.Z)(this,Qs),"metrics_buffer");o.fill(0);for(var u=(0,k.Z)(this,Us).fetchGenes(),l=o.array(),c=0,f=Object.entries(u);c<f.length;c++){var d=(0,h.Z)(f[c],2),v=(d[0],d[1]);if(t)v.forEach((function(e,t){(js.symbol.has(e)||js.ensembl.has(e))&&(l[t]=1)}));else{var p=r.toLowerCase();v.forEach((function(e,t){e.toLowerCase().startsWith(p)&&(l[t]=1)}))}}(0,k.Z)(this,Qs).metrics=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.subsetProportions,i=void 0===n||n,a=r.numberOfThreads,s=void 0===a?null:a,o=S.mV(s);return Fe(e,t,(function(e,t,r){return I.R((function(n){return n.per_cell_qc_metrics(e,t,r,i,o)}),Ge)}))}(s,[o])}(0,k.Z)(this,qs).use_mito_default=t,(0,k.Z)(this,qs).mito_prefix=r,this.changed=!0}if(this.changed||n!==(0,k.Z)(this,qs).nmads||a){if(Ht((0,k.Z)(this,Qs).filters),e)delete(0,k.Z)(this,Qs).filters;else{var m=(0,k.Z)(this,Us).fetchBlock();(0,k.Z)(this,Qs).filters=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.numberOfMADs,n=void 0===r?3:r,i=t.block;return Ue(e,void 0===i?null:i,(function(e){return e.sums().length}),(function(e,t,r){return I.R((function(i){return i.per_cell_qc_filters(e.results,t,r,n)}),Pe)}))}((0,k.Z)(this,Qs).metrics,{numberOfMADs:n,block:m})}(0,k.Z)(this,qs).nmads=n,this.changed=!0}(0,k.Z)(this,qs).skip!==e?(this.changed=!0,(0,k.Z)(this,qs).skip=e):(0,k.Z)(this,qs).skip&&e&&(this.changed=!1)}},{key:"summary",value:function(){if(!this.valid()||this.skipped())return null;var e={},t=(0,k.Z)(this,Us).fetchBlockLevels();if(null===t)t=["default"],e.data={default:_(this,Ps,Hs).call(this)};else{var r=_(this,Ps,Hs).call(this,{copy:"view"}),n=(0,k.Z)(this,Us).fetchBlock();e.data=Ms(r,t,n)}var i=_(this,Ls,Ys).call(this);return e.thresholds=Gs(i,t),e}},{key:"serialize",value:function(e){var t=e.createGroup(Ts),r=t.createGroup("parameters");r.writeDataSet("skip","Uint8",[],Number((0,k.Z)(this,qs).skip)),r.writeDataSet("use_mito_default","Uint8",[],Number((0,k.Z)(this,qs).use_mito_default)),r.writeDataSet("mito_prefix","String",[],(0,k.Z)(this,qs).mito_prefix),r.writeDataSet("nmads","Float64",[],(0,k.Z)(this,qs).nmads);var n=t.createGroup("results");if("metrics"in(0,k.Z)(this,Qs)){var i=n.createGroup("metrics"),a=_(this,Ps,Hs).call(this,{copy:"view"});i.writeDataSet("sums","Float64",null,a.sums),i.writeDataSet("detected","Int32",null,a.detected),i.writeDataSet("proportion","Float64",null,a.proportion)}if("filters"in(0,k.Z)(this,Qs)){for(var s=n.createGroup("thresholds"),o=_(this,Ls,Ys).call(this,{copy:"hdf5"}),u=0,l=["sums","detected","proportion"];u<l.length;u++){var c=l[u],h=o[c];s.writeDataSet(c,"Float64",null,h)}var f=this.fetchDiscards();n.writeDataSet("discards","Uint8",null,f)}}}],[{key:"defaults",value:function(){return{skip:!1,use_mito_default:!0,mito_prefix:"mt-",nmads:3}}}]),r}(Ws);function Hs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{sums:(0,k.Z)(this,Qs).metrics.sums({copy:r}),detected:(0,k.Z)(this,Qs).metrics.detected({copy:r}),proportion:(0,k.Z)(this,Qs).metrics.subsetProportions(0,{copy:r})}}function Ys(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{sums:(0,k.Z)(this,Qs).filters.thresholdsSums({copy:r}),detected:(0,k.Z)(this,Qs).filters.thresholdsDetected({copy:r}),proportion:(0,k.Z)(this,Qs).filters.thresholdsSubsetProportions(0,{copy:r})}}var Js=function(){function e(t,r,n,i){(0,m.Z)(this,e),this.sums_=t,this.detected_=r,this.proportion_=n;try{this.discards=S.TS(i.length),this.discards.set(i)}catch(a){throw Ht(this.discards),a}}return(0,g.Z)(e,[{key:"thresholdsSums",value:function(e){var t=e.copy;return Vt(this.sums_,t)}},{key:"thresholdsDetected",value:function(e){var t=e.copy;return Vt(this.detected_,t)}},{key:"thresholdsSubsetProportions",value:function(e,t){var r=t.copy;if(0!=e)throw"only 'index = 0' is supported for mimics";return Vt(this.proportion_,r)}},{key:"discardOverall",value:function(e){var t=e.copy;return Vt(this.discards,t)}},{key:"free",value:function(){this.discards.free()}}]),e}();function Xs(e,t){var r,n=e.open("quality_control"),i=Vs.defaults(),a=n.open("parameters");i.use_mito_default=a.open("use_mito_default",{load:!0}).values[0]>0,i.mito_prefix=a.open("mito_prefix",{load:!0}).values[0],i.nmads=a.open("nmads",{load:!0}).values[0],"skip"in a.children&&(i.skip=a.open("skip",{load:!0}).values[0]>0);var s={};try{var o=n.open("results");if("metrics"in o.children){var u=o.open("metrics"),l=u.open("sums",{load:!0}).values;s.metrics=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).subsetProportions,n=void 0===r||r;return I.R((function(r){return new r.PerCellQCMetrics_Results(e,t,n)}),Ge)}(l.length,1),s.metrics.sums({copy:!1}).set(l);var c=u.open("detected",{load:!0}).values;s.metrics.detected({copy:!1}).set(c);var h=u.open("proportion",{load:!0}).values;s.metrics.subsetProportions(0,{copy:!1}).set(h)}if("thresholds"in o.children){var f=o.open("thresholds"),d=f.open("sums",{load:!0}).values,v=f.open("detected",{load:!0}).values,p=f.open("proportion",{load:!0}).values,m=o.open("discards",{load:!0}).values;s.filters=new Js(d,v,p,m)}r=new Vs(t,i,s)}catch(g){throw Ht(s.metrics),Ht(s.filters),Ht(r),g}return r}var Ks="adt_quality_control",$s=new WeakMap,eo=new WeakMap,to=new WeakMap,ro=new WeakSet,no=new WeakSet,io=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,r),n=t.call(this),w((0,z.Z)(n),no),w((0,z.Z)(n),ro),(0,y.Z)((0,z.Z)(n),$s,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(n),eo,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(n),to,{writable:!0,value:void 0}),!(e instanceof ws))throw new Error("'inputs' should be a State object from './inputs.js'");return(0,A.Z)((0,z.Z)(n),$s,e),(0,A.Z)((0,z.Z)(n),to,null===i?{}:i),(0,A.Z)((0,z.Z)(n),eo,null===a?{}:a),n.changed=!1,(0,k.Z)((0,z.Z)(n),to).target_matrix="ADT",n}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,eo).metrics),Ht((0,k.Z)(this,eo).filters),Ht((0,k.Z)(this,eo).metrics_buffer)}},{key:"valid",value:function(){return(0,k.Z)(this,$s).hasAvailable((0,k.Z)(this,to).target_matrix)}},{key:"skipped",value:function(){return(0,k.Z)(this,to).skip}},{key:"fetchSums",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unsafe,r=void 0!==t&&t;return(0,k.Z)(this,eo).metrics.sums({copy:!r})}},{key:"fetchDiscards",value:function(){return(0,k.Z)(this,eo).filters.discardOverall({copy:"view"})}},{key:"fetchParameters",value:function(){var e=p({},(0,k.Z)(this,to));return delete e.target_matrix,e}},{key:"useRNAMatrix",value:function(){(0,k.Z)(this,to).target_matrix="RNA"}},{key:"compute",value:function(e,t,r,n){this.changed=!1;var i=e||!this.valid(),a=!i&&!("metrics"in(0,k.Z)(this,eo)),s=!i&&!("filters"in(0,k.Z)(this,eo));if((0,k.Z)(this,$s).changed||t!==(0,k.Z)(this,to).igg_prefix||a){if(Ht((0,k.Z)(this,eo).metrics),i)delete(0,k.Z)(this,eo).metrics;else{var o=(0,k.Z)(this,$s).fetchCountMatrix({type:(0,k.Z)(this,to).target_matrix}),u=(0,k.Z)(this,$s).fetchGenes({type:(0,k.Z)(this,to).target_matrix}),l=Xt(o.numberOfRows(),"Uint8Array",(0,k.Z)(this,eo),"metrics_buffer");l.fill(0);for(var c=l.array(),f=t.toLowerCase(),d=0,v=Object.entries(u);d<v.length;d++){var p=(0,h.Z)(v[d],2);p[0];p[1].forEach((function(e,t){e.toLowerCase().startsWith(f)&&(c[t]=1)}))}(0,k.Z)(this,eo).metrics=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).numberOfThreads,n=void 0===r?null:r,i=S.mV(n);return Fe(e,t,(function(e,t,r){return I.R((function(n){return n.per_cell_adt_qc_metrics(e,t,r,i)}),Te)}))}(o,[l])}(0,k.Z)(this,to).igg_prefix=t,this.changed=!0}if(this.changed||r!==(0,k.Z)(this,to).nmads||n!==(0,k.Z)(this,to).min_detected_drop||s){if(Ht((0,k.Z)(this,eo).filters),i)delete(0,k.Z)(this,eo).filters;else{var m=(0,k.Z)(this,$s).fetchBlock();(0,k.Z)(this,eo).filters=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.numberOfMADs,n=void 0===r?3:r,i=t.minDetectedDrop,a=void 0===i?.1:i,s=t.block;return Ue(e,void 0===s?null:s,(function(e){return e.detected().length}),(function(e,t,r){return I.R((function(i){return i.per_cell_adt_qc_filters(e.results,t,r,n,a)}),He)}))}((0,k.Z)(this,eo).metrics,{numberOfMADs:r,minDetectedDrop:n,block:m})}(0,k.Z)(this,to).nmads=r,(0,k.Z)(this,to).min_detected_drop=n,this.changed=!0}(0,k.Z)(this,to).skip!==e?(this.changed=!0,(0,k.Z)(this,to).skip=e):(0,k.Z)(this,to).skip&&e&&(this.changed=!1)}},{key:"summary",value:function(){if(!this.valid()||this.skipped())return null;var e={},t=(0,k.Z)(this,$s).fetchBlockLevels();if(null===t)t=["default"],e.data={default:_(this,ro,ao).call(this)};else{var r=_(this,ro,ao).call(this,{copy:"view"}),n=(0,k.Z)(this,$s).fetchBlock();e.data=Ms(r,t,n)}var i=_(this,no,so).call(this);e.thresholds=Gs(i,t);for(var a=0,s=Object.entries(e.thresholds);a<s.length;a++){var o=(0,h.Z)(s[a],2);o[0];o[1].sums=NaN}return e}},{key:"serialize",value:function(e){var t=e.createGroup(Ks),r=t.createGroup("parameters");r.writeDataSet("skip","Uint8",[],Number((0,k.Z)(this,to).skip)),r.writeDataSet("igg_prefix","String",[],(0,k.Z)(this,to).igg_prefix),r.writeDataSet("nmads","Float64",[],(0,k.Z)(this,to).nmads),r.writeDataSet("min_detected_drop","Float64",[],(0,k.Z)(this,to).min_detected_drop);var n=t.createGroup("results");if("metrics"in(0,k.Z)(this,eo)){var i=n.createGroup("metrics"),a=_(this,ro,ao).call(this,{copy:"view"});i.writeDataSet("sums","Float64",null,a.sums),i.writeDataSet("detected","Int32",null,a.detected),i.writeDataSet("igg_total","Float64",null,a.igg_total)}if("filters"in(0,k.Z)(this,eo)){for(var s=n.createGroup("thresholds"),o=_(this,no,so).call(this,{copy:"hdf5"}),u=0,l=["detected","igg_total"];u<l.length;u++){var c=l[u],h=o[c];s.writeDataSet(c,"Float64",null,h)}var f=this.fetchDiscards();n.writeDataSet("discards","Uint8",null,f)}}}],[{key:"defaults",value:function(){return{skip:!1,igg_prefix:"IgG",nmads:3,min_detected_drop:.1}}}]),r}(Ws);function ao(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{sums:(0,k.Z)(this,eo).metrics.sums({copy:r}),detected:(0,k.Z)(this,eo).metrics.detected({copy:r}),igg_total:(0,k.Z)(this,eo).metrics.subsetTotals(0,{copy:r})}}function so(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{detected:(0,k.Z)(this,eo).filters.thresholdsDetected({copy:r}),igg_total:(0,k.Z)(this,eo).filters.thresholdsSubsetTotals(0,{copy:r})}}var oo=function(){function e(t,r,n){(0,m.Z)(this,e),this.detected_=t,this.igg_total_=r;try{this.discards=S.TS(n.length),this.discards.set(n)}catch(i){throw Ht(this.discards),i}}return(0,g.Z)(e,[{key:"thresholdsDetected",value:function(e){var t=e.copy;return Vt(this.detected_,t)}},{key:"thresholdsSubsetTotals",value:function(e,t){var r=t.copy;if(0!=e)throw"only 'index = 0' is supported for mimics";return Vt(this.igg_total_,r)}},{key:"discardOverall",value:function(e){var t=e.copy;return Vt(this.discards,t)}},{key:"free",value:function(){this.discards.free()}}]),e}();function uo(e,t){var r,n,i,a={},s=io.defaults();if(Ks in e.children){var o=e.open(Ks),u=o.open("parameters");s.igg_prefix=u.open("igg_prefix",{load:!0}).values[0],s.nmads=u.open("nmads",{load:!0}).values[0],s.min_detected_drop=u.open("min_detected_drop",{load:!0}).values[0],"skip"in u.children&&(s.skip=u.open("skip",{load:!0}).values[0]>0);try{var l=o.open("results");if("metrics"in l.children){var c=l.open("metrics"),h=c.open("detected",{load:!0}).values;a.metrics=(n=h.length,i=1,I.R((function(e){return new e.PerCellAdtQcMetrics_Results(n,i)}),Te)),a.metrics.detected({copy:!1}).set(h);var f=c.open("sums",{load:!0}).values;a.metrics.sums({copy:!1}).set(f);var d=c.open("igg_total",{load:!0}).values;a.metrics.subsetTotals(0,{copy:!1}).set(d)}if("thresholds"in l.children){var v=l.open("thresholds"),p=v.open("detected",{load:!0}).values,m=v.open("igg_total",{load:!0}).values,g=l.open("discards",{load:!0}).values;a.filters=new oo(p,m,g)}r=new io(t,s,a)}catch(b){throw Ht(a.metrics),Ht(a.filters),Ht(r),b}}else r=new io(t,s,a);return r}var lo="cell_filtering";function co(e,t){var r,n=Kt(e,t),i=[],a=(0,o.Z)(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;e[s].skipped()||i.push(s)}}catch(bn){a.e(bn)}finally{a.f()}return i}var ho=new WeakMap,fo=new WeakMap,vo=new WeakMap,po=new WeakMap,mo=new WeakSet,go=new WeakSet,bo=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),w(this,go),w(this,mo),(0,y.Z)(this,ho,{writable:!0,value:void 0}),(0,y.Z)(this,fo,{writable:!0,value:void 0}),(0,y.Z)(this,vo,{writable:!0,value:void 0}),(0,y.Z)(this,po,{writable:!0,value:void 0}),!(t instanceof ws))throw new Error("'inputs' should be an InputsState");(0,A.Z)(this,ho,t);for(var a=0,s=Object.values(r);a<s.length;a++){var o=s[a];if(!(o instanceof Ws))throw new Error("'qc_states' should contain QualityControlStateBase objects")}(0,A.Z)(this,fo,r),(0,A.Z)(this,po,null===n?{}:n),(0,A.Z)(this,vo,null===i?{}:i),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,vo).block_buffer),Ht((0,k.Z)(this,vo).discard_buffer),Ht((0,k.Z)(this,vo).matrix)}},{key:"hasAvailable",value:function(e){return"matrix"in(0,k.Z)(this,vo)?(0,k.Z)(this,vo).matrix.has(e):(0,k.Z)(this,ho).hasAvailable(e)}},{key:"fetchFilteredMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=void 0===t?"RNA":t;return"matrix"in(0,k.Z)(this,vo)||_(this,mo,wo).call(this),(0,k.Z)(this,vo).matrix.get(r)}},{key:"fetchFilteredBlock",value:function(){return"block_buffer"in(0,k.Z)(this,vo)||_(this,go,yo).call(this),(0,k.Z)(this,vo).block_buffer}},{key:"fetchDiscards",value:function(){return"discard_buffer"in(0,k.Z)(this,vo)?(0,k.Z)(this,vo).discard_buffer:null}},{key:"fetchFilteredAnnotations",value:function(e){var t=(0,k.Z)(this,ho).fetchAnnotations(e);if("discard_buffer"in(0,k.Z)(this,vo)){var r=(0,k.Z)(this,vo).discard_buffer.array();return t.filter((function(e,t){return!r[t]}))}return t}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,po))}},{key:"compute",value:function(){var e=this;this.changed=!1,(0,k.Z)(this,ho).changed&&(this.changed=!0);for(var t=0,r=Object.values((0,k.Z)(this,fo));t<r.length;t++){r[t].changed&&(this.changed=!0)}if(this.changed){var n=co((0,k.Z)(this,fo),"QC");if(n.length>0){var i,a=(0,k.Z)(this,fo)[n[0]].fetchDiscards();n.length>1?function(){var t=(i=Xt(a.length,"Uint8Array",(0,k.Z)(e,vo),"discard_buffer")).array();t.fill(0);var r,s=(0,o.Z)(n);try{for(s.s();!(r=s.n()).done;){var u=r.value;(0,k.Z)(e,fo)[u].fetchDiscards().forEach((function(e,r){t[r]|=e}))}}catch(bn){s.e(bn)}finally{s.f()}}():(i=a.view(),Ht((0,k.Z)(this,vo).discard_buffer),(0,k.Z)(this,vo).discard_buffer=i)}else Ht((0,k.Z)(this,vo).discard_buffer),delete(0,k.Z)(this,vo).discard_buffer;_(this,mo,wo).call(this),_(this,go,yo).call(this)}}},{key:"undoFiltering",value:function(e){var t=this.fetchDiscards();if(null!==t){var r=[];t.forEach((function(e,t){0==e&&r.push(t)})),e.forEach((function(t,n){e[n]=r[t]}))}}},{key:"summary",value:function(){var e=0;if("discard_buffer"in(0,k.Z)(this,vo))(0,k.Z)(this,vo).discard_buffer.forEach((function(t){e+=0==t}));else{var t=(0,k.Z)(this,ho).hasAvailable();e=(0,k.Z)(this,ho).fetchCountMatrix(t[0]).numberOfColumns()}return{retained:e}}},{key:"serialize",value:function(e){var t=e.createGroup(lo);t.createGroup("parameters");var r=t.createGroup("results");if("discard_buffer"in(0,k.Z)(this,vo)){var n=(0,k.Z)(this,vo).discard_buffer;null===n.owner&&r.writeDataSet("discards","Uint8",null,n)}}}],[{key:"defaults",value:function(){return{}}}]),e}();function wo(){Ht((0,k.Z)(this,vo).matrix),(0,k.Z)(this,vo).matrix=new Re;var e,t=(0,k.Z)(this,ho).listAvailableTypes(),r=(0,o.Z)(t);try{for(r.s();!(e=r.n()).done;){var n=e.value,i=(0,k.Z)(this,ho).fetchCountMatrix({type:n}),a=void 0;a="discard_buffer"in(0,k.Z)(this,vo)?Ye(i,(0,k.Z)(this,vo).discard_buffer):i.clone(),(0,k.Z)(this,vo).matrix.add(n,a)}}catch(bn){r.e(bn)}finally{r.f()}}function yo(){Ht((0,k.Z)(this,vo).block_buffer);var e=(0,k.Z)(this,ho).fetchBlock();if(null!==e)if("discard_buffer"in(0,k.Z)(this,vo)){var t=Xt(this.fetchFilteredMatrix().numberOfColumns(),"Int32Array",(0,k.Z)(this,vo),"block_buffer");!function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).buffer;Se(e,t,{buffer:void 0===r?null:r,filter:!0})}(e,(0,k.Z)(this,vo).discard_buffer,{buffer:t})}else(0,k.Z)(this,vo).block_buffer=e.view();else(0,k.Z)(this,vo).block_buffer=null}function _o(e,t,r){var n,i=bo.defaults(),a={};try{if(lo in e.children){var s=e.open(lo).open("results");if("discards"in s.children){var o=s.open("discards",{load:!0}).values;a.discard_buffer=S.TS(o.length),a.discard_buffer.set(o)}}if(!("discard_buffer"in a)){var u=co(r,"QC");if(1==u.length){var l=r[u[0]];a.discard_buffer=l.fetchDiscards().view()}else if(0!=u.length)throw new Error("no more than one upstream QC state should be valid if 'discards' is not available")}n=new bo(t,r,i,a)}catch(c){throw Ht(a.discard_buffer),Ht(n),c}return n}function Zo(e,t,r,n,i){if(e.skipped())return null;var a=Xt(r.numberOfColumns(),"Float64Array",n,i),s=t.fetchDiscards(),o=e.fetchSums({unsafe:!0});if(null==s)a.set(o);else{var u=a.array(),l=0;if(s.forEach((function(e,t){if(!e){if(l==a.length)throw new Error("normalization and filtering are not in sync");u[l]=o[t],l++}})),l!==a.length)throw new Error("normalization and filtering are not in sync")}return a}var ko=(0,g.Z)((function e(){(0,m.Z)(this,e)})),Ao="normalization",xo=new WeakMap,Eo=new WeakMap,So=new WeakMap,Io=new WeakMap,Oo=new WeakSet,Co=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,r),i=t.call(this),w((0,z.Z)(i),Oo),(0,y.Z)((0,z.Z)(i),xo,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),Eo,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),So,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),Io,{writable:!0,value:void 0}),!(e instanceof Vs))throw new Error("'filt' should be a State object from './quality_control.js'");if((0,A.Z)((0,z.Z)(i),xo,e),!(n instanceof bo))throw new Error("'filt' should be a State object from './cell_filtering.js'");return(0,A.Z)((0,z.Z)(i),Eo,n),(0,A.Z)((0,z.Z)(i),So,null===a?{}:a),(0,A.Z)((0,z.Z)(i),Io,null===s?{}:s),i.changed=!1,i}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,Io).matrix),Ht((0,k.Z)(this,Io).sum_buffer)}},{key:"valid",value:function(){return!0}},{key:"fetchNormalizedMatrix",value:function(){return"matrix"in(0,k.Z)(this,Io)||_(this,Oo,Ro).call(this),(0,k.Z)(this,Io).matrix}},{key:"fetchExpression",value:function(e){var t=this.fetchNormalizedMatrix(),r=Xt(t.numberOfColumns(),"Float64Array",(0,k.Z)(this,Io));return t.row(e,{buffer:r}),r.slice()}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,So))}},{key:"compute",value:function(){this.changed=!1,((0,k.Z)(this,xo).changed||(0,k.Z)(this,Eo).changed)&&(this.changed=!0),this.changed&&_(this,Oo,Ro).call(this)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("normalization");t.createGroup("parameters"),t.createGroup("results")}}],[{key:"defaults",value:function(){return{}}}]),r}(ko);function Ro(){var e=(0,k.Z)(this,Eo).fetchFilteredMatrix({type:"RNA"}),t=Zo((0,k.Z)(this,xo),(0,k.Z)(this,Eo),e,(0,k.Z)(this,Io),"sum_buffer"),r=(0,k.Z)(this,Eo).fetchFilteredBlock();Ht((0,k.Z)(this,Io).matrix),(0,k.Z)(this,Io).matrix=at(e,{sizeFactors:t,block:r,allowZeros:!0})}function Do(e,t,r){return new Co(t,r)}var Bo="adt_normalization",zo=new WeakMap,Fo=new WeakMap,No=new WeakMap,Mo=new WeakMap,Go=new WeakSet,Wo=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,r),i=t.call(this),w((0,z.Z)(i),Go),(0,y.Z)((0,z.Z)(i),zo,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),Fo,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),No,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),Mo,{writable:!0,value:void 0}),!(e instanceof io))throw new Error("'qc' should be a AdtQualityControlState object");if((0,A.Z)((0,z.Z)(i),zo,e),!(n instanceof bo))throw new Error("'filter' should be a CellFilteringState object");return(0,A.Z)((0,z.Z)(i),Fo,n),(0,A.Z)((0,z.Z)(i),No,null===a?{}:a),(0,A.Z)((0,z.Z)(i),Mo,null===s?{}:s),i.changed=!1,(0,k.Z)((0,z.Z)(i),No).target_matrix="ADT",i}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,Mo).matrix),Ht((0,k.Z)(this,Mo).exp_buffer),Ht((0,k.Z)(this,Mo).total_buffer),Ht((0,k.Z)(this,Mo).sf_buffer)}},{key:"valid",value:function(){return(0,k.Z)(this,Fo).hasAvailable((0,k.Z)(this,No).target_matrix)}},{key:"fetchNormalizedMatrix",value:function(){return this.valid()?("matrix"in(0,k.Z)(this,Mo)||_(this,Go,jo).call(this),(0,k.Z)(this,Mo).matrix):null}},{key:"fetchExpression",value:function(e){var t=this.fetchNormalizedMatrix(),r=Xt(t.numberOfColumns(),"Float64Array",(0,k.Z)(this,Mo),"exp_buffer");return t.row(e,{buffer:r}),r.slice()}},{key:"fetchParameters",value:function(){var e=p({},(0,k.Z)(this,No));return delete e.target_matrix,e}},{key:"useRNAMatrix",value:function(){(0,k.Z)(this,No).target_matrix="RNA"}},{key:"compute",value:function(e,t){if(this.changed=!1,(0,k.Z)(this,zo).changed||(0,k.Z)(this,Fo).changed||e!==(0,k.Z)(this,No).num_pcs||t!=(0,k.Z)(this,No).num_clusters){if(this.valid()){var r=(0,k.Z)(this,Fo).fetchFilteredMatrix({type:(0,k.Z)(this,No).target_matrix}),n=Zo((0,k.Z)(this,zo),(0,k.Z)(this,Fo),r,(0,k.Z)(this,Mo),"total_buffer"),i=(0,k.Z)(this,Fo).fetchFilteredBlock(),a=Xt(r.numberOfColumns(),"Float64Array",(0,k.Z)(this,Mo),"sf_buffer");!function(e){var t,r,n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.numberOfClusters,o=void 0===s?20:s,u=a.numberOfPCs,l=void 0===u?25:u,c=a.totals,h=void 0===c?null:c,f=a.block,d=void 0===f?null:f,v=a.buffer,p=void 0===v?null:v,m=a.numberOfThreads,g=void 0===m?null:m;try{r=et(t=at(e,{sizeFactors:h,block:d}),{numberOfPCs:Math.min(t.numberOfRows()-1,l),numberOfThreads:g})}finally{S.gd(t)}try{n=it(r,o,{numberOfThreads:g})}finally{S.gd(r)}try{if(null===p)p=i=S.RJ(e.numberOfColumns());else if(p.length!==e.numberOfColumns())throw new Error("length of 'buffer' should be equal to the number of columns in 'x'");Je(e,n.clusters({copy:"view"}),{buffer:p,numberOfThreads:g})}catch(b){throw S.gd(i),b}finally{S.gd(n)}}(r,{totals:n,block:i,buffer:a,numberOfPCs:e,numberOfClusters:t}),this.changed=!0}(0,k.Z)(this,No).num_pcs=e,(0,k.Z)(this,No).num_clusters=t}this.changed&&this.valid()&&_(this,Go,jo).call(this)}},{key:"summary",value:function(){return this.valid()?{size_factors:(0,k.Z)(this,Mo).sf_buffer.slice()}:null}},{key:"serialize",value:function(e){var t=e.createGroup(Bo),r=t.createGroup("parameters");r.writeDataSet("num_pcs","Int32",[],(0,k.Z)(this,No).num_pcs),r.writeDataSet("num_clusters","Int32",[],(0,k.Z)(this,No).num_clusters);var n=t.createGroup("results");this.valid()&&n.writeDataSet("size_factors","Float64",null,(0,k.Z)(this,Mo).sf_buffer)}}],[{key:"defaults",value:function(){return{num_pcs:25,num_clusters:20}}}]),r}(ko);function jo(){var e=(0,k.Z)(this,Fo).fetchFilteredMatrix({type:(0,k.Z)(this,No).target_matrix}),t=(0,k.Z)(this,Fo).fetchFilteredBlock(),r=(0,k.Z)(this,Mo).sf_buffer;if(r.length!=e.numberOfColumns())throw new Error("length of size factor vector should equal number of columns after QC");Ht((0,k.Z)(this,Mo).matrix),(0,k.Z)(this,Mo).matrix=at(e,{sizeFactors:r,block:t,allowZeros:!0})}function To(e,t,r){var n,i={},a=Wo.defaults();if(Bo in e.children){var s=e.open(Bo),o=s.open("parameters");a.num_pcs=o.open("num_pcs",{load:!0}).values[0],a.num_clusters=o.open("num_clusters",{load:!0}).values[0];try{var u=s.open("results");if("size_factors"in u.children){var l=u.open("size_factors",{load:!0}).values;i.sf_buffer=S.RJ(l.length),i.sf_buffer.set(l)}n=new Wo(t,r,a,i)}catch(c){throw Ht(i.sf_buffer),Ht(n),c}}else n=new Wo(t,r,a,i);return n}function Uo(e){return{pcs:e.principalComponents({copy:"view"}),num_pcs:e.numberOfPCs(),num_obs:e.numberOfCells()}}function Qo(e){var t=e.varianceExplained(),r=e.totalVariance();return t.forEach((function(e,n){t[n]=e/r})),{var_exp:t}}var qo=(0,g.Z)((function e(){(0,m.Z)(this,e)})),Po=function(){function e(t,r){(0,m.Z)(this,e),this.var_exp=r;try{this.pcs=S.RJ(t.length),this.pcs.set(t)}catch(n){throw Ht(this.pcs),n}}return(0,g.Z)(e,[{key:"principalComponents",value:function(e){var t=e.copy;return Vt(this.pcs,t)}},{key:"numberOfCells",value:function(){return this.pcs.length/this.numberOfPCs()}},{key:"numberOfPCs",value:function(){return this.var_exp.length}},{key:"varianceExplained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return Vt(this.var_exp,r)}},{key:"totalVariance",value:function(){return 1}},{key:"free",value:function(){this.pcs.free()}}]),e}(),Lo=new WeakMap,Vo=new WeakMap,Ho=new WeakMap,Yo=new WeakMap,Jo=new WeakSet,Xo=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),w(this,Jo),(0,y.Z)(this,Lo,{writable:!0,value:void 0}),(0,y.Z)(this,Vo,{writable:!0,value:void 0}),(0,y.Z)(this,Ho,{writable:!0,value:void 0}),(0,y.Z)(this,Yo,{writable:!0,value:void 0}),!(t instanceof bo))throw new Error("'filter' should be a State object from './cell_filtering.js'");if((0,A.Z)(this,Lo,t),!(r instanceof Co))throw new Error("'norm' should be a State object from './normalization.js'");(0,A.Z)(this,Vo,r),(0,A.Z)(this,Yo,null===n?{}:n),(0,A.Z)(this,Ho,null===i?{}:i),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Ho).matrix)}},{key:"fetchSortedResiduals",value:function(){return(0,k.Z)(this,Ho).sorted_residuals}},{key:"fetchResiduals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unsafe,r=void 0!==t&&t;return(0,k.Z)(this,Ho).results.residuals({copy:!r})}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,Yo))}},{key:"compute",value:function(e){if(this.changed=!1,(0,k.Z)(this,Vo).changed||e!=(0,k.Z)(this,Yo).span){Ht((0,k.Z)(this,Ho).results);var t=(0,k.Z)(this,Vo).fetchNormalizedMatrix(),r=(0,k.Z)(this,Lo).fetchFilteredBlock();(0,k.Z)(this,Ho).results=st.r(t,{span:e,block:r}),(0,k.Z)(this,Ho).sorted_residuals=(0,k.Z)(this,Ho).results.residuals().slice(),(0,k.Z)(this,Ho).sorted_residuals.sort(),(0,k.Z)(this,Yo).span=e,this.changed=!0}}},{key:"summary",value:function(){return _(this,Jo,Ko).call(this)}},{key:"serialize",value:function(e){var t=e.createGroup("feature_selection");t.createGroup("parameters").writeDataSet("span","Float64",[],(0,k.Z)(this,Yo).span);for(var r=_(this,Jo,Ko).call(this,{copy:"hdf5"}),n=t.createGroup("results"),i=0,a=Object.entries(r);i<a.length;i++){var s=(0,h.Z)(a[i],2),o=s[0],u=s[1];n.writeDataSet(o,"Float64",null,u)}}}]),e}();function Ko(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,r=void 0===t||t;return{means:(0,k.Z)(this,Ho).results.means({copy:r}),vars:(0,k.Z)(this,Ho).results.variances({copy:r}),fitted:(0,k.Z)(this,Ho).results.fitted({copy:r}),resids:(0,k.Z)(this,Ho).results.residuals({copy:r})}}var $o=function(){function e(t,r,n,i){(0,m.Z)(this,e),this.means_=t,this.vars_=r,this.fitted_=n,this.resids_=i}return(0,g.Z)(e,[{key:"means",value:function(e){var t=e.copy;return Vt(this.means_,t)}},{key:"variances",value:function(e){var t=e.copy;return Vt(this.vars_,t)}},{key:"fitted",value:function(e){var t=e.copy;return Vt(this.fitted_,t)}},{key:"residuals",value:function(e){var t=e.copy;return Vt(this.resids_,t)}},{key:"free",value:function(){}}]),e}();function eu(e,t,r,n){var i,a=e.open("feature_selection");i={span:a.open("parameters").open("span",{load:!0}).values[0]};for(var s={},o=a.open("results"),u={},l=0,c=["means","vars","fitted","resids"];l<c.length;l++){var h=c[l],f=o.open(h,{load:!0}).values;t(f),u[h]=f}return s.results=new $o(u.means,u.vars,u.fitted,u.resids),s.sorted_residuals=s.results.residuals({copy:!0}),s.sorted_residuals.sort(),new Xo(r,n,i,s)}var tu="pca",ru=new WeakMap,nu=new WeakMap,iu=new WeakMap,au=new WeakMap,su=new WeakMap,ou=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n,i){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,m.Z)(this,r),a=t.call(this),(0,y.Z)((0,z.Z)(a),ru,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(a),nu,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(a),iu,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(a),au,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(a),su,{writable:!0,value:void 0}),!(e instanceof bo))throw new Error("'filter' should be a State object from './cell_filtering.js'");if((0,A.Z)((0,z.Z)(a),ru,e),!(n instanceof Co))throw new Error("'norm' should be a State object from './normalization.js'");if((0,A.Z)((0,z.Z)(a),nu,n),!(i instanceof Xo))throw new Error("'feat' should be a State object from './feature_selection.js'");return(0,A.Z)((0,z.Z)(a),iu,i),(0,A.Z)((0,z.Z)(a),su,null===s?{}:s),(0,A.Z)((0,z.Z)(a),au,null===o?{}:o),a.changed=!1,a}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,au).hvg_buffer),Ht((0,k.Z)(this,au).pcs)}},{key:"valid",value:function(){return!0}},{key:"fetchPCs",value:function(){return Uo((0,k.Z)(this,au).pcs)}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,su))}},{key:"compute",value:function(e,t,r){if(this.changed=!1,((0,k.Z)(this,iu).changed||e!==(0,k.Z)(this,su).num_hvgs)&&(uu(e,(0,k.Z)(this,iu),(0,k.Z)(this,au)),(0,k.Z)(this,su).num_hvgs=e,this.changed=!0),this.changed||(0,k.Z)(this,nu).changed||t!==(0,k.Z)(this,su).num_pcs||r!==(0,k.Z)(this,su).block_method){var n=(0,k.Z)(this,au).hvg_buffer,i=(0,k.Z)(this,ru).fetchFilteredBlock(),a=(0,k.Z)(this,nu).fetchNormalizedMatrix();Ht((0,k.Z)(this,au).pcs),(0,k.Z)(this,au).pcs=et(a,{features:n,numberOfPCs:t,block:i,blockMethod:r}),(0,k.Z)(this,su).num_pcs=t,(0,k.Z)(this,su).block_method=r,this.changed=!0}}},{key:"summary",value:function(){return Qo((0,k.Z)(this,au).pcs)}},{key:"serialize",value:function(e){var t=e.createGroup(tu),r=t.createGroup("parameters");r.writeDataSet("num_hvgs","Int32",[],(0,k.Z)(this,su).num_hvgs),r.writeDataSet("num_pcs","Int32",[],(0,k.Z)(this,su).num_pcs),r.writeDataSet("block_method","String",[],(0,k.Z)(this,su).block_method);var n=t.createGroup("results"),i=this.summary().var_exp;n.writeDataSet("var_exp","Float64",null,i);var a=this.fetchPCs();n.writeDataSet("pcs","Float64",[a.num_obs,a.num_pcs],a.pcs)}}],[{key:"defaults",value:function(){return{num_hvgs:2e3,num_pcs:20,block_method:"none"}}}]),r}(qo);function uu(e,t,r){var n=t.fetchSortedResiduals(),i=Xt(n.length,"Uint8Array",r,"hvg_buffer");if(e<n.length){var a=n[n.length-e],s=t.fetchResiduals({unsafe:!0});i.array().forEach((function(e,t,r){r[t]=s[t]>=a}))}else i.fill(1);return i}function lu(e,t,r,n){var i,a=e.open(tu),s={},o=a.open("parameters");s={num_hvgs:o.open("num_hvgs",{load:!0}).values[0],num_pcs:o.open("num_pcs",{load:!0}).values[0]},"block_method"in o.children?(s.block_method=o.open("block_method",{load:!0}).values[0],"mnn"==s.block_method&&(s.block_method="weight")):s.block_method="none";var u={};try{uu(s.num_hvgs,n,u);var l=a.open("results"),c=l.open("var_exp",{load:!0}).values,h=l.open("pcs",{load:!0}).values;u.pcs=new Po(h,c),i=new ou(t,r,n,s,u)}catch(f){throw Ht(u.hvg_buffer),Ht(u.pcs),Ht(i),f}return i}var cu="adt_pca",hu=new WeakMap,fu=new WeakMap,du=new WeakMap,vu=new WeakMap,pu=function(e){(0,F.Z)(r,e);var t=(0,N.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,r),i=t.call(this),(0,y.Z)((0,z.Z)(i),hu,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),fu,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),du,{writable:!0,value:void 0}),(0,y.Z)((0,z.Z)(i),vu,{writable:!0,value:void 0}),!(e instanceof bo))throw new Error("'filter' should be a CellFilteringState object");if((0,A.Z)((0,z.Z)(i),hu,e),!(n instanceof Wo))throw new Error("'norm' should be a AdtNormalizationState object");return(0,A.Z)((0,z.Z)(i),fu,n),(0,A.Z)((0,z.Z)(i),vu,null===a?{}:a),(0,A.Z)((0,z.Z)(i),du,null===s?{}:s),i.changed=!1,i}return(0,g.Z)(r,[{key:"free",value:function(){Ht((0,k.Z)(this,du).pcs)}},{key:"valid",value:function(){return(0,k.Z)(this,fu).valid()}},{key:"fetchPCs",value:function(){return this.valid()?Uo((0,k.Z)(this,du).pcs):null}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,vu))}},{key:"compute",value:function(e,t){if(this.changed=!1,(0,k.Z)(this,fu).changed||e!==(0,k.Z)(this,vu).num_pcs||t!==(0,k.Z)(this,vu).block_method){if(this.valid()){var r=(0,k.Z)(this,hu).fetchFilteredBlock(),n=(0,k.Z)(this,fu).fetchNormalizedMatrix();Ht((0,k.Z)(this,du).pcs),(0,k.Z)(this,du).pcs=et(n,{numberOfPCs:e,block:r,blockMethod:t}),this.changed=!0}(0,k.Z)(this,vu).num_pcs=e,(0,k.Z)(this,vu).block_method=t}}},{key:"summary",value:function(){return this.valid()?Qo((0,k.Z)(this,du).pcs):null}},{key:"serialize",value:function(e){var t=e.createGroup(cu),r=t.createGroup("parameters");r.writeDataSet("num_pcs","Int32",[],(0,k.Z)(this,vu).num_pcs),r.writeDataSet("block_method","String",[],(0,k.Z)(this,vu).block_method);var n=t.createGroup("results");if(this.valid()){var i=this.summary().var_exp;n.writeDataSet("var_exp","Float64",null,i);var a=this.fetchPCs();n.writeDataSet("pcs","Float64",[a.num_obs,a.num_pcs],a.pcs)}}}],[{key:"defaults",value:function(){return{num_pcs:20,block_method:"none"}}}]),r}(qo);function mu(e,t,r){var n,i={},a=pu.defaults();if(cu in e.children){var s=e.open(cu),o=s.open("parameters");a.num_pcs=o.open("num_pcs",{load:!0}).values[0],a.block_method=o.open("block_method",{load:!0}).values[0];try{var u=s.open("results");if("var_exp"in u.children){var l=u.open("var_exp",{load:!0}).values,c=u.open("pcs",{load:!0}).values;i.pcs=new Po(c,l)}n=new pu(t,r,a,i)}catch(h){throw Ht(i.pcs),Ht(n),h}}else n=new pu(t,r,a,i);return n}var gu="combine_embeddings",bu=new WeakMap,wu=new WeakMap,yu=new WeakMap,_u=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,m.Z)(this,e),(0,y.Z)(this,bu,{writable:!0,value:void 0}),(0,y.Z)(this,wu,{writable:!0,value:void 0}),(0,y.Z)(this,yu,{writable:!0,value:void 0});for(var i=0,a=Object.values(t);i<a.length;i++){var s=a[i];if(!(s instanceof qo))throw new Error("each entry of 'pc_states' should be a PcaStateBase object")}(0,A.Z)(this,bu,t),(0,A.Z)(this,wu,null===r?{}:r),(0,A.Z)(this,yu,null===n?{}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,yu).combined_buffer)}},{key:"fetchPCs",value:function(){return{pcs:(0,k.Z)(this,yu).combined_buffer,num_obs:(0,k.Z)(this,yu).num_cells,num_pcs:(0,k.Z)(this,yu).total_dims}}},{key:"fetchParameters",value:function(){var e=p({},(0,k.Z)(this,wu));return null!==e.weights&&(e.weights=p({},e.weights)),e}},{key:"compute",value:function(e,t){this.changed=!1;for(var r=0,n=Object.entries((0,k.Z)(this,bu));r<n.length;r++){var i=(0,h.Z)(n[r],2);i[0];i[1].changed&&(this.changed=!0)}var a=Kt((0,k.Z)(this,bu),"PCA");if(a.length>1){if(this.changed||t!==(0,k.Z)(this,wu).approximate||Jt(e,(0,k.Z)(this,wu).weights)){var s=null;if(null!==e){s=[];var u,l=[],c=(0,o.Z)(a);try{for(c.s();!(u=c.n()).done;){var f=u.value;if(!(f in e))throw new Error("no weight specified for '"+f+"'");e[f]>0&&(s.push(e[f]),l.push(f))}}catch(bn){c.e(bn)}finally{c.f()}a=l}if(1==a.length){var d=(0,k.Z)(this,bu)[a[0]].fetchPCs();this.constructor.createPcsView((0,k.Z)(this,yu),d)}else{var v,m=[],g=0,b=null,w=(0,o.Z)(a);try{for(w.s();!(v=w.n()).done;){var y=v.value,_=(0,k.Z)(this,bu)[y].fetchPCs();if(m.push(_.pcs),null==b)b=_.num_obs;else if(b!==_.num_obs)throw new Error("number of cells should be consistent across all embeddings");g+=_.num_pcs}}catch(bn){w.e(bn)}finally{w.f()}!function(e,t){var r,n,i,a,s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=o.neighbors,l=void 0===u?20:u,c=o.indices,h=void 0===c?null:c,f=o.buffer,d=void 0===f?null:f,v=o.approximate,p=void 0===v||v,m=o.weights,g=void 0===m?null:m,b=o.numberOfThreads,w=void 0===b?null:b,y=e.length,_=S.mV(w),Z=[];try{for(var k=(r=S.GF(y)).array(),A=0;A<y;A++)k[A]=BigInt(e[A].offset);var x=0,I=!1;if(null!==g){if(I=!0,(a=S.de(g,"Float64WasmArray")).length!=y)throw new Error("length of 'weights' should be equal to the number of embeddings");x=a.offset}var O=function(e){var r=e*t;if(null===d)s=S.RJ(r),d=s;else if(r!==d.length)throw new Error("length of 'buffer' should be equal to the product of 'numberOfCells' and the total number of dimensions")};if(null!==h){if(y!==h.length)throw new Error("'indices' and 'embeddings' should have the same length");var C=(n=S.GF(y)).array(),R=0;for(A=0;A<y;A++){var D=h[A];if(t!=D.numberOfCells())throw new Error("each element of 'indices' should have the same number of cells as 'numberOfCells'");if(e[A].length!=D.numberOfCells()*D.numberOfDims())throw new Error("length of arrays in 'embeddings' should equal the length of arrays used to build 'indices'");C[A]=BigInt(h[A].index.$$.ptr),R+=h[A].numberOfDims()}O(R),E.RE((function(e){return e.scale_by_neighbors_indices(t,y,r.offset,n.offset,d.offset,l,I,x,_)}))}else{var B=(i=S.Wf(y)).array(),z=0;for(A=0;A<y;A++){var F=e[A].length;if(B[A]=Math.floor(F/t),t*B[A]!==F)throw new Error("length of arrays in 'embeddings' should be a multiple of 'numberOfCells'");z+=B[A]}O(z),E.RE((function(e){return e.scale_by_neighbors_matrices(t,y,i.offset,r.offset,d.offset,l,I,x,p,_)}))}}catch(G){throw S.gd(s),G}finally{for(var N=0,M=Z;N<M.length;N++){M[N].free()}S.gd(r),S.gd(n),S.gd(a),S.gd(i)}}(m,b,{buffer:Xt(b*g,"Float64Array",(0,k.Z)(this,yu),"combined_buffer"),weights:s,approximate:t}),(0,k.Z)(this,yu).num_cells=b,(0,k.Z)(this,yu).total_dims=g}this.changed=!0}}else if(this.changed){var Z=(0,k.Z)(this,bu)[a[0]].fetchPCs();this.constructor.createPcsView((0,k.Z)(this,yu),Z)}null!==e&&(e=p({},e)),(0,k.Z)(this,wu).weights=e,(0,k.Z)(this,wu).approximate=t}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup(gu),r=t.createGroup("parameters");r.writeDataSet("approximate","Uint8",[],(0,k.Z)(this,wu).approximate);var n=r.createGroup("weights");if(null!==(0,k.Z)(this,wu).weights)for(var i=0,a=Object.entries((0,k.Z)(this,wu).weights);i<a.length;i++){var s=(0,h.Z)(a[i],2),o=s[0],u=s[1];n.writeDataSet(o,"Float64",[],u)}var l=t.createGroup("results"),c=this.fetchPCs();null===c.pcs.owner&&l.writeDataSet("combined","Float64",[c.num_obs,c.num_pcs],c.pcs)}}],[{key:"defaults",value:function(){return{weights:null,approximate:!0}}},{key:"createPcsView",value:function(e,t){Ht(e.combined_buffer),e.combined_buffer=t.pcs.view(),e.num_cells=t.num_obs,e.total_dims=t.num_pcs}}]),e}();function Zu(e,t){var r,n={},i=_u.defaults();try{if(gu in e.children){var a=e.open(gu),s=a.open("parameters");i.approximate=s.open("approximate",{load:!0}).values[0]>0;var u=s.open("weights"),l=Object.keys(u.children);if(l.length){i.weights={};var c,h=(0,o.Z)(l);try{for(h.s();!(c=h.n()).done;){var f=c.value;i.weights[f]=u.open(f,{load:!0}).values[0]}}catch(bn){h.e(bn)}finally{h.f()}}var d=a.open("results");if("combined"in d.children){var v=d.open("combined",{load:!0});n.num_cells=v.shape[0],n.total_dims=v.shape[1];var p=v.values;n.combined_buffer=S.RJ(p.length),n.combined_buffer.set(p)}}if(!("combined_buffer"in n)){var m=Kt(t,"PCA");if(m.length>1&&null!==i.weights){var g,b=[],w=(0,o.Z)(m);try{for(w.s();!(g=w.n()).done;){var y=g.value;i.weights[y]>0&&b.push(y)}}catch(bn){w.e(bn)}finally{w.f()}m=b}if(1!=m.length)throw new Error("only one upstream PCA state should be valid with non-zero weight if 'combined' is not available");var _=t[m[0]].fetchPCs();_u.createPcsView(n,_)}r=new _u(t,i,n)}catch(Z){throw Ht(n.combined_buffer),Ht(r),Z}return r}var ku="batch_correction",Au=new WeakMap,xu=new WeakMap,Eu=new WeakMap,Su=new WeakMap,Iu=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),(0,y.Z)(this,Au,{writable:!0,value:void 0}),(0,y.Z)(this,xu,{writable:!0,value:void 0}),(0,y.Z)(this,Eu,{writable:!0,value:void 0}),(0,y.Z)(this,Su,{writable:!0,value:void 0}),!(t instanceof bo))throw new Error("'filter' should be a CellFilteringState object");if((0,A.Z)(this,Au,t),!(r instanceof _u))throw new Error("'pca' should be a CombineEmbeddingsState object");(0,A.Z)(this,xu,r),(0,A.Z)(this,Eu,null===n?{}:n),(0,A.Z)(this,Su,null===i?{}:i),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Su).corrected)}},{key:"fetchPCs",value:function(){var e=(0,k.Z)(this,xu).fetchPCs();return e.pcs=(0,k.Z)(this,Su).corrected,e}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,Eu))}},{key:"compute",value:function(e,t,r){this.changed=!1,((0,k.Z)(this,Au).changed||(0,k.Z)(this,xu).changed)&&(this.changed=!0);var n=(0,k.Z)(this,Au).fetchFilteredBlock(),i="mnn"==e&&null!==n;if((this.changed||e!==(0,k.Z)(this,Eu).method||t!==(0,k.Z)(this,Eu).num_neighbors||r!==(0,k.Z)(this,Eu).approximate)&&i){var a=(0,k.Z)(this,xu).fetchPCs(),s=Xt(a.pcs.length,"Float64Array",(0,k.Z)(this,Su),"corrected");!function(e,t){var r,n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a.buffer,o=void 0===s?null:s,u=a.numberOfDims,l=void 0===u?null:u,c=a.numberOfCells,h=void 0===c?null:c,f=a.k,d=void 0===f?15:f,v=a.numberOfMADs,p=void 0===v?3:v,m=a.robustIterations,g=void 0===m?2:m,b=a.robustTrim,w=void 0===b?.25:b,y=a.referencePolicy,_=void 0===y?"max-size":y,Z=a.approximate,k=void 0===Z||Z,A=a.numberOfThreads,x=void 0===A?null:A,I=S.mV(x);try{if(e instanceof $e)l=e.numberOfPCs(),h=e.numberOfCells(),e=e.principalComponents({copy:"view"});else{if(null===l||null===h||l*h!==e.length)throw new Error("length of 'x' must be equal to the product of 'numberOfDims' and 'numberOfCells'");n=S.de(e,"Float64WasmArray"),e=n}if(null==o)r=S.RJ(h*l),o=r;else if(o.length!==e.length)throw new Error("length of 'buffer' must be equal to the product of the number of dimensions and cells");if((i=S.de(t,"Int32WasmArray")).length!=h)throw new Error("'block' must be of length equal to the number of cells in 'x'");E.RE((function(t){return t.mnn_correct(l,h,e.offset,i.offset,o.offset,d,p,g,w,_,k,I)}))}catch(O){throw S.gd(r),O}finally{S.gd(n)}}(a.pcs,n,{k:t,buffer:s,numberOfCells:a.num_obs,numberOfDims:a.num_pcs,approximate:r}),this.changed=!0}if(this.changed&&!i){Ht((0,k.Z)(this,Su).corrected);var o=(0,k.Z)(this,xu).fetchPCs();(0,k.Z)(this,Su).corrected=o.pcs.view()}(0,k.Z)(this,Eu).method=e,(0,k.Z)(this,Eu).num_neighbors=t,(0,k.Z)(this,Eu).approximate=r}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup(ku),r=t.createGroup("parameters");r.writeDataSet("method","String",[],(0,k.Z)(this,Eu).method),r.writeDataSet("num_neighbors","Int32",[],(0,k.Z)(this,Eu).num_neighbors),r.writeDataSet("approximate","Uint8",[],Number((0,k.Z)(this,Eu).approximate));var n=t.createGroup("results"),i=this.fetchPCs();null===i.pcs.owner&&n.writeDataSet("corrected","Float64",[i.num_obs,i.num_pcs],i.pcs)}}],[{key:"defaults",value:function(){return{method:"mnn",num_neighbors:15,approximate:!0}}}]),e}();function Ou(e,t,r){var n,i={},a=Iu.defaults();if(ku in e.children){var s=e.open(ku),o=s.open("parameters");a.method=o.open("method",{load:!0}).values[0],a.num_neighbors=o.open("num_neighbors",{load:!0}).values[0],a.approximate=o.open("approximate",{load:!0}).values[0]>0;try{var u=s.open("results");if("corrected"in u.children){var l=u.open("corrected",{load:!0}).values;i.corrected=S.RJ(l.length),i.corrected.set(l)}else{var c=r.fetchPCs();i.corrected=c.pcs.view()}n=new Iu(t,r,a,i)}catch(d){throw Ht(i.corrected),Ht(n),d}}else{var h=e.open("pca").open("results");if("corrected"in h){var f=h.open("corrected",{load:!0}).values;Xt(f.length,"Float64Array",i,"corrected").set(f)}n=new Iu(t,r,a,i)}return n}var Cu="neighbor_index",Ru=new WeakMap,Du=new WeakMap,Bu=new WeakMap,zu=new WeakSet,Fu=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,e),w(this,zu),(0,y.Z)(this,Ru,{writable:!0,value:void 0}),(0,y.Z)(this,Du,{writable:!0,value:void 0}),(0,y.Z)(this,Bu,{writable:!0,value:void 0}),!(t instanceof Iu))throw new Error("'correct' should be a BatchCorrectionState object");(0,A.Z)(this,Ru,t),(0,A.Z)(this,Du,null===r?{}:r),(0,A.Z)(this,Bu,null===n?{}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Bu).raw)}},{key:"fetchIndex",value:function(){return"raw"in(0,k.Z)(this,Bu)||_(this,zu,Nu).call(this,(0,k.Z)(this,Du).approximate),(0,k.Z)(this,Bu).raw}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,Du))}},{key:"compute",value:function(e){this.changed=!1,((0,k.Z)(this,Ru).changed||e!=(0,k.Z)(this,Du).approximate)&&(Ht((0,k.Z)(this,Bu).raw),_(this,zu,Nu).call(this,e),(0,k.Z)(this,Du).approximate=e,this.changed=!0)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("neighbor_index");t.createGroup("parameters").writeDataSet("approximate","Uint8",[],Number((0,k.Z)(this,Du).approximate)),t.createGroup("results")}}],[{key:"defaults",value:function(){return{approximate:!0}}}]),e}();function Nu(e){var t=(0,k.Z)(this,Ru).fetchPCs();(0,k.Z)(this,Bu).raw=function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.numberOfDims,a=void 0===i?null:i,s=n.numberOfCells,o=void 0===s?null:s,u=n.approximate,l=void 0===u||u;try{var c;if(e instanceof $e){a=e.numberOfPCs(),o=e.numberOfCells();var h=e.principalComponents({copy:!1});c=h.byteOffset}else{if(null===a||null===o)throw new Error("'numberOfDims' and 'numberOfCells' must be specified when 'x' is an Array");if((t=S.de(e,"Float64WasmArray")).length!=a*o)throw new Error("length of 'x' must be the product of 'numberOfDims' and 'numberOfCells'");c=t.offset}r=I.R((function(e){return e.build_neighbor_index(c,a,o,l)}),lt)}catch(f){throw S.gd(r),f}finally{S.gd(t)}return r}(t.pcs,{approximate:e,numberOfDims:t.num_pcs,numberOfCells:t.num_obs})}function Mu(e,t){var r;r={approximate:e.open("neighbor_index").open("parameters").open("approximate",{load:!0}).values[0]>0};return new Fu(t,r,{})}var Gu={min:0,mean:1,min_rank:4},Wu={0:"min",1:"mean",4:"min_rank"};function ju(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.no_summaries,a=void 0!==i&&i,s=0,o=["means","detected"];s<o.length;s++){var u=o[s],l=t[u](r,{copy:"hdf5"});e.writeDataSet(u,"Float64",null,l)}for(var c=function(){var n=d[f],i=n;"delta_detected"==n&&(i="deltaDetected");var s=function(e){return t[i](r,{summary:e,copy:"hdf5"})};if(a){var o=s(Gu.mean);e.writeDataSet(n,"Float64",null,o)}else for(var u=e.createGroup(n),l=0,c=Object.entries(Gu);l<c.length;l++){var v=(0,h.Z)(c[l],2),p=v[0],m=s(v[1]);u.writeDataSet(p,"Float64",null,m)}},f=0,d=["lfc","delta_detected","auc","cohen"];f<d.length;f++)c()}function Tu(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.no_summaries,i=void 0!==n&&n,a={},s=0,o=["means","detected"];s<o.length;s++){var u=o[s];a[u]=e.open(u,{load:!0}).values,t(a[u])}for(var l=0,c=["lfc","delta_detected","auc","cohen"];l<c.length;l++){var h=c[l];if(i)a[h]=e.open(h,{load:!0}).values;else{for(var f=e.open(h),d={},v=0,p=Object.keys(Gu);v<p.length;v++){var m=p[v];d[m]=f.open(m,{load:!0}).values,t(d[m])}a[h]=d}}return a}function Uu(e,t,r){var n;r&&void 0!==r||(r="cohen-min-rank");var i,a=!1,s=1;if(r.match(/-min$/)?s=0:r.match(/-min-rank$/)&&(a=!0,s=4),r.match(/^cohen-/))i=e.cohen(t,{summary:s,copy:!1});else if(r.match(/^auc-/))i=e.auc(t,{summary:s,copy:!1});else if(r.match(/^lfc-/))i=e.lfc(t,{summary:s,copy:!1});else{if(!r.match(/^delta-d-/))throw"unknown rank type '"+r+"'";i=e.deltaDetected(t,{summary:s,copy:!1})}n=new Int32Array(i.length);for(var o=0;o<n.length;o++)n[o]=o;a?n.sort((function(e,t){return i[e]-i[t]})):n.sort((function(e,t){return i[t]-i[e]}));var u=function(e){for(var t=new Float64Array(e.length),r=0;r<n.length;r++)t[r]=e[n[r]];return t},l=u(e.detected(t,{copy:!1})),c=u(e.means(t,{copy:!1})),h=u(e.lfc(t,{summary:1,copy:!1})),f=u(e.deltaDetected(t,{summary:1,copy:!1}));return{ordering:n,means:c,detected:l,lfc:h,delta_detected:f}}function Qu(e,t,r,n,i,a){"versus"in i||(i.versus={});var s=i.versus,o=e<t?t:e,u=e<t?e:t;o in s||(s[o]={});var l=s[o];u in l||(l[u]={});var c=l[u];return n in c||(c[n]=a(u,o)),Uu(c[n],e<t?0:1,r+"-mean")}function qu(e){if("versus"in e){for(var t=0,r=Object.values(e.versus);t<r.length;t++)for(var n=r[t],i=0,a=Object.values(n);i<a.length;i++)for(var s=a[i],o=0,u=Object.values(s);o<u.length;o++){var l=u[o];S.gd(l)}delete e.versus}}function Pu(e){var t=0,r={};e.forEach((function(n,i){n in r||(r[n]=t,t++),e[i]=r[n]}))}var Lu=new WeakMap,Vu=new WeakMap,Hu=new WeakMap,Yu=new WeakSet,Ju=new WeakSet,Xu=new WeakSet,Ku=new WeakSet,$u=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,e),w(this,Ku),w(this,Xu),w(this,Ju),w(this,Yu),(0,y.Z)(this,Lu,{writable:!0,value:void 0}),(0,y.Z)(this,Vu,{writable:!0,value:void 0}),(0,y.Z)(this,Hu,{writable:!0,value:void 0}),!(t instanceof Fu))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,Lu,t),(0,A.Z)(this,Vu,null===r?{}:r),(0,A.Z)(this,Hu,null===n?{}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Hu).neighbors),Ht((0,k.Z)(this,Hu).graph),Ht((0,k.Z)(this,Hu).clusters)}},{key:"fetchClustersAsWasmArray",value:function(){if(_(this,Yu,el).call(this))return(0,k.Z)(this,Hu).clusters.membership({copy:"view"});throw"cannot fetch SNN clusters from an invalid state"}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,Vu))}},{key:"compute",value:function(e,t,r,n){this.changed=!1,((0,k.Z)(this,Lu).changed||t!==(0,k.Z)(this,Vu).k)&&(Ht((0,k.Z)(this,Hu).neighbors),e?_(this,Ju,tl).call(this,t):delete(0,k.Z)(this,Hu).neighbors,(0,k.Z)(this,Vu).k=t,this.changed=!0),(this.changed||r!==(0,k.Z)(this,Vu).scheme)&&(Ht((0,k.Z)(this,Hu).graph),e?_(this,Xu,rl).call(this,r):delete(0,k.Z)(this,Hu).graph,(0,k.Z)(this,Vu).scheme=r,this.changed=!0),(this.changed||n!==(0,k.Z)(this,Vu).resolution||!_(this,Yu,el).call(this)&&e)&&(Ht((0,k.Z)(this,Hu).clusters),e?_(this,Ku,nl).call(this,n):delete(0,k.Z)(this,Hu).clusters,(0,k.Z)(this,Vu).resolution=n,this.changed=!0)}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("snn_graph_cluster"),r=t.createGroup("parameters");r.writeDataSet("k","Int32",[],(0,k.Z)(this,Vu).k),r.writeDataSet("scheme","String",[],(0,k.Z)(this,Vu).scheme),r.writeDataSet("resolution","Float64",[],(0,k.Z)(this,Vu).resolution);var n=t.createGroup("results");if(_(this,Yu,el).call(this)){var i=this.fetchClustersAsWasmArray();n.writeDataSet("clusters","Int32",null,i)}}}]),e}();function el(){return"clusters"in(0,k.Z)(this,Hu)}function tl(e){(0,k.Z)(this,Hu).neighbors=dt((0,k.Z)(this,Lu).fetchIndex(),e)}function rl(e){"neighbors"in(0,k.Z)(this,Hu)||_(this,Ju,tl).call(this,(0,k.Z)(this,Vu).k),(0,k.Z)(this,Hu).graph=function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.scheme,a=void 0===i?"rank":i,s=n.neighbors,o=void 0===s?10:s,u=n.numberOfThreads,l=void 0===u?null:u,c=S.mV(l);"number"==typeof a&&(a=["rank","number","jaccard"][a]);try{var h;e instanceof ft?h=e:(r=dt(e,o,{numberOfThreads:c}),h=r),t=I.R((function(e){return e.build_snn_graph(h.results,a,c)}),mt)}catch(f){throw S.gd(t),f}finally{S.gd(r)}return t}((0,k.Z)(this,Hu).neighbors,{scheme:e})}function nl(e){"graph"in(0,k.Z)(this,Hu)||_(this,Xu,rl).call(this,(0,k.Z)(this,Vu).scheme),(0,k.Z)(this,Hu).clusters=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.method,i=void 0===n?"multilevel":n,a=r.resolution,s=void 0===a?1:a,o=r.walktrapSteps,u=void 0===o?4:o;try{if("multilevel"==i)t=I.R((function(t){return t.cluster_snn_graph_multilevel(e.graph,s)}),wt);else if("walktrap"==i)t=I.R((function(t){return t.cluster_snn_graph_walktrap(e.graph,u)}),Zt);else{if("leiden"!=i)throw new Error("unknown method '"+i+"'");t=I.R((function(t){return t.cluster_snn_graph_leiden(e.graph,s)}),xt)}}catch(l){throw S.gd(t),l}return t}((0,k.Z)(this,Hu).graph,{resolution:e})}var il=function(){function e(t){(0,m.Z)(this,e),this.buffer=S.Wf(t.length),this.buffer.set(t)}return(0,g.Z)(e,[{key:"membership",value:function(e){var t=e.copy;return Vt(this.buffer,t)}},{key:"free",value:function(){this.buffer.free()}}]),e}();function al(e,t){var r=e.open("snn_graph_cluster"),n={},i=r.open("parameters");n.k=i.open("k",{load:!0}).values[0],n.scheme=i.open("scheme",{load:!0}).values[0],"string"!==typeof n.scheme&&(n.scheme="rank"),n.resolution=i.open("resolution",{load:!0}).values[0];var a={},s=r.open("results");if("clusters"in s.children){var o=s.open("clusters",{load:!0}).values;a.clusters=new il(o)}return new $u(t,n,a)}var sl=new WeakMap,ol=new WeakMap,ul=new WeakMap,ll=new WeakSet,cl=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,e),w(this,ll),(0,y.Z)(this,sl,{writable:!0,value:void 0}),(0,y.Z)(this,ol,{writable:!0,value:void 0}),(0,y.Z)(this,ul,{writable:!0,value:void 0}),!(t instanceof Iu))throw new Error("'correct' should be a BatchCorrectionState object");(0,A.Z)(this,sl,t),(0,A.Z)(this,ol,null===r?{}:r),(0,A.Z)(this,ul,null===n?{}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,ul).raw)}},{key:"fetchClustersAsWasmArray",value:function(){if(_(this,ll,hl).call(this))return(0,k.Z)(this,ul).raw.clusters({copy:"view"});throw new Error("cannot fetch k-means clusters from an invalid state")}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,ol))}},{key:"compute",value:function(e,t){if(this.changed=!1,(0,k.Z)(this,sl).changed||t!=(0,k.Z)(this,ol).k||!_(this,ll,hl).call(this)&&e){if(Ht((0,k.Z)(this,ul).raw),e){var r=(0,k.Z)(this,sl).fetchPCs();(0,k.Z)(this,ul).raw=it(r.pcs,t,{numberOfDims:r.num_pcs,numberOfCells:r.num_obs,initMethod:"pca-part"})}else delete(0,k.Z)(this,ul).raw;(0,k.Z)(this,ol).k=t,this.changed=!0}}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("kmeans_cluster");t.createGroup("parameters").writeDataSet("k","Int32",[],(0,k.Z)(this,ol).k);var r=t.createGroup("results");if(_(this,ll,hl).call(this)){var n=this.fetchClustersAsWasmArray();r.writeDataSet("clusters","Int32",null,n)}}}]),e}();function hl(){return"raw"in(0,k.Z)(this,ul)}var fl=function(){function e(t){(0,m.Z)(this,e),this.buffer=S.Wf(t.length),this.buffer.set(t)}return(0,g.Z)(e,[{key:"clusters",value:function(e){var t=e.copy;return Vt(this.buffer,t)}},{key:"free",value:function(){this.buffer.free()}}]),e}();function dl(e,t){var r={k:10},n={};if("kmeans_cluster"in e.children){var i=e.open("kmeans_cluster"),a=i.open("parameters");r.k=a.open("k",{load:!0}).values[0];var s=i.open("results");if("clusters"in s.children){var o=s.open("clusters",{load:!0}).values;n.raw=new fl(o)}}return new cl(t,r,n)}var vl=new WeakMap,pl=new WeakMap,ml=new WeakMap,gl=new WeakMap,bl=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),(0,y.Z)(this,vl,{writable:!0,value:void 0}),(0,y.Z)(this,pl,{writable:!0,value:void 0}),(0,y.Z)(this,ml,{writable:!0,value:void 0}),(0,y.Z)(this,gl,{writable:!0,value:void 0}),!(t instanceof $u))throw new Error("'snn' should be a State object from './snn_graph_cluster.js'");if((0,A.Z)(this,vl,t),!(r instanceof cl))throw new Error("'kmeans' should be a State object from './kmeans_cluster.js'");(0,A.Z)(this,pl,r),(0,A.Z)(this,ml,null===n?{}:n),(0,A.Z)(this,gl,null===i?{}:i),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){}},{key:"fetchClustersAsWasmArray",value:function(){return"snn_graph"==(0,k.Z)(this,ml).method?(0,k.Z)(this,vl).fetchClustersAsWasmArray():"kmeans"==(0,k.Z)(this,ml).method?(0,k.Z)(this,pl).fetchClustersAsWasmArray():void 0}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,ml))}},{key:"fetchClusterIndices",value:function(e){var t=[];return this.fetchClustersAsWasmArray().forEach((function(r,n){r==e&&t.push(n)})),t}},{key:"compute",value:function(e){this.changed=!0,e==(0,k.Z)(this,ml).method&&("snn_graph"==e?(0,k.Z)(this,vl).changed||(this.changed=!1):"kmeans"==e&&((0,k.Z)(this,pl).changed||(this.changed=!1))),(0,k.Z)(this,ml).method=e}},{key:"summary",value:function(){return{clusters:this.fetchClustersAsWasmArray().slice()}}},{key:"serialize",value:function(e){var t=e.createGroup("choose_clustering");t.createGroup("parameters").writeDataSet("method","String",[],(0,k.Z)(this,ml).method),t.createGroup("results")}}]),e}();function wl(e,t,r){var n;n={method:e.open("choose_clustering").open("parameters").open("method",{load:!0}).values[0]};return new bl(t,r,n,{})}var yl="marker_detection",_l=new WeakMap,Zl=new WeakMap,kl=new WeakMap,Al=new WeakMap,xl=new WeakMap,El=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,m.Z)(this,e),(0,y.Z)(this,_l,{writable:!0,value:void 0}),(0,y.Z)(this,Zl,{writable:!0,value:void 0}),(0,y.Z)(this,kl,{writable:!0,value:void 0}),(0,y.Z)(this,Al,{writable:!0,value:void 0}),(0,y.Z)(this,xl,{writable:!0,value:void 0}),!(t instanceof bo))throw new Error("'filter' should be a State object from './cell_filtering.js'");(0,A.Z)(this,_l,t);for(var s=0,o=Object.values(r);s<o.length;s++){var u=o[s];if(!(u instanceof ko))throw new Error("'norm' should be a NormalizationStateBase object")}if((0,A.Z)(this,Zl,r),!(n instanceof bl))throw new Error("'choice' should be a State object from './choose_clustering.js'");(0,A.Z)(this,kl,n),(0,A.Z)(this,Al,null===i?{}:i),(0,A.Z)(this,xl,null===a?{raw:{}}:a),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){for(var e=0,t=Object.values((0,k.Z)(this,xl).raw);e<t.length;e++){Ht(t[e])}qu((0,k.Z)(this,xl))}},{key:"fetchGroupResults",value:function(e,t,r){return Uu((0,k.Z)(this,xl).raw[r],e,t)}},{key:"numberOfGroups",value:function(){return Object.values((0,k.Z)(this,xl).raw)[0].numberOfGroups()}},{key:"fetchGroupMeans",value:function(e,t,r){var n=r.copy,i=void 0===n||n;return(0,k.Z)(this,xl).raw[t].means(e,{copy:i})}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,Al))}},{key:"compute",value:function(){this.changed=!1;for(var e=0,t=Object.entries((0,k.Z)(this,Zl));e<t.length;e++){var r=(0,h.Z)(t[e],2),n=r[0],i=r[1];if(i.valid()&&(i.changed||(0,k.Z)(this,kl).changed)){var a=i.fetchNormalizedMatrix(),s=(0,k.Z)(this,kl).fetchClustersAsWasmArray(),o=(0,k.Z)(this,_l).fetchFilteredBlock();Ht((0,k.Z)(this,xl).raw[n]),(0,k.Z)(this,xl).raw[n]=Ct(a,s,{block:o}),this.changed=!0}}this.changed&&qu((0,k.Z)(this,xl))}},{key:"computeVersus",value:function(e,t,r,n){var i=(0,k.Z)(this,kl).fetchClustersAsWasmArray(),a=(0,k.Z)(this,Zl)[n].fetchNormalizedMatrix(),s=(0,k.Z)(this,_l).fetchFilteredBlock();return this.constructor.computeVersusCustom(e,t,r,n,a,i,{cache:(0,k.Z)(this,xl),block:s})}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){var t=e.createGroup("marker_detection");t.createGroup("parameters");for(var r=t.createGroup("results").createGroup("per_cluster"),n=0,i=Object.entries((0,k.Z)(this,xl).raw);n<i.length;n++)for(var a=(0,h.Z)(i[n],2),s=a[0],o=a[1],u=r.createGroup(s),l=o.numberOfGroups(),c=0;c<l;c++){ju(u.createGroup(String(c)),o,c)}}}],[{key:"defaults",value:function(){return{}}},{key:"computeVersusCustom",value:function(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},o=s.cache,u=void 0===o?{}:o,l=s.block,c=void 0===l?null:l,h=function(e,t){var r=[],n=[],s=!1,o=!1;if(a.forEach((function(i,a){i==e?(r.push(0),n.push(a),s=!0):i==t&&(r.push(1),n.push(a),o=!0)})),!s||!o)throw new Error("non-zero entries should be present for both requested clusters in versus mode");var u,l,h=null;if(null!==c){var f=c.array();Pu(h=n.map((function(e){return f[e]})))}try{u=Ct(l=Be(i,n),r,{block:h})}finally{Ht(l)}return u};return Qu(e,t,r,n,u,h)}}]),e}(),Sl=function(){function e(t){(0,m.Z)(this,e),this.clusters=t}return(0,g.Z)(e,[{key:"effect_grabber",value:function(e,t,r,n){var i=Wu[r];return Vt(this.clusters[t][e][i],n)}},{key:"lfc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("lfc",e,r,n)}},{key:"deltaDetected",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("delta_detected",e,r,n)}},{key:"cohen",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("cohen",e,r,n)}},{key:"auc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("auc",e,r,n)}},{key:"stat_grabber",value:function(e,t,r){return Vt(this.clusters[t][e],r)}},{key:"means",value:function(e,t){var r=t.copy;return this.stat_grabber("means",e,r)}},{key:"detected",value:function(e,t){var r=t.copy;return this.stat_grabber("detected",e,r)}},{key:"numberOfGroups",value:function(){return Object.keys(this.clusters).length}},{key:"free",value:function(){}}]),e}();function Il(e,t,r,n,i){var a={},s=e.open("marker_detection").open("results");if("clusters"in s.children){for(var o=s.open("clusters"),u={},l=0,c=Object.keys(o.children);l<c.length;l++){var h=c[l];u[Number(h)]=Tu(o.open(h),t.RNA)}a.raw={RNA:new Sl(u)}}else{var f=s.open("per_cluster");a.raw={};for(var d=0,v=Object.keys(f.children);d<v.length;d++){for(var p=v[d],m={},g=f.open(p),b=0,w=Object.keys(g.children);b<w.length;b++){var y=w[b];m[Number(y)]=Tu(g.open(y),t[p])}a.raw[p]=new Sl(m)}}return new El(r,n,i,{},a)}var Ol="custom_selections",Cl=new WeakMap,Rl=new WeakMap,Dl=new WeakMap,Bl=new WeakMap,zl=new WeakSet,Fl=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),w(this,zl),(0,y.Z)(this,Cl,{writable:!0,value:void 0}),(0,y.Z)(this,Rl,{writable:!0,value:void 0}),(0,y.Z)(this,Dl,{writable:!0,value:void 0}),(0,y.Z)(this,Bl,{writable:!0,value:void 0}),!(t instanceof bo))throw new Error("'filter' should be a State object from './cell_filtering.js'");(0,A.Z)(this,Cl,t);for(var a=0,s=Object.values(r);a<s.length;a++){var o=s[a];if(!(o instanceof ko))throw new Error("'norm' should be a NormalizationStateBase object")}(0,A.Z)(this,Rl,r),(0,A.Z)(this,Dl,null===i?{results:{}}:i),(0,A.Z)(this,Bl,null===n?{selections:{}}:n),this.changed=!1}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Dl).buffer);for(var e=0,t=Object.keys((0,k.Z)(this,Dl).results);e<t.length;e++){var r=t[e];_(this,zl,Nl).call(this,r)}qu((0,k.Z)(this,Dl))}},{key:"addSelection",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.copy,i=void 0===n||n,a=Kt((0,k.Z)(this,Rl)),s=(0,k.Z)(this,Rl)[a[0]].fetchNormalizedMatrix();$t(t,s.numberOfColumns());var u=Xt(s.numberOfColumns(),"Int32Array",(0,k.Z)(this,Dl));u.fill(0);var l=u.array();t.forEach((function(e){l[e]=1}));var c,h={},f=(0,o.Z)(a);try{for(f.s();!(c=f.n()).done;){var d=c.value,v=(0,k.Z)(this,Rl)[d];if(v.valid()){var p=v.fetchNormalizedMatrix();h[d]=Ct(p,u)}}}catch(bn){f.e(bn)}finally{f.f()}e in(0,k.Z)(this,Dl).results&&_(this,zl,Nl).call(this,e),(0,k.Z)(this,Dl).results[e]={raw:h},i&&(t=t.slice()),(0,k.Z)(this,Bl).selections[e]=t}},{key:"removeSelection",value:function(e){_(this,zl,Nl).call(this,e),delete(0,k.Z)(this,Dl).results[e],delete(0,k.Z)(this,Bl).selections[e]}},{key:"fetchResults",value:function(e,t,r){return Uu((0,k.Z)(this,Dl).results[e].raw[r],1,t+"-mean")}},{key:"fetchSelectionIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.copy,n=void 0===r||r,i=(0,k.Z)(this,Bl).selections[e];return n&&(i=i.slice()),i}},{key:"fetchSelections",value:function(){for(var e={},t=0,r=Object.entries((0,k.Z)(this,Bl).selections);t<r.length;t++){var n=(0,h.Z)(r[t],2),i=n[0],a=n[1];e[i]=a.slice()}return e}},{key:"fetchParameters",value:function(){return{}}},{key:"compute",value:function(){if(this.changed=!1,(0,k.Z)(this,Cl).changed){for(var e=0,t=Object.entries((0,k.Z)(this,Dl).results);e<t.length;e++){var r=t[e];_(this,zl,Nl).call(this,r)}(0,k.Z)(this,Bl).selections={},(0,k.Z)(this,Dl).results={},qu((0,k.Z)(this,Dl)),this.changed=!0}}},{key:"computeVersus",value:function(e,t,r,n){var i=(0,k.Z)(this,Cl).fetchFilteredBlock(),a=(0,k.Z)(this,Rl)[n].fetchNormalizedMatrix();return this.constructor.computeVersusCustom(e,t,r,n,a,(0,k.Z)(this,Bl).selections,{cache:(0,k.Z)(this,Dl),block:i})}},{key:"summary",value:function(){return{}}},{key:"serialize",value:function(e){for(var t=e.createGroup("custom_selections"),r=t.createGroup("parameters").createGroup("selections"),n=0,i=Object.entries((0,k.Z)(this,Bl).selections);n<i.length;n++){var a=(0,h.Z)(i[n],2),s=a[0],o=a[1];r.writeDataSet(String(s),"Int32",null,o)}for(var u=t.createGroup("results").createGroup("per_selection"),l=0,c=Object.entries((0,k.Z)(this,Dl).results);l<c.length;l++)for(var f=(0,h.Z)(c[l],2),d=f[0],v=f[1],p=u.createGroup(d),m=0,g=Object.entries(v.raw);m<g.length;m++){var b=(0,h.Z)(g[m],2),w=b[0],y=b[1];ju(p.createGroup(w),y,1,{no_summaries:!0})}}}],[{key:"defaults",value:function(){return{}}},{key:"computeVersusCustom",value:function(e,t,r,n,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},o=s.cache,u=void 0===o?{}:o,l=s.block,c=void 0===l?null:l,h=function(e,t){if(!(e in a)||!(t in a))throw new Error("invalid selection ID requested in versus mode");var r=a[e],n=a[t];if(0==r.length||0==n.length)throw new Error("non-zero entries should be present for both requested selections in versus mode");var s=[];r.forEach((function(e,t){s.push({index:t,cluster:0})})),n.forEach((function(e,t){s.push({index:t,cluster:1})})),s.sort((function(e,t){return e.index-t.index}));var o,u,l=s.map((function(e){return e.index})),h=s.map((function(e){return e.cluster})),f=null;if(null!==c){var d=c.array();Pu(f=l.map((function(e){return d[e]})))}try{o=Ct(u=Be(i,l),h,{block:f})}finally{Ht(u)}return o};return Qu(e,t,r,n,u,h)}}]),e}();function Nl(e){for(var t=0,r=Object.entries((0,k.Z)(this,Dl).results[e].raw);t<r.length;t++){var n=(0,h.Z)(r[t],2);n[0];n[1].free()}}var Ml=function(){function e(t){(0,m.Z)(this,e),this.results=t}return(0,g.Z)(e,[{key:"effect_grabber",value:function(e,t,r,n){if(1!=t)throw"only group 1 is supported for custom marker mimics";if(1!=r)throw"only the mean effect size is supported for custom marker mimics";return Vt(this.results[t][e],n)}},{key:"lfc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("lfc",e,r,n)}},{key:"deltaDetected",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("delta_detected",e,r,n)}},{key:"cohen",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("cohen",e,r,n)}},{key:"auc",value:function(e,t){var r=t.summary,n=t.copy;return this.effect_grabber("auc",e,r,n)}},{key:"stat_grabber",value:function(e,t,r){return Vt(this.results[t][e],r)}},{key:"means",value:function(e,t){var r=t.copy;return this.stat_grabber("means",e,r)}},{key:"detected",value:function(e,t){var r=t.copy;return this.stat_grabber("detected",e,r)}},{key:"free",value:function(){}}]),e}();function Gl(e,t,r,n){for(var i=e.open("custom_selections"),a={selections:{}},s=i.open("parameters").open("selections"),o=0,u=Object.keys(s.children);o<u.length;o++){for(var l=u[o],c=s.open(l,{load:!0}).values,h=1;h<c.length;h++)if(c[h]<c[h-1]){c.sort();break}a.selections[l]=c}var f={results:{}},d=i.open("results");if("markers"in d.children)for(var v=d.open("markers"),p=0,m=Object.keys(v.children);p<m.length;p++){var g=m[p],b=Tu(v.open(g),t.RNA,{no_summaries:!0});f.results[g]={raw:{RNA:new Ml({1:b})}}}else for(var w=d.open("per_selection"),y=0,_=Object.keys(w.children);y<_.length;y++){for(var Z=_[y],k=w.open(Z),A={},x=0,E=Object.keys(k.children);x<E.length;x++){var S=E[x],I=Tu(k.open(S),t[S],{no_summaries:!0});A[S]=new Ml({1:I})}f.results[Z]={raw:A}}return new Fl(r,n,a,f)}function Wl(){var e={feature_selection:{span:.3},combine_embeddings:{weights:null},batch_correction:{method:"none"},tsne:{perplexity:30,iterations:500,animate:!1},umap:{num_neighbors:15,num_epochs:500,min_dist:.1,animate:!1},kmeans_cluster:{k:10},snn_graph_cluster:{k:10,scheme:"rank",resolution:1},choose_clustering:{method:"snn_graph"},cell_labelling:{mouse_references:[],human_references:[]}};return e.inputs=ws.defaults(),e.quality_control=Vs.defaults(),e.adt_quality_control=io.defaults(),e.cell_filtering=bo.defaults(),e.normalization=Co.defaults(),e.adt_normalization=Wo.defaults(),e.pca=ou.defaults(),e.adt_pca=pu.defaults(),e.combine_embeddings=_u.defaults(),e.batch_correction=Iu.defaults(),e.neighbor_index=Fu.defaults(),e.marker_detection=El.defaults(),e.custom_selections=Fl.defaults(),e}var jl=[tu,cu];function Tl(e,t){var r,n;if("mnn"==t)r=t,n="weight";else if("regress"==t)r="none",n=t;else{if("none"!=t)throw new Error("unknown correction method '"+t+"'");r=t,n=t}e.batch_correction.method=r;var i,a=(0,o.Z)(jl);try{for(a.s();!(i=a.n()).done;){e[i.value].block_method=n}}catch(bn){a.e(bn)}finally{a.f()}return e}function Ul(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.strict,i=void 0!==n&&n,a=new Set(jl.map((function(t){return e[t].block_method})));return"mnn"==e.batch_correction.method?(t="mnn",i&&(a.size>1||!a.has("weight"))&&(t=null)):t=a.has("regress")?i&&a.size>1?null:"regress":a.has("none")?i&&a.size>1?null:"none":i?null:"none",t}var Ql=[ku,gu,Cu];function ql(e,t){var r,n=(0,o.Z)(Ql);try{for(n.s();!(r=n.n()).done;){e[r.value].approximate=t}}catch(bn){n.e(bn)}finally{n.f()}return e}function Pl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.strict,n=void 0!==r&&r,i=new Set(Ql.map((function(t){return e[t].approximate})));return n&&i.size>1?null:i.has(!0)}function Ll(){return new Worker(new URL(r.p+r.u(484),r.b),{type:void 0})}function Vl(){return new Worker(new URL(r.p+r.u(933),r.b),{type:void 0})}function Hl(e,t,r){e.postMessage(t,r)}var Yl=function(e,t,r){return null};function Jl(e){var t=Yl;return Yl=e,t}var Xl={numberOfThreads:1};function Kl(e,t){var r=e.fetchIndex(),n={num_obs:r.numberOfCells()},i=null,a=null,s=null,o=null;try{i=dt(r,t),a=S.Wf(i.numberOfCells()),s=S.Wf(i.size()),o=S.RJ(i.size()),i.serialize({runs:a,indices:s,distances:o}),n.size=i.size(),n.runs=a.array().slice(),n.indices=s.array().slice(),n.distances=o.array().slice()}finally{null!==i&&i.free(),null!==a&&a.free(),null!==s&&s.free(),null!==o&&o.free()}return n}function $l(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=r.counter,a=new Promise((function(e,t){r.promises[i]={resolve:e,reject:t}}));return r.counter++,t.id=i,Hl(e,t,n),a}var ec=[];function tc(e,t,r){var n=ec.length;return ec.push(e),function(e,t){e.onmessage=t}(e,(function(e){var r=e.data.type;if(r.endsWith("_iter"))Yl(r.slice(0,-5),e.data.x,e.data.y,e.data.iteration);else{var n=e.data.id,i=t.promises[n];"error"==r?i.reject(e.data.error):i.resolve(e.data.data),delete t.promises[n]}})),{worker_id:n,ready:$l(e,{cmd:"INIT",scranOptions:r},t)}}function rc(e){var t=ec[e];return ec[e]=null,function(e){e.terminate()}(t)}function nc(e,t,r,n){var i={cmd:"RUN",params:t},a=[];return null!==r&&(a=[r.runs.buffer,r.indices.buffer,r.distances.buffer],i.neighbors=r),$l(e,i,n,a)}var ic=new WeakMap,ac=new WeakMap,sc=new WeakMap,oc=new WeakMap,uc=new WeakMap,lc=new WeakMap,cc=new WeakMap,hc=new WeakMap,fc=new WeakSet,dc=new WeakSet,vc=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,e),w(this,dc),w(this,fc),(0,y.Z)(this,ic,{writable:!0,value:void 0}),(0,y.Z)(this,ac,{writable:!0,value:void 0}),(0,y.Z)(this,sc,{writable:!0,value:void 0}),(0,y.Z)(this,oc,{writable:!0,value:void 0}),(0,y.Z)(this,uc,{writable:!0,value:void 0}),(0,y.Z)(this,lc,{writable:!0,value:void 0}),(0,y.Z)(this,cc,{writable:!0,value:void 0}),(0,y.Z)(this,hc,{writable:!0,value:void 0}),!(t instanceof Fu))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,ic,t),(0,A.Z)(this,ac,null===r?{}:r),(0,A.Z)(this,sc,{counter:0,promises:{}}),(0,A.Z)(this,oc,n),this.changed=!1;var i=Ll(),a=tc(i,(0,k.Z)(this,sc),Xl),s=a.worker_id,o=a.ready;(0,A.Z)(this,uc,i),(0,A.Z)(this,lc,s),(0,A.Z)(this,cc,o),(0,A.Z)(this,hc,null)}return(0,g.Z)(e,[{key:"ready",value:function(){return(0,k.Z)(this,cc)}},{key:"free",value:function(){return rc((0,k.Z)(this,lc))}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,ac))}},{key:"compute",value:function(e,t,r){var n=!(0,k.Z)(this,ic).changed&&e===(0,k.Z)(this,ac).perplexity;return n&&t==(0,k.Z)(this,ac).iterations?(this.changed=!1,new Promise((function(e){return e(null)}))):(null!==(0,k.Z)(this,oc)&&(n=!1,(0,A.Z)(this,oc,null)),_(this,fc,pc).call(this,e,t,r,!n),(0,k.Z)(this,ac).perplexity=e,(0,k.Z)(this,ac).iterations=t,(0,k.Z)(this,ac).animate=r,this.changed=!0,(0,k.Z)(this,hc))}},{key:"summary",value:function(){return _(this,dc,mc).call(this,!0)}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){var r,n,i,a;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("tsne"),(n=r.createGroup("parameters")).writeDataSet("perplexity","Float64",[],(0,k.Z)(this,ac).perplexity),n.writeDataSet("iterations","Int32",[],(0,k.Z)(this,ac).iterations),n.writeDataSet("animate","Uint8",[],Number((0,k.Z)(this,ac).animate)),e.next=7,_(this,dc,mc).call(this,!1);case 7:return i=e.sent,(a=r.createGroup("results")).writeDataSet("x","Float64",null,i.x),a.writeDataSet("y","Float64",null,i.y),e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(){return null!==(0,k.Z)(this,oc)?((0,A.Z)(this,oc,null),_(this,fc,pc).call(this,(0,k.Z)(this,ac).perplexity,(0,k.Z)(this,ac).iterations,!0,!0),(0,k.Z)(this,hc).then((function(e){return{type:"tsne_rerun",data:{status:"SUCCESS"}}}))):$l((0,k.Z)(this,uc),{cmd:"RERUN"},(0,k.Z)(this,sc))}}]),e}();function pc(e,t,r,n){var i=null;if(n){var a=Et(e);i=Kl((0,k.Z)(this,ic),a)}var s={perplexity:e,iterations:t,animate:r};(0,A.Z)(this,hc,nc((0,k.Z)(this,uc),s,i,(0,k.Z)(this,sc)))}function mc(e){return gc.apply(this,arguments)}function gc(){return(gc=(0,f.Z)(x.mark((function e(t){var r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,k.Z)(this,oc)){e.next=7;break}return r={x:(0,k.Z)(this,oc).x,y:(0,k.Z)(this,oc).y},t&&(r.x=r.x.slice(),r.y=r.y.slice()),r.iterations=(0,k.Z)(this,ac).iterations,e.abrupt("return",r);case 7:return e.next=9,(0,k.Z)(this,hc);case 9:return e.abrupt("return",$l((0,k.Z)(this,uc),{cmd:"FETCH"},(0,k.Z)(this,sc)));case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function bc(e,t){var r,n,i=e.open("tsne"),a=i.open("parameters");r={perplexity:a.open("perplexity",{load:!0}).values[0],iterations:a.open("iterations",{load:!0}).values[0],animate:a.open("animate",{load:!0}).values[0]>0};var s=i.open("results");return n={x:s.open("x",{load:!0}).values,y:s.open("y",{load:!0}).values},new vc(t,r,n)}var wc=new WeakMap,yc=new WeakMap,_c=new WeakMap,Zc=new WeakMap,kc=new WeakMap,Ac=new WeakMap,xc=new WeakMap,Ec=new WeakMap,Sc=new WeakSet,Ic=new WeakSet,Oc=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,m.Z)(this,e),w(this,Ic),w(this,Sc),(0,y.Z)(this,wc,{writable:!0,value:void 0}),(0,y.Z)(this,yc,{writable:!0,value:void 0}),(0,y.Z)(this,_c,{writable:!0,value:void 0}),(0,y.Z)(this,Zc,{writable:!0,value:void 0}),(0,y.Z)(this,kc,{writable:!0,value:void 0}),(0,y.Z)(this,Ac,{writable:!0,value:void 0}),(0,y.Z)(this,xc,{writable:!0,value:void 0}),(0,y.Z)(this,Ec,{writable:!0,value:void 0}),!(t instanceof Fu))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,A.Z)(this,wc,t),(0,A.Z)(this,yc,null===r?{}:r),(0,A.Z)(this,_c,{counter:0,promises:{}}),(0,A.Z)(this,Zc,n),this.changed=!1;var i=Vl(),a=tc(i,(0,k.Z)(this,_c),Xl),s=a.worker_id,o=a.ready;(0,A.Z)(this,kc,i),(0,A.Z)(this,Ac,s),(0,A.Z)(this,xc,o),(0,A.Z)(this,Ec,null)}return(0,g.Z)(e,[{key:"ready",value:function(){return(0,k.Z)(this,xc)}},{key:"free",value:function(){return rc((0,k.Z)(this,Ac))}},{key:"fetchParameters",value:function(){return p({},(0,k.Z)(this,yc))}},{key:"compute",value:function(e,t,r,n){var i=!(0,k.Z)(this,wc).changed&&(0,k.Z)(this,yc).num_neighbors===e;return i&&t===(0,k.Z)(this,yc).num_epochs&&r===(0,k.Z)(this,yc).min_dist?(this.changed=!1,new Promise((function(e){return e(null)}))):(null!==(0,k.Z)(this,Zc)&&(i=!1,(0,A.Z)(this,Zc,null)),_(this,Sc,Cc).call(this,e,t,r,n,!i),(0,k.Z)(this,yc).num_neighbors=e,(0,k.Z)(this,yc).num_epochs=t,(0,k.Z)(this,yc).min_dist=r,(0,k.Z)(this,yc).animate=n,this.changed=!0,(0,k.Z)(this,Ec))}},{key:"summary",value:function(){return _(this,Ic,Rc).call(this,!0)}},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){var r,n,i,a;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("umap"),(n=r.createGroup("parameters")).writeDataSet("num_neighbors","Int32",[],(0,k.Z)(this,yc).num_neighbors),n.writeDataSet("num_epochs","Int32",[],(0,k.Z)(this,yc).num_epochs),n.writeDataSet("min_dist","Float64",[],(0,k.Z)(this,yc).min_dist),n.writeDataSet("animate","Uint8",[],Number((0,k.Z)(this,yc).animate)),e.next=8,_(this,Ic,Rc).call(this,!1);case 8:return i=e.sent,(a=r.createGroup("results")).writeDataSet("x","Float64",null,i.x),a.writeDataSet("y","Float64",null,i.y),e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(){return null!==(0,k.Z)(this,Zc)?((0,A.Z)(this,Zc,null),_(this,Sc,Cc).call(this,(0,k.Z)(this,yc).num_neighbors,(0,k.Z)(this,yc).num_epochs,(0,k.Z)(this,yc).min_dist,!0,!0),(0,k.Z)(this,Ec).then((function(e){return{type:"umap_rerun",data:{status:"SUCCESS"}}}))):$l((0,k.Z)(this,kc),{cmd:"RERUN"},(0,k.Z)(this,_c))}}]),e}();function Cc(e,t,r,n,i){var a=null;i&&(a=Kl((0,k.Z)(this,wc),e));var s={num_neighbors:e,num_epochs:t,min_dist:r,animate:n};(0,A.Z)(this,Ec,nc((0,k.Z)(this,kc),s,a,(0,k.Z)(this,_c)))}function Rc(e){return Dc.apply(this,arguments)}function Dc(){return(Dc=(0,f.Z)(x.mark((function e(t){var r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,k.Z)(this,Zc)){e.next=7;break}return r={x:(0,k.Z)(this,Zc).x,y:(0,k.Z)(this,Zc).y},t&&(r.x=r.x.slice(),r.y=r.y.slice()),r.iterations=(0,k.Z)(this,yc).num_epochs,e.abrupt("return",r);case 7:return e.next=9,(0,k.Z)(this,Ec);case 9:return e.abrupt("return",$l((0,k.Z)(this,kc),{cmd:"FETCH"},(0,k.Z)(this,_c)));case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Bc(e,t){var r,n,i=e.open("umap"),a=i.open("parameters");r={num_neighbors:a.open("num_neighbors",{load:!0}).values[0],num_epochs:a.open("num_epochs",{load:!0}).values[0],min_dist:a.open("min_dist",{load:!0}).values[0],animate:a.open("animate",{load:!0}).values[0]>0};var s=i.open("results");return n={x:s.open("x",{load:!0}).values,y:s.open("y",{load:!0}).values},new Oc(t,r,n)}var zc=function(){var e=(0,f.Z)(x.mark((function e(t){var r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("failed to fetch content at "+t+"("+r.status+")");case 5:return e.next=7,r.arrayBuffer();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fc="https://cors-proxy.aaron-lun.workers.dev",Nc="https://github.com/clusterfork/singlepp-references/releases/download/hs-latest",Mc="https://github.com/clusterfork/singlepp-references/releases/download/mm-latest",Gc={},Wc={},jc=new WeakMap,Tc=new WeakMap,Uc=new WeakMap,Qc=new WeakMap,qc=new WeakMap,Pc=new WeakMap,Lc=new WeakSet,Vc=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,m.Z)(this,e),w(this,Lc),(0,y.Z)(this,jc,{writable:!0,value:void 0}),(0,y.Z)(this,Tc,{writable:!0,value:void 0}),(0,y.Z)(this,Uc,{writable:!0,value:void 0}),(0,y.Z)(this,Qc,{writable:!0,value:void 0}),(0,y.Z)(this,qc,{writable:!0,value:void 0}),(0,y.Z)(this,Pc,{writable:!0,value:void 0}),!(t instanceof ws))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,A.Z)(this,jc,t),!(r instanceof El))throw new Error("'markers' should be a State object from './marker_detection.js'");(0,A.Z)(this,Tc,r),(0,A.Z)(this,Uc,null===n?{}:n),(0,A.Z)(this,Qc,null===i?{}:i),this.changed=!1,(0,A.Z)(this,qc,{}),(0,A.Z)(this,Pc,{})}return(0,g.Z)(e,[{key:"free",value:function(){Ht((0,k.Z)(this,Qc).buffer);for(var e=0,t=Object.entries((0,k.Z)(this,qc));e<t.length;e++){var r=(0,h.Z)(t[e],2);r[0];r[1].raw.free()}for(var n=0,i=Object.entries((0,k.Z)(this,Pc));n<i.length;n++){var a=(0,h.Z)(i[n],2);a[0];a[1].raw.free()}}},{key:"fetchParameters",value:function(){for(var e=p({},(0,k.Z)(this,Uc)),t=0,r=["human_references","mouse_references"];t<r.length;t++){var n=r[t];e[n]=e[n].slice()}return e}},{key:"compute",value:function(e,t){var r=this;if(!(0,k.Z)(this,jc).changed&&!(0,k.Z)(this,Tc).changed&&Jc(e,(0,k.Z)(this,Uc).human_references)&&Jc(t,(0,k.Z)(this,Uc).mouse_references))return this.changed=!1,new Promise((function(e){return e(null)}));if((0,k.Z)(this,jc).changed||!("features"in(0,k.Z)(this,Qc))){var n=function(e){for(var t=e.fetchGenes(),r=e.fetchGeneTypes(),n=null,i=null,a=0,s=Object.entries(r);a<s.length;a++){var o=(0,h.Z)(s[a],2),u=o[0],l=o[1];(null===i||l.confidence>i.confidence)&&(n=u,i=l)}return{features:t[n],details:i}}((0,k.Z)(this,jc));(0,k.Z)(this,Qc).features=n.features,(0,k.Z)(this,Qc).feature_details=n.details}var i=(0,k.Z)(this,Qc).feature_details.species;e=e.slice(),t=t.slice();var a={};if("human"==i){var s,u=(0,o.Z)(e);try{for(u.s();!(s=u.n()).done;){var l=s.value;a[l]=_(this,Lc,Hc).call(this,l,"human",(0,k.Z)(this,jc).changed)}}catch(bn){u.e(bn)}finally{u.f()}}else if("mouse"==i){var c,d=(0,o.Z)(t);try{for(d.s();!(c=d.n()).done;){var v=c.value;a[v]=_(this,Lc,Hc).call(this,v,"mouse",(0,k.Z)(this,jc).changed)}}catch(bn){d.e(bn)}finally{d.f()}}var p=(0,k.Z)(this,Qc).buffer,m=(0,k.Z)(this,Qc).features.length,g=(0,k.Z)(this,Tc).numberOfGroups();if((0,k.Z)(this,Tc).changed||"undefined"===typeof p){p=Xt(g*m,"Float64Array",(0,k.Z)(this,Qc));for(var b=0;b<g;b++){var w=(0,k.Z)(this,Tc).fetchGroupMeans(b,"RNA",{copy:!1});p.array().set(w,b*m)}}var y=[];(0,k.Z)(this,Qc).results={};for(var Z=0,A=Object.entries(a);Z<A.length;Z++){var E=(0,h.Z)(A[Z],2),O=E[0],C=E[1].then((function(e){var t,r=Ut(p,e.built.raw,{numberOfFeatures:m,numberOfCells:g}),n=[],i=(0,o.Z)(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.push(e.loaded.labels[a])}}catch(bn){i.e(bn)}finally{i.f()}return n}));(0,k.Z)(this,Qc).results[O]=C,y.push(C)}var R=Object.keys(a);if(R.length>1){if((0,k.Z)(this,jc).changed||!Jc(R,(0,k.Z)(this,Qc).used)||!("integrated"in(0,k.Z)(this,Qc))){var D=Object.values(a);(0,k.Z)(this,Qc).integrated=Promise.all(D).then((function(e){var t=e.map((function(e){return e.loaded.raw})),n=e.map((function(e){return e.built.features})),i=e.map((function(e){return e.built.raw}));return function(e,t,r,n){var i,a,s,o,u,l=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}).numberOfThreads,c=void 0===l?null:l,h=S.mV(c),f=t.length;if(r.length!=f)throw new Error("'loaded' and 'referenceFeatures' should be of the same length");if(n.length!=f)throw new Error("'loaded' and 'built' should be of the same length");for(var d=0;d<f;d++)if(t[d].numberOfFeatures()!=r[d].length)throw new Error("length of each 'referenceFeatures' should be equal to the number of features in the corresponding 'loaded'");var v=new Array(f);try{i=S.Wf(e.length);var p=Gt(e,i),m=(a=S.GF(f)).array();for(d=0;d<f;d++)m[d]=BigInt(t[d].reference.$$.ptr);var g=(s=S.GF(f)).array();for(d=0;d<f;d++){var b=r[d];b instanceof xe.do?g[d]=BigInt(b.offset):(v[d]=S.Wf(b.length),Wt(b,p,v[d]),g[d]=BigInt(v[d].offset))}var w=(o=S.GF(f)).array();for(d=0;d<f;d++)w[d]=BigInt(n[d].reference.$$.ptr);(u=I.R((function(t){return t.integrate_singlepp_references(e.length,i.offset,f,a.offset,s.offset,o.offset,h)}),Pt)).expectedNumberOfFeatures=e.length}catch(k){throw S.gd(u),k}finally{S.gd(i),S.gd(a),S.gd(o),S.gd(s);for(var y=0,_=v;y<_.length;y++){var Z=_[y];S.gd(Z)}}return u}((0,k.Z)(r,Qc).features,t,n,i)}))}var B=(0,k.Z)(this,Qc).integrated.then(function(){var e=(0,f.Z)(x.mark((function e(t){var n,i,a,s,u,l;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=(0,o.Z)(R),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=13;break}return s=a.value,e.t0=n,e.next=9,(0,k.Z)(r,Qc).results[s];case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),i.e(e.t2);case 18:return e.prev=18,i.f(),e.finish(18);case 21:return u=Lt(p,n,t,{numberOfFeatures:m,numberOfCells:g}),l=[],u.forEach((function(e){l.push(R[e])})),e.abrupt("return",l);case 25:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})));return function(t){return e.apply(this,arguments)}}());(0,k.Z)(this,Qc).integrated_results=B,y.push(B)}else delete(0,k.Z)(this,Qc).integrated_results;return(0,k.Z)(this,Qc).used=R,(0,k.Z)(this,Uc).human_references=e,(0,k.Z)(this,Uc).mouse_references=t,this.changed=!0,Promise.all(y).then((function(e){return null}))}},{key:"summary",value:function(){var e=(0,f.Z)(x.mark((function e(){var t,r,n,i,a,s,o;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},r=0,n=Object.entries((0,k.Z)(this,Qc).results);case 2:if(!(r<n.length)){e.next=10;break}return i=(0,h.Z)(n[r],2),a=i[0],s=i[1],e.next=6,s;case 6:t[a]=e.sent;case 7:r++,e.next=2;break;case 10:if(o={per_reference:t},!("integrated_results"in(0,k.Z)(this,Qc))){e.next=15;break}return e.next=14,(0,k.Z)(this,Qc).integrated_results;case 14:o.integrated=e.sent;case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){var e=(0,f.Z)(x.mark((function e(t){var r,n,i,a,s,o,u,l,c,f;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.createGroup("cell_labelling"),(n=r.createGroup("parameters")).writeDataSet("mouse_references","String",null,(0,k.Z)(this,Uc).mouse_references),n.writeDataSet("human_references","String",null,(0,k.Z)(this,Uc).human_references),i=r.createGroup("results"),e.next=7,this.summary();case 7:for(a=e.sent,s=i.createGroup("per_reference"),o=0,u=Object.entries(a.per_reference);o<u.length;o++)l=(0,h.Z)(u[o],2),c=l[0],f=l[1],s.writeDataSet(c,"String",null,f);return"integrated"in a&&i.writeDataSet("integrated","String",null,a.integrated),e.abrupt("return");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Hc(e,t,r){return Yc.apply(this,arguments)}function Yc(){return Yc=(0,f.Z)(x.mark((function e(t,r,n){var i,a,s,o,u,l,c,h,f,d,v,p,m;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("human"==r?(i=Nc,a=Gc,s=(0,k.Z)(this,qc)):(i=Mc,a=Wc,s=(0,k.Z)(this,Pc)),t in a){e.next=19;break}return e.next=4,Promise.all([zc(Fc+"/"+encodeURIComponent(i+"/"+t+"_genes.csv.gz")),zc(Fc+"/"+encodeURIComponent(i+"/"+t+"_labels_fine.csv.gz")),zc(Fc+"/"+encodeURIComponent(i+"/"+t+"_label_names_fine.csv.gz")),zc(Fc+"/"+encodeURIComponent(i+"/"+t+"_markers_fine.gmt.gz")),zc(Fc+"/"+encodeURIComponent(i+"/"+t+"_matrix.csv.gz"))]);case 4:o=e.sent,e.prev=5,u=zt(new Uint8Array(o[4]),new Uint8Array(o[3]),new Uint8Array(o[1])),l=oa(new Uint8Array(o[0]),{compression:"gz"}),c=[],h=[],l.forEach((function(e){var t=e.split(",");c.push(t[0]),h.push(t[1])})),f=oa(new Uint8Array(o[2]),{compression:"gz"}),a[t]={raw:u,genes:{ensembl:c,symbol:h},labels:f},e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(5),Ht(u),e.t0;case 19:if(t in s&&!n){e.next=33;break}e.prev=20,t in s&&Ht(s[t].raw),d=a[t],v=d.raw,p="ensembl"===(0,k.Z)(this,Qc).feature_details.type?d.genes.ensembl:d.genes.symbol,m=jt((0,k.Z)(this,Qc).features,v,p),s[t]={features:p,raw:m},e.next=33;break;case 29:throw e.prev=29,e.t1=e.catch(20),Ht(undefined),e.t1;case 33:return e.abrupt("return",{loaded:a[t],built:s[t]});case 34:case"end":return e.stop()}}),e,this,[[5,15],[20,29]])}))),Yc.apply(this,arguments)}function Jc(e,t){if("undefined"===typeof e||"undefined"===typeof t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function Xc(e,t,r){var n={mouse_references:[],human_references:[]},i={results:{}};if("cell_labelling"in e.children){var a=e.open("cell_labelling"),s=a.open("parameters");n.mouse_references=s.open("mouse_references",{load:!0}).values,n.human_references=s.open("human_references",{load:!0}).values;for(var o=a.open("results"),u=o.open("per_reference"),l=0,c=Object.keys(u.children);l<c.length;l++){var h=c[l];i.results[h]=u.open(h,{load:!0}).values}"integrated"in o.children&&(i.integrated_results=o.open("integrated",{load:!0}).values)}return new Vc(t,r,n,i)}function Kc(e){var t=zc;return zc=e,t}var $c=ds,eh=Ts,th=Ks,rh=lo,nh=Ao,ih=Bo,ah="feature_selection",sh=tu,oh=cu,uh="combine_embeddings",lh="batch_correction",ch=Cu,hh="tsne",fh="umap",dh="kmeans_cluster",vh="snn_graph_cluster",ph="choose_clustering",mh=yl,gh="cell_labelling",bh=Ol;function wh(){return yh.apply(this,arguments)}function yh(){return(yh=(0,f.Z)(x.mark((function e(){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_h(new ws));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _h(e){var t={};t.inputs=e,t[eh]=new Vs(t.inputs),t[th]=new io(t.inputs),t[rh]=new bo(t.inputs,{RNA:t[eh],ADT:t[th]}),t[nh]=new Co(t[eh],t[rh]),t[ih]=new Wo(t[th],t[rh]),t[ah]=new Xo(t[rh],t[nh]),t.pca=new ou(t[rh],t[nh],t[ah]),t.adt_pca=new pu(t[rh],t[ih]),t[uh]=new _u({RNA:t.pca,ADT:t.adt_pca}),t[lh]=new Iu(t[rh],t[uh]),t.neighbor_index=new Fu(t[lh]),t.tsne=new vc(t.neighbor_index),t.umap=new Oc(t.neighbor_index),t[dh]=new cl(t[lh]),t[vh]=new $u(t.neighbor_index),t[ph]=new bl(t[vh],t[dh]);var r={RNA:t[nh],ADT:t[ih]};return t[mh]=new El(t[rh],r,t[ph]),t[gh]=new Vc(t.inputs,t[mh]),t[bh]=new Fl(t[rh],r),Promise.all([t.tsne.ready(),t.umap.ready()]).then((function(e){return t}))}function Zh(e){for(var t=[],r=0,n=Object.entries(e);r<n.length;r++){var i=(0,h.Z)(n[r],2),a=(i[0],i[1].free());a&&t.push(a)}return Promise.all(t).then((function(e){return null}))}function kh(e,t,r){return Ah.apply(this,arguments)}function Ah(){return Ah=(0,f.Z)(x.mark((function e(t,r,n){var i,a,s,o,u,l,c,h,f,d,v,p,m,g=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=g.length>3&&void 0!==g[3]?g[3]:{},a=i.startFun,s=void 0===a?null:a,o=i.finishFun,u=void 0===o?null:o,c=function(e){null!==u&&(t[e].changed?u(e,t[e].summary()):u(e))},h=[],f=function(e,r){null!==u&&(r=t[e].changed?t[e].summary().then((function(t){return u(e,t)})):r.then((function(t){return u(e)}))),h.push(r)},(l=function(e){null!==s&&s(e)})($c),e.next=8,t.inputs.compute(r,n.inputs.sample_factor,n.inputs.subset);case 8:return c($c),l(eh),t[eh].compute(n[eh].skip,n[eh].use_mito_default,n[eh].mito_prefix,n[eh].nmads),c(eh),l(th),t[th].compute(n[th].skip,n[th].igg_prefix,n[th].nmads,n[th].min_detected_drop),c(th),l(rh),t[rh].compute(),c(rh),l(nh),t[nh].compute(),c(nh),l(ih),t[ih].compute(n[ih].num_pcs,n[ih].num_clusters),c(ih),l(ah),t[ah].compute(n[ah].span),c(ah),l(sh),t.pca.compute(n.pca.num_hvgs,n.pca.num_pcs,n.pca.block_method),c(sh),l(oh),t.adt_pca.compute(n.adt_pca.num_pcs,n.adt_pca.block_method),c(oh),l(uh),t[uh].compute(n[uh].weights,n[uh].approximate),c(uh),l(lh),t[lh].compute(n[lh].method,n[lh].num_neighbors,n[lh].approximate),c(lh),l(ch),t.neighbor_index.compute(n.neighbor_index.approximate),c(ch),l(hh),d=t.tsne.compute(n.tsne.perplexity,n.tsne.iterations,n.tsne.animate),f(hh,d),l(fh),v=t.umap.compute(n.umap.num_neighbors,n.umap.num_epochs,n.umap.min_dist,n.umap.animate),f(fh,v),p=n[ph].method,l(dh),t[dh].compute("kmeans"==p,n[dh].k),c(dh),l(vh),t[vh].compute("snn_graph"==p,n[vh].k,n[vh].scheme,n[vh].resolution),c(vh),l(ph),t[ph].compute(p),c(ph),l(mh),t[mh].compute(),c(mh),l(gh),m=t[gh].compute(n[gh].human_references,n[gh].mouse_references),f(gh,m),t[bh].compute(),c(bh),e.next=68,Promise.all(h);case 68:return e.abrupt("return",null);case 69:case"end":return e.stop()}}),e)}))),Ah.apply(this,arguments)}function xh(e,t){return Eh.apply(this,arguments)}function Eh(){return Eh=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s,o,u=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:{},i=n.embedded,a=null,s=null,(void 0===i||i)&&(s={collected:[],total:0},a=function(e,t){s.collected.push(e);var r=s.total;return s.total+=t,{offset:r,size:t}}),o=te(r),e.next=7,t.inputs.serialize(o,a);case 7:return t[eh].serialize(o),t[th].serialize(o),t[rh].serialize(o),t[nh].serialize(o),t[ih].serialize(o),t[ah].serialize(o),t.pca.serialize(o),t.adt_pca.serialize(o),t[uh].serialize(o),t[lh].serialize(o),t.neighbor_index.serialize(o),e.next=20,t.tsne.serialize(o);case 20:return e.next=22,t.umap.serialize(o);case 22:return t[dh].serialize(o),t[vh].serialize(o),t[ph].serialize(o),t[mh].serialize(o),e.next=28,t[gh].serialize(o);case 28:return t[bh].serialize(o),e.abrupt("return",s);case 30:case"end":return e.stop()}}),e)}))),Eh.apply(this,arguments)}function Sh(e,t){return Ih.apply(this,arguments)}function Ih(){return Ih=(0,f.Z)(x.mark((function e(t,r){var n,i,a,s,o,u,l,c,h,f=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>2&&void 0!==f[2]?f[2]:{},i=n.finishFun,a=void 0===i?null:i,s={},o=new ee(t),u=function(e){null!==a&&a(e,s[e].summary())},e.next=6,Fs(o,r);case 6:if(c=e.sent,s.inputs=c.state,l=c.permuters,u($c),s[eh]=Xs(o,s.inputs),u(eh),s[th]=uo(o,s.inputs),u(th),s[rh]=_o(o,s.inputs,{RNA:s[eh],ADT:s[th]}),u(rh),s[nh]=Do(0,s[eh],s[rh]),u(nh),s[ih]=To(o,s[th],s[rh]),u(ih),s[ah]=eu(o,l.RNA,s[rh],s[nh]),u(ah),s.pca=lu(o,s[rh],s[nh],s[ah]),u(sh),s.adt_pca=mu(o,s[rh],s[ih]),u(oh),s[uh]=Zu(o,{RNA:s.pca,ADT:s.adt_pca}),u(uh),s[lh]=Ou(o,s[rh],s[uh]),u(lh),s.neighbor_index=Mu(o,s[lh]),u(ch),s.tsne=bc(o,s.neighbor_index),null===a){e.next=40;break}return e.t0=a,e.t1=hh,e.next=38,s.tsne.summary();case 38:e.t2=e.sent,(0,e.t0)(e.t1,e.t2);case 40:if(s.umap=Bc(o,s.neighbor_index),null===a){e.next=48;break}return e.t3=a,e.t4=fh,e.next=46,s.umap.summary();case 46:e.t5=e.sent,(0,e.t3)(e.t4,e.t5);case 48:if(s[dh]=dl(o,s[lh]),u(dh),s[vh]=al(o,s.neighbor_index),u(vh),s[ph]=wl(o,s[vh],s[dh]),u(ph),h={RNA:s[nh],ADT:s[ih]},s[mh]=Il(o,l,s[rh],h,s[ph]),u(mh),s[gh]=Xc(o,s.inputs,s[mh]),null===a){e.next=65;break}return e.t6=a,e.t7=gh,e.next=63,s[gh].summary();case 63:e.t8=e.sent,(0,e.t6)(e.t7,e.t8);case 65:return s[bh]=Gl(o,l,s[rh],h),u(bh),e.abrupt("return",s);case 68:case"end":return e.stop()}}),e)}))),Ih.apply(this,arguments)}function Oh(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var i=(0,h.Z)(n[r],2),a=i[0],s=i[1];t[a]=s.fetchParameters()}return t}function Ch(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t]=Ch(e[t]);else if(e instanceof Object)if("_TypedArray_class"in e){var r=e[["_TypedArray_class"]],n=e[["_TypedArray_values"]];switch(r){case"Uint8Array":case"Uint8Array":e=new Uint8Array(n.length);break;case"Int8Array":e=new Int8Array(n.length);break;case"Uint16Array":e=new Uint16Array(n.length);break;case"Int16Array":e=new Int16Array(n.length);break;case"Uint32Array":e=new Uint32Array(n.length);break;case"Int32Array":e=new Int32Array(n.length);break;case"Uint64Array":e=new Uint64Array(n.length);break;case"Int64Array":e=new Int64Array(n.length);break;case"Float32Array":e=new Float32Array(n.length);break;case"Float64Array":e=new Float64Array(n.length);break;default:throw"unrecognized TypedArray class '"+r}e.set(n)}else for(var i=0,a=Object.entries(e);i<a.length;i++){var s=(0,h.Z)(a[i],2),o=s[0],u=s[1];e[o]=Ch(u)}return e}var Rh=2001e3;function Dh(e){for(var t=new Uint8Array(8),r=0;e>0;)t[r]=e%256,e=Math.floor(e/256),r++;return t}function Bh(e){var t,r=0,n=1,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){r+=n*t.value,n*=256}}catch(bn){i.e(bn)}finally{i.f()}return r}function zh(e,t){var r=null!==t,n=E.pJ(e),i=function(e,t){var r=new ArrayBuffer(24),n=new Uint8Array(r),i=0,a=Dh(e?0:1);n.set(a,i),i+=a.length;var s=Dh(Rh);n.set(s,i),i+=s.length;var o=Dh(t);if(n.set(o,i),24!=(i+=o.length))throw"oops - accounting error in the serialization code!";return r}(r,n.byteLength),a=i.byteLength+n.byteLength;if(r){var s,u=(0,o.Z)(t);try{for(u.s();!(s=u.n()).done;){a+=s.value.byteLength}}catch(bn){u.e(bn)}finally{u.f()}}var l=new ArrayBuffer(a),c=new Uint8Array(l);c.set(new Uint8Array(i));var h=i.byteLength;if(c.set(new Uint8Array(n),h),h+=n.byteLength,r){var f,d=(0,o.Z)(t);try{for(d.s();!(f=d.n()).done;){var v=f.value;c.set(new Uint8Array(v),h),h+=v.byteLength}}catch(bn){d.e(bn)}finally{d.f()}}return l}function Fh(e,t){var r=function(e){var t=0,r=Bh(new Uint8Array(e,t,8));t+=8;var n=Bh(new Uint8Array(e,t,8));return t+=8,{embedded:0==r,version:n,state:Bh(new Uint8Array(e,t,8)),offset:t+=8}}(e),n=r.offset+r.state,i=e.slice(r.offset,n);if(r.version<1e6){var a=Ji(new Uint8Array(i),{to:"string"});!function(e,t){var r=te(t),n=r.createGroup("inputs"),i=e.inputs.parameters,a=n.createGroup("parameters");a.writeDataSet("format","String",[],i.type);var s,u=a.createGroup("files"),l=(0,o.Z)(i.files.entries());try{for(l.s();!(s=l.n()).done;){var c=(0,h.Z)(s.value,2),f=c[0],d=c[1],v=u.createGroup(String(f));v.writeDataSet("type","String",[],d.type),v.writeDataSet("name","String",[],d.name),d.buffer instanceof Object?(v.writeDataSet("offset","Uint32",[],d.buffer.offset),v.writeDataSet("size","Uint32",[],d.buffer.size)):v.writeDataSet("id","String",[],d.buffer)}}catch(bn){l.e(bn)}finally{l.f()}var p=n.createGroup("results"),m=e.inputs.contents,g=Object.values(m.genes)[0].length;p.writeDataSet("dimensions","Int32",null,[g,m.num_cells]);for(var b=p.createGroup("genes"),w=0,y=Object.entries(m.genes);w<y.length;w++){var _=(0,h.Z)(y[w],2),Z=_[0],k=_[1];b.writeDataSet(Z,"String",null,k)}var A=r.createGroup("quality_control"),x=A.createGroup("parameters"),E=e.quality_control_metrics.parameters;x.writeDataSet("use_mito_default","Uint8",[],Number(E.use_mito_default)),x.writeDataSet("mito_prefix","String",[],E.mito_prefix);var S=e.quality_control_thresholds.parameters;x.writeDataSet("nmads","Float64",[],S.nmads);var I=A.createGroup("results"),O=I.createGroup("metrics"),C=Ch(e.quality_control_metrics.contents);O.writeDataSet("sums","Float64",null,C.sums),O.writeDataSet("detected","Int32",null,C.detected),O.writeDataSet("proportion","Float64",null,C.proportion);for(var R=I.createGroup("thresholds"),D=Ch(e.quality_control_thresholds.contents),B=0,z=["sums","detected","proportion"];B<z.length;B++){var F=z[B];R.writeDataSet(F,"Float64",null,[D[F]])}var N=D.discards;I.writeDataSet("discards","Uint8",null,N);var M=r.createGroup("normalization");M.createGroup("parameters"),M.createGroup("results");var G=r.createGroup("feature_selection");G.createGroup("parameters").writeDataSet("span","Float64",[],e.feature_selection.parameters.span);for(var W=G.createGroup("results"),j=Ch(e.feature_selection.contents),T=0,U=["means","vars","fitted","resids"];T<U.length;T++){var Q=U[T];W.writeDataSet(Q,"Float64",null,j[Q])}for(var q=r.createGroup("pca"),P=q.createGroup("parameters"),L=e.pca.parameters,V=0,H=["num_hvgs","num_pcs"];V<H.length;V++){var Y=H[V];P.writeDataSet(Y,"Int32",null,L[Y])}var J=q.createGroup("results"),X=Ch(e.pca.contents),K=X.var_exp;J.writeDataSet("var_exp","Float64",null,K);var $=K.length,ee=X.pcs.length/$;J.writeDataSet("pcs","Float64",[ee,$],X.pcs);var re=r.createGroup("neighbor_index"),ne=re.createGroup("parameters"),ie=e.pca.parameters;ne.writeDataSet("approximate","Uint8",[],Number(ie.approximate)),re.createGroup("results");var ae=r.createGroup("tsne"),se=ae.createGroup("parameters"),oe=e.tsne.parameters;se.writeDataSet("perplexity","Float64",[],oe.perplexity),se.writeDataSet("iterations","Int32",[],oe.iterations),se.writeDataSet("animate","Uint8",[],oe.animate);var ue=ae.createGroup("results"),le=Ch(e.tsne.contents);ue.writeDataSet("x","Float64",null,le.x),ue.writeDataSet("y","Float64",null,le.y);var ce=r.createGroup("umap"),he=ce.createGroup("parameters"),fe=e.umap.parameters;he.writeDataSet("num_neighbors","Int32",[],fe.num_neighbors),he.writeDataSet("num_epochs","Int32",[],fe.num_epochs),he.writeDataSet("min_dist","Float64",[],fe.min_dist),he.writeDataSet("animate","Uint8",[],Number(fe.animate));var de=ce.createGroup("results"),ve=Ch(e.umap.contents);de.writeDataSet("x","Float64",null,ve.x),de.writeDataSet("y","Float64",null,ve.y);var pe=r.createGroup("kmeans_cluster"),me=pe.createGroup("parameters").createDataSet("k","Int32",[]);if("kmeans_cluster"in e){var ge=e.kmeans_cluster.parameters;me.write(ge.k)}else me.write(10);var be=pe.createGroup("results"),we=Ch(e.kmeans_cluster.contents);"kmeans_cluster"in e&&be.writeDataSet("clusters","Int32",null,we.clusters);var ye=r.createGroup("snn_graph_cluster"),_e=ye.createGroup("parameters"),Ze=e.snn_find_neighbors.parameters;_e.writeDataSet("k","Int32",[],Ze.k);var ke=e.snn_build_graph.parameters;_e.writeDataSet("scheme","String",[],["rank","number","jaccard"][ke.scheme]);var Ae=e.snn_cluster_graph.parameters;_e.writeDataSet("resolution","Float64",[],Ae.resolution);var xe=ye.createGroup("results"),Ee=Ch(e.snn_cluster_graph.contents);xe.writeDataSet("clusters","Int32",null,Ee.clusters),r.createGroup("choose_clustering").createGroup("parameters").writeDataSet("method","String",[],e.choose_clustering.parameters.method);var Se=r.createGroup("marker_detection");Se.createGroup("parameters");var Ie,Oe=Se.createGroup("results").createGroup("clusters"),Ce=e.marker_detection.contents,Re=(0,o.Z)(Ce.entries());try{for(Re.s();!(Ie=Re.n()).done;){for(var De=(0,h.Z)(Ie.value,2),Be=De[0],ze=De[1],Fe=Oe.createGroup(String(Be)),Ne=Ch(ze),Me=0,Ge=["means","detected"];Me<Ge.length;Me++){var We=Ge[Me];Fe.writeDataSet(We,"Float64",null,Ne[We])}for(var je=0,Te=["lfc","delta_detected","auc","cohen"];je<Te.length;je++)for(var Ue=Te[je],Qe=Ne[Ue],qe=Fe.createGroup(Ue),Pe=0,Le=["min","mean","min-rank"];Pe<Le.length;Pe++){var Ve=Le[Pe],He="min-rank"==Ve?"min_rank":Ve;qe.writeDataSet(He,"Float64",null,Qe[Ve])}}}catch(bn){Re.e(bn)}finally{Re.f()}for(var Ye=r.createGroup("custom_selections"),Je=Ye.createGroup("parameters").createGroup("selections"),Xe=e.custom_marker_management.parameters,Ke=0,$e=Object.entries(Xe.selections);Ke<$e.length;Ke++){var et=(0,h.Z)($e[Ke],2),tt=et[0],rt=et[1];Je.writeDataSet(String(tt),"Int32",null,rt)}for(var nt=Ye.createGroup("results").createGroup("markers"),it=0,at=Object.entries(e.custom_marker_management.contents.results);it<at.length;it++){for(var st=(0,h.Z)(at[it],2),ot=st[0],ut=st[1],lt=nt.createGroup(String(ot)),ct=Ch(ut),ht=0,ft=["means","detected"];ht<ft.length;ht++){var dt=ft[ht];lt.writeDataSet(dt,"Float64",null,ct[dt])}for(var vt=0,pt=["lfc","delta_detected","auc","cohen"];vt<pt.length;vt++){var mt=pt[vt];lt.writeDataSet(mt,"Float64",null,ct[mt].mean)}}}(JSON.parse(a),t)}else E.NC(t,new Uint8Array(i));return r.embedded?function(t,r){return e.slice(n+t,n+t+r)}:null}function Nh(e,t){return zh(e,t)}function Mh(e,t){return Fh(e,t)}function Gh(e){na(e,{allowed:!0})}function Wh(e){return jh.apply(this,arguments)}function jh(){return(jh=(0,f.Z)(x.mark((function e(t){var r,n,i,a,s,u,l,c,f,d,v,p,m,g,b,w,y,_,Z,k,A,E,S,I,O,C,R,D,B,z,F,N,M,G,W,j,T,U,Q,q,P;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Object.keys(t),n=r.length>1,i=[],a=0,s=r;a<s.length;a++)u=s[a],l=t[u],c=hs(l.format),i.push(c.preflight(l));return e.next=6,Promise.all(i);case 6:f=e.sent,d={},v={},p=0,m=Object.entries(r);case 10:if(!(p<m.length)){e.next=23;break}if(g=(0,h.Z)(m[p],2),b=g[0],w=g[1],null===(y=f[b]).genes){e.next=17;break}d[w]=y.genes,e.next=19;break;case 17:if(!n){e.next=19;break}throw new Error("cannot find gene annotations for matrix '"+w+"'");case 19:v[w]=y.annotations;case 20:p++,e.next=10;break;case 23:for(_=null,Z=0,k=Object.entries(d);Z<k.length;Z++)A=(0,h.Z)(k[Z],2),A[0],E=A[1],null==_?_=new Set(Object.keys(E)):(S=Object.keys(E).filter((function(e){return _.has(e)})),_=new Set(S));if(I={},null===_){e.next=52;break}O=(0,o.Z)(_),e.prev=28,O.s();case 30:if((C=O.n()).done){e.next=42;break}for(R=C.value,I[R]={},D={},B=0,z=Object.entries(d);B<z.length;B++)F=(0,h.Z)(z[B],2),N=F[0],M=F[1],D[N]=M[R];if(null!==(G=Zs(D)).best_type){e.next=38;break}throw new Error("cannot find common feature types across all matrices");case 38:if(I[R].fields=G.best_fields,n){for(W=null,j=0,T=Object.entries(G.best_fields);j<T.length;j++)U=(0,h.Z)(T[j],2),Q=U[0],q=U[1],P=D[Q][q],null===W?W=P:function(){var e=new Set(P);W=W.filter((function(t){return e.has(t)}))}();I[R].common=W.length}else I[R].common=Object.values(Object.values(D)[0])[0].length;case 40:e.next=30;break;case 42:e.next=47;break;case 44:e.prev=44,e.t0=e.catch(28),O.e(e.t0);case 47:return e.prev=47,O.f(),e.finish(47);case 50:e.next=53;break;case 52:I.RNA={common:null,fields:null};case 53:return e.abrupt("return",{annotations:v,features:I});case 54:case"end":return e.stop()}}),e,null,[[28,44,47,50]])})))).apply(this,arguments)}function Th(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.numberOfThreads,r=void 0===t?1:t,n=e.localFile,i=void 0!==n&&n,a=E.j2({numberOfThreads:r,localFile:i});return Xl.localFile=i,a.then((function(e){return null}))}},2306:function(e,t,r){"use strict";r.d(t,{p:function(){return f}});var n=r(5671),i=r(3144),a=r(2346),s=r(6033),o=r(3092),u=r(6635),l=r(2979),c=new WeakMap,h=new WeakMap,f=function(){function e(t,r){(0,n.Z)(this,e),(0,a.Z)(this,c,{writable:!0,value:void 0}),(0,a.Z)(this,h,{writable:!0,value:void 0}),(0,o.Z)(this,c,t),(0,o.Z)(this,h,r)}return(0,i.Z)(e,[{key:"clone",value:function(){var t=this;return l.R((function(e){return(0,s.Z)(t,h).clone()}),e)}},{key:"matrix",get:function(){return(0,s.Z)(this,h)}},{key:"numberOfRows",value:function(){return(0,s.Z)(this,h).nrow()}},{key:"numberOfColumns",value:function(){return(0,s.Z)(this,h).ncol()}},{key:"row",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.buffer,i=void 0===n?null:n;if(null!=i)return(0,s.Z)(this,h).row(e,i.offset),i.array();i=u.RJ((0,s.Z)(this,h).ncol());try{(0,s.Z)(this,h).row(e,i.offset),t=i.slice()}finally{i.free()}return t}},{key:"column",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.buffer,i=void 0===n?null:n;if(null!=i)return(0,s.Z)(this,h).column(e,i.offset),i.array();i=u.RJ((0,s.Z)(this,h).nrow());try{(0,s.Z)(this,h).column(e,i.offset),t=i.slice()}finally{i.free()}return t}},{key:"free",value:function(){null!==(0,s.Z)(this,h)&&(l.A((0,s.Z)(this,c)),(0,o.Z)(this,h,null))}},{key:"isSparse",value:function(){return(0,s.Z)(this,h).sparse()}},{key:"isReorganized",value:function(){return(0,s.Z)(this,h).reorganized()}},{key:"isPermuted",value:function(){return this.isReorganized()}},{key:"identities",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.buffer,n=void 0===r?null:r;if(null!=n)return(0,s.Z)(this,h).identities(n.offset),n.array();n=u.Wf((0,s.Z)(this,h).nrow());try{(0,s.Z)(this,h).identities(n.offset),e=n.slice()}finally{n.free()}return e}},{key:"wipeIdentities",value:function(){(0,s.Z)(this,h).wipe_identities()}}]),e}()},4812:function(e,t,r){"use strict";r.d(t,{r:function(){return d}});var n=r(5671),i=r(3144),a=r(2346),s=r(6033),o=r(3092),u=r(2979),l=r(6635),c=new WeakMap,h=new WeakMap,f=function(){function e(t,r){(0,n.Z)(this,e),(0,a.Z)(this,c,{writable:!0,value:void 0}),(0,a.Z)(this,h,{writable:!0,value:void 0}),(0,o.Z)(this,c,t),(0,o.Z)(this,h,r)}return(0,i.Z)(e,[{key:"means",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,i=void 0===n||n;return l.Yj((0,s.Z)(this,h).means(r),i)}},{key:"variances",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,i=void 0===n||n;return l.Yj((0,s.Z)(this,h).variances(r),i)}},{key:"fitted",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,i=void 0===n||n;return l.Yj((0,s.Z)(this,h).fitted(r),i)}},{key:"residuals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.block,r=void 0===t?-1:t,n=e.copy,i=void 0===n||n;return l.Yj((0,s.Z)(this,h).residuals(r),i)}},{key:"numberOfBlocks",value:function(){return(0,s.Z)(this,h).num_blocks()}},{key:"free",value:function(){null!==(0,s.Z)(this,h)&&(u.A((0,s.Z)(this,c)),(0,o.Z)(this,h,null))}}]),e}();function d(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.block,a=void 0===i?null:i,s=n.span,o=void 0===s?.3:s,c=n.numberOfThreads,h=void 0===c?null:c,d=l.mV(h);try{var v=0,p=!1;if(null!==a){if((t=l.de(a,"Int32WasmArray")).length!=e.numberOfColumns())throw new Error("'block' must be of length equal to the number of columns in 'x'");p=!0,v=t.offset}r=u.R((function(t){return t.model_gene_var(e.matrix,p,v,o,d)}),f)}catch(m){throw l.gd(r),m}finally{l.gd(t)}return r}},6635:function(e,t,r){"use strict";r.d(t,{TS:function(){return a},Wf:function(){return s},GF:function(){return o},RJ:function(){return u},de:function(){return l},mV:function(){return c},gd:function(){return h},ek:function(){return f},Yj:function(){return d},c2:function(){return v}});var n=r(8782),i=r(6737);function a(e){return i.TS((0,n.Fx)(),e)}function s(e){return i.Wf((0,n.Fx)(),e)}function o(e){return i.GF((0,n.Fx)(),e)}function u(e){return i.RJ((0,n.Fx)(),e)}function l(e,t){if(e instanceof i.PQ){if(null!==t&&t!=e.constructor.className)throw new Error("expected '"+t+"', got '"+e.constructor.className+"'");return e.space===(0,n.Fx)()?null===e.owner?e.view():e:e.clone((0,n.Fx)())}return null!==t?i.Zv((0,n.Fx)(),e,i.rr(t)):i.Zv((0,n.Fx)(),e)}function c(e){return null==e?(0,n.TT)():e}function h(e){if("undefined"!=typeof e&&null!=e)return e.free()}function f(e){return h(e)}function d(e,t){if("view"===t){if(e.buffer!==(0,n.f3)())throw new Error('cannot use copy = "view" for non-Wasm TypedArrays');var r=e.constructor.name.replace("Array","WasmArray");return i.dt((0,n.Fx)(),e.length,e.byteOffset,i.rr(r))}return t?e.slice():e}function v(e,t,r){if(-1==r.indexOf(t))throw new Error("'"+e+"=' should be one of '"+r.join("', '")+"'")}},8782:function(e,t,r){"use strict";r.d(t,{j2:function(){return u},TT:function(){return c},RE:function(){return h},f3:function(){return f},Fx:function(){return d},NC:function(){return v},pJ:function(){return p},Yd:function(){return m},ki:function(){return g}});var n=r(5861),i=r(7757),a=r(8308),s=r(6737),o={};function u(){return l.apply(this,arguments)}function l(){return l=(0,n.Z)(i.mark((function e(){var t,r,n,u,l,c=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:{},r=t.numberOfThreads,n=void 0===r?4:r,u=t.localFile,void 0!==u&&u,!("module"in o)){e.next=3;break}return e.abrupt("return",!1);case 3:return l={scran_custom_nthreads:n},e.next=6,(0,a.default)(l);case 6:return o.module=e.sent,o.space=(0,s.z2)(o.module),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function c(){return o.module.scran_custom_nthreads}function h(e){if(!("module"in o))throw new Error("Wasm module needs to be initialized via 'initialize()'");var t;try{t=e(o.module)}catch(r){throw"number"==typeof r?new Error(o.module.get_error_message(r)):r}return t}function f(){if(!("module"in o))throw new Error("Wasm module needs to be initialized via 'initialize()'");return o.module.wasmMemory.buffer}function d(){return o.space}function v(e,t){o.module.FS.writeFile(e,t)}function p(e){return o.module.FS.readFile(e,{encoding:"binary"})}function m(e){o.module.FS.unlink(e)}function g(e){return o.module.FS.analyzePath(e).exists}},8383:function(e,t,r){"use strict";r.d(t,{yh:function(){return c},do:function(){return p},g1:function(){return m},lt:function(){return w},rr:function(){return _}});var n=r(5671),i=r(3144),a=r(136),s=r(9388),o=r(4942),u=r(2813),l=r(2905),c=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Uint8Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(c,"className","Uint8WasmArray"),(0,o.Z)(c,"valueSize",1);var h=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Int8Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(h,"className","Int8WasmArray"),(0,o.Z)(h,"valueSize",1);var f=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Uint16Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(f,"className","Uint16WasmArray"),(0,o.Z)(f,"valueSize",2);var d=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Int16Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(d,"className","Int16WasmArray"),(0,o.Z)(d,"valueSize",2);var v=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Uint32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(v,"className","Uint32WasmArray"),(0,o.Z)(v,"valueSize",4);var p=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Int32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(p,"className","Int32WasmArray"),(0,o.Z)(p,"valueSize",4);var m=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new BigUint64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(m,"className","BigUint64WasmArray"),(0,o.Z)(m,"valueSize",8);var g=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new BigInt64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(g,"className","BigInt64WasmArray"),(0,o.Z)(g,"valueSize",8);var b=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Float32Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(b,"className","Float32WasmArray"),(0,o.Z)(b,"valueSize",4);var w=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"array",value:function(){return new Float64Array((0,u.f3)(this.space),this.offset,this.length)}}]),r}(l.P);(0,o.Z)(w,"className","Float64WasmArray"),(0,o.Z)(w,"valueSize",8);var y={Uint8WasmArray:c,Int8WasmArray:h,Uint16WasmArray:f,Int16WasmArray:d,Uint32WasmArray:v,Int32WasmArray:p,BigUint64WasmArray:m,BigInt64WasmArray:g,Float32WasmArray:b,Float64WasmArray:w};function _(e){if(!(e in y))throw new Error("unknown WasmArray class '"+e+"'");return y[e]}},6737:function(e,t,r){"use strict";r.d(t,{lt:function(){return i.lt},do:function(){return i.do},PQ:function(){return n.P},Zv:function(){return h.Zv},GF:function(){return l},RJ:function(){return c},Wf:function(){return u},TS:function(){return o},dt:function(){return f},z2:function(){return a.z2},rr:function(){return i.rr}});var n=r(2905),i=r(8383),a=r(2813);function s(e,t,r){return(0,a.TK)(e,t,r)}function o(e,t){return s(e,t,i.yh)}function u(e,t){return s(e,t,i.do)}function l(e,t){return s(e,t,i.g1)}function c(e,t){return s(e,t,i.lt)}var h=r(4163);function f(e,t,r,n){return new n(e,-1,t,r,{})}}}]);
//# sourceMappingURL=639.e77e16ec.chunk.js.map
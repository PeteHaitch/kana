!function(){"use strict";var e={9747:function(e,n,t){var r,o=t(4165),s=t(5861),a=t(3324),c=t(7762),i=t(797),u=t(5831),l=null;function f(e){return p.apply(this,arguments)}function p(){return p=(0,s.Z)((0,o.Z)().mark((function e(n){var t,s,a,c,i,u,f,p,d,m,h,y,v=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>1&&void 0!==v[1]?v[1]:null,s=v.length>2&&void 0!==v[2]&&v[2],e.next=4,l;case 4:if(s){e.next=13;break}return a=r.result.transaction(["downloads"],"readonly"),c=a.objectStore("downloads"),i=new Promise((function(e){var t=c.get(n);t.onsuccess=function(n){void 0!==t.result?e(t.result.payload):e(null)},t.onerror=function(n){e(null)}})),e.next=10,i;case 10:if(null===(u=e.sent)){e.next=13;break}return e.abrupt("return",u);case 13:return f=null==t?fetch(n):fetch(n,t),e.next=16,f;case 16:if((p=e.sent).ok){e.next=19;break}throw"failed to download '"+n+"' ("+p.status+")";case 19:return e.next=21,p.arrayBuffer();case 21:return d=e.sent,m=r.result.transaction(["downloads"],"readwrite"),h=m.objectStore("downloads"),y=new Promise((function(e){var t=h.put({url:n,payload:d});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),e.next=27,y;case 27:if(e.sent){e.next=30;break}throw"failed to download resources for '"+n+"'";case 30:return e.abrupt("return",d);case 31:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}var d=t(9062),m=t(7325),h=t(9807),y="https://cors-proxy.aaron-lun.workers.dev";function v(e){return g.apply(this,arguments)}function g(){return(g=(0,s.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(y+"/"+encodeURIComponent(n));case 2:return t=e.sent,e.abrupt("return",new Uint8Array(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,n){if(e)if(Array.isArray(e)){var t,r=(0,c.Z)(e);try{for(r.s();!(t=r.n()).done;){w(t.value,n)}}catch(u){r.e(u)}finally{r.f()}}else if(e.constructor==Object)for(var o=0,s=Object.entries(e);o<s.length;o++){var i=(0,a.Z)(s[o],2);i[0];w(i[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}function b(e){postMessage({type:"".concat(e,"_START")})}function S(e,n){if("undefined"==typeof n)postMessage({type:"".concat(e,"_CACHE")});else{var t=[];w(n,t),postMessage({type:"".concat(e,"_DATA"),resp:n},t)}}function x(e,n,t){postMessage({type:"".concat(e,"_ERROR"),resp:{reason:n.toString(),fatal:t}})}function _(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function O(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.all,o=void 0!==r&&r,s=t.unique,a=void 0!==s&&s,c=t.colname,u=void 0===c?null:c;if(_(e)){n=i.Qr(e);var l=new Set(e);n.num_unique=l.size,l.size<=50&a&&(n.__unique__=(0,d.Z)(l)),o&&(n._all_=e),"continuous"===n.type&&l.size<=50&&(n.type="both"),("string"===typeof u||u instanceof String)&&(n.name=u)}return n}i.ES.setDownload(v),m.b5(v),i.E4.setDownload(v),m.ao(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n,t,r){var s,a,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=m.XZ()+"/"+n,a=y+"/"+encodeURIComponent(s),null!=t||null!=r){e.next=9;break}return e.next=5,f(a);case 5:return c=e.sent,e.abrupt("return",new Response(c));case 9:return e.abrupt("return",fetch(a+"?start="+String(t)+"&end="+String(r)));case 10:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}()),m.d9(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.Kk()+"/"+n,e.next=3,f(y+"/"+encodeURIComponent(t));case 3:return r=e.sent,e.abrupt("return",new Response(r));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),h.M.setDownloadFun(v),i.cO.ExperimentHub=h.M;t(3841);var k="K@\ud835\udf02a#$c3ll";"".concat(k,"::CLUSTERS"),"".concat(k,"::SELECTION"),"".concat(k,"::CLUSTERS");var E="".concat(k,"::SELECTION"),Z={},R={},M=null,A={},C=null,T=null;function j(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("H5AD"===e.format)return new i.nN(e.h5,n?e.options:{});if("SummarizedExperiment"===e.format)return new i.CM(e.rds,n?e.options:{});if("ZippedArtifactdb"===e.format)return new i.EQ(e.zipname,new i.zD(e.zipfile),n?e.options:{});throw new Error("unknown format '"+e.format+"'")}function N(e,n){var t,r={},o=(0,c.Z)(e.cells.columnNames());try{for(o.s();!(t=o.n()).done;){var s=t.value,i=e.cells.column(s);_(i)&&(r[s]=O(i,{all:!0,colname:s}))}}catch(Z){o.e(Z)}finally{o.f()}var u={cells:{columns:r,numberOfCells:e.cells.numberOfRows()}};if("SummarizedExperiment"===n.format||"ZippedArtifactdb"===n.format){if(u.modality_features={},"modality_features"in e)for(var l=0,f=Object.entries(e.modality_features);l<f.length;l++){var p,d=(0,a.Z)(f[l],2),m=d[0],h=d[1],y={},v=(0,c.Z)(h.columnNames());try{for(v.s();!(p=v.n()).done;){var g=p.value,w=h.column(g);_(w)&&(y[g]=O(w,{all:!0,colname:g}))}}catch(Z){v.e(Z)}finally{v.f()}u.modality_features[m]={columns:y,numberOfFeatures:h.numberOfRows(),rownames:Array.isArray(h.rowNames())}}}else{u.all_features={};var b,S={},x=(0,c.Z)(e.all_features.columnNames());try{for(x.s();!(b=x.n()).done;){var k=b.value,E=e.all_features.column(k);_(E)&&(S[k]=O(E,{all:!0,colname:k}))}}catch(Z){x.e(Z)}finally{x.f()}u.all_features={columns:S,numberOfFeatures:e.all_features.numberOfRows(),rownames:Array.isArray(e.all_features.rowNames())}}return"H5AD"===n.format?u.all_assay_names=e.all_assay_names:"SummarizedExperiment"!==n.format&&"ZippedArtifactdb"!==n.format||(u.modality_assay_names=e.modality_assay_names),u.reduced_dimension_names=e.reduced_dimension_names,u}function F(e,n){var t;return e in A||((t=new i.J6(I(),n.ids.slice())).computeAll(),A[e]=t),A[e]}var D,P=function(e){if(-1!==e.indexOf(":::")){var n=e.split(":::");return M.cells.column(n[0]).column(n[1])}return M.cells.column(e)},I=function(){return M.matrix};onmessage=function(e){var n=e.data,t=n.type,f=n.payload,p=!1;if("INIT"===t){p=!0;var d=Math.round(2*navigator.hardwareConcurrency/3),m=i.j2({numberOfThreads:d}),h=m.then((function(){return i.TN()}));h.then((function(e){e,postMessage({type:t,msg:"Success: analysis state created"})}));var y=(null===l&&(l=new Promise((function(e,n){(r=indexedDB.open("DownloadsDB",3)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("downloads")}catch(e){}n.createObjectStore("downloads",{keyPath:"url"})},r.onsuccess=function(){e(null)},r.onerror=function(){n("failed to initialize DownloadsDB")}}))),l);y.then((function(e){postMessage({type:"DownloadsDB_store",resp:e,msg:"Success: DownloadsDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"DownloadsDB_ERROR",msg:"Error: Cannot initialize DownloadsDB"})})),(D=Promise.all([m,h,y])).then((function(){postMessage({type:t,msg:"Success: bakana initialized"})})).catch((function(e){console.error(e),x(t,e,p)}))}else"EXPLORE"===t?(p=!0,D.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,l,p,d,m,h,y,v,g,w,x,k,E,R,A,T,N,F,D,P,I,U,z,V,G,B,L,H,J,Y,K,q,X,Q,$,W,ee,ne,te,re;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.inputs,null===(r=t.files)){e.next=31;break}for(s={},l=0,p=Object.entries(r);l<p.length;l++)d=(0,a.Z)(p[l],2),m=d[0],"uid"in(h=d[1])&&h.uid in Z&&(Z[h.uid].clear(),delete Z[m]),s[m]=j(h,!0),s[m].setOptions(h.options);y=0,v=Object.entries(s);case 6:if(!(y<v.length)){e.next=31;break}return g=(0,a.Z)(v[y],2),w=g[0],x=g[1],e.next=10,x.load();case 10:if(M=e.sent,!r[w].options.normalized){k=(0,c.Z)(M.matrix.available());try{for(k.s();!(E=k.n()).done;)R=E.value,A=M.matrix.get(R),T=u.gk(A,{allowZeros:!0}),M.matrix.add(R,T)}catch(n){k.e(n)}finally{k.f()}}b(N="inputs"),F={},D=(0,c.Z)(M.cells.columnNames());try{for(D.s();!(P=D.n()).done;)I=P.value,_(U=M.cells.column(I))&&(z=O(U,{all:!1,unique:!0,colname:I}),F[I]=z)}catch(n){D.e(n)}finally{D.f()}for(V={annotations:F,genes:{},num_cells:M.cells.numberOfRows(),num_genes:{}},G=0,B=Object.entries(M.features);G<B.length;G++){L=(0,a.Z)(B[G],2),H=L[0],J=L[1],V.genes[H]={},V.num_genes[H]=J.numberOfRows(),Y=(0,c.Z)(J.columnNames());try{for(Y.s();!(K=Y.n()).done;)q=K.value,_(X=J.column(q))&&(V.genes[H][q]=X)}catch(n){Y.e(n)}finally{Y.f()}J.rowNames()&&(V.genes[H].rowNames=J.rowNames())}for(S(N,V),b(Q="embedding"),$={},W=0,ee=Object.entries(M.reduced_dimensions);W<ee.length;W++)ne=(0,a.Z)(ee[W],2),te=ne[0],re=ne[1],"pca"!==te.toLowerCase()&&($[te]={x:re[0].slice(),y:re[1].slice()});S(Q,$),C&&C.free(),C=new i.sF(M.matrix);case 28:y++,e.next=6;break;case 31:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)}))):"PREFLIGHT_INPUT"===t?D.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,c,i,u,l,p,d;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},e.prev=1,r={},s={},c=0,i=Object.entries(f.inputs.files);case 5:if(!(c<i.length)){e.next=23;break}if(u=(0,a.Z)(i[c],2),l=u[0],!("uid"in(p=u[1]))){e.next=17;break}if(p.uid in Z){e.next=13;break}return Z[p.uid]=j(p),e.next=12,Z[p.uid].summary();case 12:R[p.uid]=e.sent;case 13:r[l]=Z[p.uid],s[l]=N(R[p.uid],p),e.next=20;break;case 17:d=j(p),r[l]=d,s[l]=N(r[l],p);case 20:c++,e.next=5;break;case 23:t.status="SUCCESS",t.details=s,e.next=32;break;case 27:e.prev=27,e.t0=e.catch(1),console.error(e.t0),t.status="ERROR",t.reason=e.t0.toString();case 32:postMessage({type:"PREFLIGHT_INPUT_DATA",resp:t,msg:"Success: PREFLIGHT_INPUT done"});case 33:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"computeVersusClusters"===t?D.then((function(e){var n=f.rank_type,t=f.modality,r=f.annotation,o=u.Yh(P(r)),s=F(r,o).computeVersus(o.levels.indexOf(f.left),o.levels.indexOf(f.right)),a=i.jJ(s.results[t],s.left,n),c=[];w(a,c),postMessage({type:"computeVersusClusters",resp:a,msg:"Success: COMPUTE_VERSUS_CLUSTERS done"},c)})).catch((function(e){console.error(e),x(t,e,p)})):"computeVersusSelections"===t?D.then((function(e){var n=f.rank_type,t=C.computeVersus(f.left,f.right),r=i.jJ(t.results[f.modality],f.left,n),o=[];w(r,o),postMessage({type:"computeVersusSelections",resp:r,msg:"Success: COMPUTE_VERSUS_SELECTIONS done"},o)})).catch((function(e){console.error(e),x(t,e,p)})):"getMarkersForCluster"===t?D.then((function(e){var n=f.cluster,t=f.rank_type,r=f.modality,o=f.annotation,s=u.Yh(P(o)),a=F(o,s).fetchResults()[r],c=i.jJ(a,s.levels.indexOf(n),t),l=[];w(c,l),postMessage({type:"setMarkersForCluster",resp:c,msg:"Success: GET_MARKER_GENE done"},l)})).catch((function(e){console.error(e),x(t,e,p)})):"getGeneExpression"===t?D.then((function(e){var n=f.gene,t=f.modality,r=M.matrix.get(t).row(n);postMessage({type:"setGeneExpression",resp:{gene:n,expr:r},msg:"Success: GET_GENE_EXPRESSION done"},[r.buffer])})).catch((function(e){console.error(e),x(t,e,p)})):"computeCustomMarkers"===t?D.then((function(e){C.addSelection(f.id,f.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})).catch((function(e){console.error(e),x(t,e,p)})):"getMarkersForSelection"===t?D.then((function(e){var n=f.rank_type.replace(/-.*/,""),t=C.fetchResults(f.cluster)[f.modality],r=i.jJ(t,1,n),o=[];w(r,o),postMessage({type:"setMarkersForCustomSelection",resp:r,msg:"Success: GET_MARKER_GENE done"},o)})).catch((function(e){console.error(e),x(t,e,p)})):"removeCustomMarkers"===t?D.then((function(e){C.removeSelection(f.id)})).catch((function(e){console.error(e),x(t,e,p)})):"getAnnotation"===t?D.then((function(e){var n,t,r=f.annotation;if(n=P(r),ArrayBuffer.isView(n))t={type:"array",values:n.slice()};else{var o=[],s={},a=new Int32Array(n.length);n.map((function(e,n){e in s||(s[e]=o.length,o.push(e)),a[n]=s[e]})),t={type:"factor",index:a,levels:o}}var c=[];w(t,c),postMessage({type:"setAnnotation",resp:{annotation:r,values:t},msg:"Success: GET_ANNOTATION done"},c)})).catch((function(e){console.error(e),x(t,e,p)})):"computeFeaturesetSummary"===t?D.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,a,c,i,l,p,d,m,h,y,v,g;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.annotation,r=f.rank_type,s=f.cluster,a=f.modality,c=r.indexOf("-"),E===t?(i=C.fetchSelectionIndices(s),l=M.cells.numberOfRows(),p=new Uint8Array(l),i.map((function(e){return p.set([1],e)})),d=u.Yh(p),m=F(t,d),h=m.fetchResults()[a],T.ready().then((function(e){S("computeFeaturesetSummary",T.computeEnrichment(h,d.levels.indexOf(1),r.slice(0,c),r.slice(c+1)))}))):(y=u.Yh(P(t)),v=F(t,y),g=v.fetchResults()[a],T.ready().then((function(e){S("computeFeaturesetSummary",T.computeEnrichment(g,y.levels.indexOf(s),r.slice(0,c),r.slice(c+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"computeFeaturesetVSSummary"===t?D.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t,r,s,a,c,i,l,p,d,m;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.annotation,r=f.rank_type,s=f.left,a=f.right,c=f.modality,i=r.indexOf("-"),E===t?(l=C.computeVersus(s,a),T.ready().then((function(e){S("computeFeaturesetVSSummary",T.computeEnrichment(l.results[c],0,r.slice(0,i),r.slice(i+1)))}))):(p=u.Yh(P(t)),d=F(t,p),m=d.computeVersus(p.levels.indexOf(f.left),p.levels.indexOf(f.right)),T.ready().then((function(e){S("computeFeaturesetVSSummary",T.computeEnrichment(m.results[c],m.left,r.slice(0,i),r.slice(i+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),x(t,e,p)})):"getFeatureScores"===t?D.then((function(e){var n=f.index;S("setFeatureScores",T.computePerCellScores(n))})).catch((function(e){console.error(e),x(t,e,p)})):"getFeatureGeneIndices"===t?D.then((function(e){var n,t,r=f.index,o=f.cluster,s=f.annotation,c=f.modality,l=f.rank_type,p=T.fetchFeatureSetIndices(r);if(E===s)n=C.fetchResults(f.cluster)[f.modality],t=i.jJ(n,1,f.rank_type);else{var d=u.Yh(P(s));n=F(s,d).fetchResults()[c],t=i.jJ(n,d.levels.indexOf(o),l)}for(var m=t.ordering.map((function(e,n){return p.includes(e)?n:-100})).filter((function(e){return-100!==e})),h={},y=0,v=Object.entries(t);y<v.length;y++){var g=(0,a.Z)(v[y],2),w=g[0],b=g[1];h[w]=b.map((function(e,n){return m.includes(n)?e:-100})).filter((function(e){return-100!==e}))}S("setFeatureGeneIndices",h)})).catch((function(e){console.error(e),x(t,e,p)})):"initFeaturesetEnrich"===t?D.then(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f.modality,T&&T.free(),(T=new i.Y(M.features[t],{normalized:M.matrix.get(t)})).ready().then((function(e){var n=T.fetchCollectionDetails(),t=T.fetchSetDetails();S("feature_set_enrichment",{collections:n,sets:{names:t.names,descriptions:t.descriptions,sizes:t.sizes.slice(),collections:t.collections.slice()}})}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):(console.error("MIM:::msg type incorrect"),x(t,"Type not defined",p))}}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var s=n[r]={id:r,loaded:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}t.m=e,t.x=function(){var e=t.O(void 0,[660,772,463],(function(){return t(9747)}));return e=t.O(e)},function(){var e=[];t.O=function(n,r,o,s){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],s=e[l][2];for(var c=!0,i=0;i<r.length;i++)(!1&s||a>=s)&&Object.keys(t.O).every((function(e){return t.O[e](r[i])}))?r.splice(i--,1):(c=!1,s<a&&(a=s));if(c){e.splice(l--,1);var u=o();void 0!==u&&(n=u)}}return n}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,o,s]}}(),t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))},t.u=function(e){return"static/js/"+e+"."+{463:"e6d7a01c",484:"6b77e28b",660:"960f344e",772:"c070c97d",909:"6d8e3cf9",933:"693dbddf"}[e]+".chunk.js"},t.miniCssF=function(e){},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},t.p="/kana/",function(){t.b=self.location+"/../../../";var e={747:1};t.f.i=function(n,r){e[n]||importScripts(t.p+t.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],r=n.push.bind(n);n.push=function(n){var o=n[0],s=n[1],a=n[2];for(var c in s)t.o(s,c)&&(t.m[c]=s[c]);for(a&&a(t);o.length;)e[o.pop()]=1;r(n)}}(),function(){var e=t.x;t.x=function(){return Promise.all([660,772,463].map(t.e,t)).then(e)}}();t.x()}();
//# sourceMappingURL=747.bc2271b9.chunk.js.map